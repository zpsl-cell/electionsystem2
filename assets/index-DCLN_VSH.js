(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const Eh=()=>{};var Ua={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ac=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);o<128?e[t++]=o:o<2048?(e[t++]=o>>6|192,e[t++]=o&63|128):(o&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(o=65536+((o&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=o>>18|240,e[t++]=o>>12&63|128,e[t++]=o>>6&63|128,e[t++]=o&63|128):(e[t++]=o>>12|224,e[t++]=o>>6&63|128,e[t++]=o&63|128)}return e},Ih=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const o=n[t++];if(o<128)e[i++]=String.fromCharCode(o);else if(o>191&&o<224){const s=n[t++];e[i++]=String.fromCharCode((o&31)<<6|s&63)}else if(o>239&&o<365){const s=n[t++],r=n[t++],c=n[t++],f=((o&7)<<18|(s&63)<<12|(r&63)<<6|c&63)-65536;e[i++]=String.fromCharCode(55296+(f>>10)),e[i++]=String.fromCharCode(56320+(f&1023))}else{const s=n[t++],r=n[t++];e[i++]=String.fromCharCode((o&15)<<12|(s&63)<<6|r&63)}}return e.join("")},Cc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let o=0;o<n.length;o+=3){const s=n[o],r=o+1<n.length,c=r?n[o+1]:0,f=o+2<n.length,d=f?n[o+2]:0,h=s>>2,m=(s&3)<<4|c>>4;let g=(c&15)<<2|d>>6,T=d&63;f||(T=64,r||(g=64)),i.push(t[h],t[m],t[g],t[T])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Ac(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Ih(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let o=0;o<n.length;){const s=t[n.charAt(o++)],c=o<n.length?t[n.charAt(o)]:0;++o;const d=o<n.length?t[n.charAt(o)]:64;++o;const m=o<n.length?t[n.charAt(o)]:64;if(++o,s==null||c==null||d==null||m==null)throw new vh;const g=s<<2|c>>4;if(i.push(g),d!==64){const T=c<<4&240|d>>2;if(i.push(T),m!==64){const P=d<<6&192|m;i.push(P)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class vh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ah=function(n){const e=Ac(n);return Cc.encodeByteArray(e,!0)},Gi=function(n){return Ah(n).replace(/\./g,"")},Ch=function(n){try{return Cc.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wh=()=>Sh().__FIREBASE_DEFAULTS__,Rh=()=>{if(typeof process>"u"||typeof Ua>"u")return;const n=Ua.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Ph=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Ch(n[1]);return e&&JSON.parse(e)},Hs=()=>{try{return Eh()||wh()||Rh()||Ph()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Nh=n=>{var e,t;return(t=(e=Hs())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},Mh=n=>{const e=Nh(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},Sc=()=>{var n;return(n=Hs())==null?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $s(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Vh(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xh(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",o=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r={iss:`https://securetoken.google.com/${i}`,aud:i,iat:o,exp:o+3600,auth_time:o,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Gi(JSON.stringify(t)),Gi(JSON.stringify(r)),""].join(".")}const On={};function kh(){const n={prod:[],emulator:[]};for(const e of Object.keys(On))On[e]?n.emulator.push(e):n.prod.push(e);return n}function bh(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let qa=!1;function Lh(n,e){if(typeof window>"u"||typeof document>"u"||!$s(window.location.host)||On[n]===e||On[n]||qa)return;On[n]=e;function t(g){return`__firebase__banner__${g}`}const i="__firebase__banner",s=kh().prod.length>0;function r(){const g=document.getElementById(i);g&&g.remove()}function c(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function f(g,T){g.setAttribute("width","24"),g.setAttribute("id",T),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function d(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{qa=!0,r()},g}function h(g,T){g.setAttribute("id",T),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function m(){const g=bh(i),T=t("text"),P=document.getElementById(T)||document.createElement("span"),M=t("learnmore"),N=document.getElementById(M)||document.createElement("a"),V=t("preprendIcon"),L=document.getElementById(V)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const b=g.element;c(b),h(N,M);const H=d();f(L,V),b.append(L,P,N,H),document.body.appendChild(b)}s?(P.innerText="Preview backend disconnected.",L.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(L.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,P.innerText="Preview backend running in this workspace."),P.setAttribute("id",T)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fh(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Uh(){var e;const n=(e=Hs())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function qh(){return!Uh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Bh(){try{return typeof indexedDB=="object"}catch{return!1}}function Gh(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",o=self.indexedDB.open(i);o.onsuccess=()=>{o.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},o.onupgradeneeded=()=>{t=!1},o.onerror=()=>{var s;e(((s=o.error)==null?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oh="FirebaseError";class cn extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=Oh,Object.setPrototypeOf(this,cn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,wc.prototype.create)}}class wc{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},o=`${this.service}/${e}`,s=this.errors[e],r=s?Hh(s,i):"Error",c=`${this.serviceName}: ${r} (${o}).`;return new cn(o,c,i)}}function Hh(n,e){return n.replace($h,(t,i)=>{const o=e[i];return o!=null?String(o):`<${i}?>`})}const $h=/\{\$([^}]+)}/g;function Oi(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const o of t){if(!i.includes(o))return!1;const s=n[o],r=e[o];if(Ba(s)&&Ba(r)){if(!Oi(s,r))return!1}else if(s!==r)return!1}for(const o of i)if(!t.includes(o))return!1;return!0}function Ba(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Be(n){return n&&n._delegate?n._delegate:n}class Wn{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kt="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jh{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new Dh;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const o=this.getOrInitializeService({instanceIdentifier:t});o&&i.resolve(o)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Kh(e))try{this.getOrInitializeService({instanceIdentifier:kt})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:o});i.resolve(s)}catch{}}}}clearInstance(e=kt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=kt){return this.instances.has(e)}getOptions(e=kt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const o=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[s,r]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(s);i===c&&r.resolve(o)}return o}onInit(e,t){const i=this.normalizeInstanceIdentifier(t),o=this.onInitCallbacks.get(i)??new Set;o.add(e),this.onInitCallbacks.set(i,o);const s=this.instances.get(i);return s&&e(s,i),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const o of i)try{o(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:zh(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=kt){return this.component?this.component.multipleInstances?e:kt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function zh(n){return n===kt?void 0:n}function Kh(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wh{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Jh(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ee;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ee||(ee={}));const Yh={debug:ee.DEBUG,verbose:ee.VERBOSE,info:ee.INFO,warn:ee.WARN,error:ee.ERROR,silent:ee.SILENT},Qh=ee.INFO,Xh={[ee.DEBUG]:"log",[ee.VERBOSE]:"log",[ee.INFO]:"info",[ee.WARN]:"warn",[ee.ERROR]:"error"},Zh=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),o=Xh[e];if(o)console[o](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Rc{constructor(e){this.name=e,this._logLevel=Qh,this._logHandler=Zh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ee))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Yh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ee.DEBUG,...e),this._logHandler(this,ee.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ee.VERBOSE,...e),this._logHandler(this,ee.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ee.INFO,...e),this._logHandler(this,ee.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ee.WARN,...e),this._logHandler(this,ee.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ee.ERROR,...e),this._logHandler(this,ee.ERROR,...e)}}const jh=(n,e)=>e.some(t=>n instanceof t);let Ga,Oa;function ep(){return Ga||(Ga=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function tp(){return Oa||(Oa=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Pc=new WeakMap,ds=new WeakMap,Nc=new WeakMap,es=new WeakMap,Js=new WeakMap;function np(n){const e=new Promise((t,i)=>{const o=()=>{n.removeEventListener("success",s),n.removeEventListener("error",r)},s=()=>{t(pt(n.result)),o()},r=()=>{i(n.error),o()};n.addEventListener("success",s),n.addEventListener("error",r)});return e.then(t=>{t instanceof IDBCursor&&Pc.set(t,n)}).catch(()=>{}),Js.set(e,n),e}function ip(n){if(ds.has(n))return;const e=new Promise((t,i)=>{const o=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",r),n.removeEventListener("abort",r)},s=()=>{t(),o()},r=()=>{i(n.error||new DOMException("AbortError","AbortError")),o()};n.addEventListener("complete",s),n.addEventListener("error",r),n.addEventListener("abort",r)});ds.set(n,e)}let fs={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ds.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Nc.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return pt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function op(n){fs=n(fs)}function sp(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(ts(this),e,...t);return Nc.set(i,e.sort?e.sort():[e]),pt(i)}:tp().includes(n)?function(...e){return n.apply(ts(this),e),pt(Pc.get(this))}:function(...e){return pt(n.apply(ts(this),e))}}function rp(n){return typeof n=="function"?sp(n):(n instanceof IDBTransaction&&ip(n),jh(n,ep())?new Proxy(n,fs):n)}function pt(n){if(n instanceof IDBRequest)return np(n);if(es.has(n))return es.get(n);const e=rp(n);return e!==n&&(es.set(n,e),Js.set(e,n)),e}const ts=n=>Js.get(n);function ap(n,e,{blocked:t,upgrade:i,blocking:o,terminated:s}={}){const r=indexedDB.open(n,e),c=pt(r);return i&&r.addEventListener("upgradeneeded",f=>{i(pt(r.result),f.oldVersion,f.newVersion,pt(r.transaction),f)}),t&&r.addEventListener("blocked",f=>t(f.oldVersion,f.newVersion,f)),c.then(f=>{s&&f.addEventListener("close",()=>s()),o&&f.addEventListener("versionchange",d=>o(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const lp=["get","getKey","getAll","getAllKeys","count"],up=["put","add","delete","clear"],ns=new Map;function Ha(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ns.get(e))return ns.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,o=up.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(o||lp.includes(t)))return;const s=async function(r,...c){const f=this.transaction(r,o?"readwrite":"readonly");let d=f.store;return i&&(d=d.index(c.shift())),(await Promise.all([d[t](...c),o&&f.done]))[0]};return ns.set(e,s),s}op(n=>({...n,get:(e,t,i)=>Ha(e,t)||n.get(e,t,i),has:(e,t)=>!!Ha(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(dp(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function dp(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const hs="@firebase/app",$a="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const je=new Rc("@firebase/app"),fp="@firebase/app-compat",hp="@firebase/analytics-compat",pp="@firebase/analytics",mp="@firebase/app-check-compat",gp="@firebase/app-check",yp="@firebase/auth",_p="@firebase/auth-compat",Tp="@firebase/database",Ep="@firebase/data-connect",Ip="@firebase/database-compat",vp="@firebase/functions",Ap="@firebase/functions-compat",Cp="@firebase/installations",Sp="@firebase/installations-compat",wp="@firebase/messaging",Rp="@firebase/messaging-compat",Pp="@firebase/performance",Np="@firebase/performance-compat",Mp="@firebase/remote-config",Dp="@firebase/remote-config-compat",Vp="@firebase/storage",xp="@firebase/storage-compat",kp="@firebase/firestore",bp="@firebase/ai",Lp="@firebase/firestore-compat",Fp="firebase",Up="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ps="[DEFAULT]",qp={[hs]:"fire-core",[fp]:"fire-core-compat",[pp]:"fire-analytics",[hp]:"fire-analytics-compat",[gp]:"fire-app-check",[mp]:"fire-app-check-compat",[yp]:"fire-auth",[_p]:"fire-auth-compat",[Tp]:"fire-rtdb",[Ep]:"fire-data-connect",[Ip]:"fire-rtdb-compat",[vp]:"fire-fn",[Ap]:"fire-fn-compat",[Cp]:"fire-iid",[Sp]:"fire-iid-compat",[wp]:"fire-fcm",[Rp]:"fire-fcm-compat",[Pp]:"fire-perf",[Np]:"fire-perf-compat",[Mp]:"fire-rc",[Dp]:"fire-rc-compat",[Vp]:"fire-gcs",[xp]:"fire-gcs-compat",[kp]:"fire-fst",[Lp]:"fire-fst-compat",[bp]:"fire-vertex","fire-js":"fire-js",[Fp]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hi=new Map,Bp=new Map,ms=new Map;function Ja(n,e){try{n.container.addComponent(e)}catch(t){je.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function $i(n){const e=n.name;if(ms.has(e))return je.debug(`There were multiple attempts to register component ${e}.`),!1;ms.set(e,n);for(const t of Hi.values())Ja(t,n);for(const t of Bp.values())Ja(t,n);return!0}function Gp(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Op(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hp={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},mt=new wc("app","Firebase",Hp);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(e,t,i){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Wn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw mt.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jp=Up;function Mc(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i={name:ps,automaticDataCollectionEnabled:!0,...e},o=i.name;if(typeof o!="string"||!o)throw mt.create("bad-app-name",{appName:String(o)});if(t||(t=Sc()),!t)throw mt.create("no-options");const s=Hi.get(o);if(s){if(Oi(t,s.options)&&Oi(i,s.config))return s;throw mt.create("duplicate-app",{appName:o})}const r=new Wh(o);for(const f of ms.values())r.addComponent(f);const c=new $p(t,i,r);return Hi.set(o,c),c}function zp(n=ps){const e=Hi.get(n);if(!e&&n===ps&&Sc())return Mc();if(!e)throw mt.create("no-app",{appName:n});return e}function Zt(n,e,t){let i=qp[n]??n;t&&(i+=`-${t}`);const o=i.match(/\s|\//),s=e.match(/\s|\//);if(o||s){const r=[`Unable to register library "${i}" with version "${e}":`];o&&r.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&s&&r.push("and"),s&&r.push(`version name "${e}" contains illegal characters (whitespace or "/")`),je.warn(r.join(" "));return}$i(new Wn(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kp="firebase-heartbeat-database",Wp=1,Yn="firebase-heartbeat-store";let is=null;function Dc(){return is||(is=ap(Kp,Wp,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Yn)}catch(t){console.warn(t)}}}}).catch(n=>{throw mt.create("idb-open",{originalErrorMessage:n.message})})),is}async function Yp(n){try{const t=(await Dc()).transaction(Yn),i=await t.objectStore(Yn).get(Vc(n));return await t.done,i}catch(e){if(e instanceof cn)je.warn(e.message);else{const t=mt.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});je.warn(t.message)}}}async function za(n,e){try{const i=(await Dc()).transaction(Yn,"readwrite");await i.objectStore(Yn).put(e,Vc(n)),await i.done}catch(t){if(t instanceof cn)je.warn(t.message);else{const i=mt.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});je.warn(i.message)}}}function Vc(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qp=1024,Xp=30;class Zp{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new em(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const o=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Ka();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(r=>r.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:o}),this._heartbeatsCache.heartbeats.length>Xp){const r=tm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){je.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Ka(),{heartbeatsToSend:i,unsentEntries:o}=jp(this._heartbeatsCache.heartbeats),s=Gi(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,o.length>0?(this._heartbeatsCache.heartbeats=o,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return je.warn(t),""}}}function Ka(){return new Date().toISOString().substring(0,10)}function jp(n,e=Qp){const t=[];let i=n.slice();for(const o of n){const s=t.find(r=>r.agent===o.agent);if(s){if(s.dates.push(o.date),Wa(t)>e){s.dates.pop();break}}else if(t.push({agent:o.agent,dates:[o.date]}),Wa(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class em{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Bh()?Gh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Yp(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return za(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return za(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Wa(n){return Gi(JSON.stringify({version:2,heartbeats:n})).length}function tm(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nm(n){$i(new Wn("platform-logger",e=>new cp(e),"PRIVATE")),$i(new Wn("heartbeat",e=>new Zp(e),"PRIVATE")),Zt(hs,$a,n),Zt(hs,$a,"esm2020"),Zt("fire-js","")}nm("");var im="firebase",om="12.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zt(im,om,"app");var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var gt,xc;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,I){function E(){}E.prototype=I.prototype,A.F=I.prototype,A.prototype=new E,A.prototype.constructor=A,A.D=function(C,S,w){for(var v=Array(arguments.length-2),re=2;re<arguments.length;re++)v[re-2]=arguments[re];return I.prototype[S].apply(C,v)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(i,t),i.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function o(A,I,E){E||(E=0);const C=Array(16);if(typeof I=="string")for(var S=0;S<16;++S)C[S]=I.charCodeAt(E++)|I.charCodeAt(E++)<<8|I.charCodeAt(E++)<<16|I.charCodeAt(E++)<<24;else for(S=0;S<16;++S)C[S]=I[E++]|I[E++]<<8|I[E++]<<16|I[E++]<<24;I=A.g[0],E=A.g[1],S=A.g[2];let w=A.g[3],v;v=I+(w^E&(S^w))+C[0]+3614090360&4294967295,I=E+(v<<7&4294967295|v>>>25),v=w+(S^I&(E^S))+C[1]+3905402710&4294967295,w=I+(v<<12&4294967295|v>>>20),v=S+(E^w&(I^E))+C[2]+606105819&4294967295,S=w+(v<<17&4294967295|v>>>15),v=E+(I^S&(w^I))+C[3]+3250441966&4294967295,E=S+(v<<22&4294967295|v>>>10),v=I+(w^E&(S^w))+C[4]+4118548399&4294967295,I=E+(v<<7&4294967295|v>>>25),v=w+(S^I&(E^S))+C[5]+1200080426&4294967295,w=I+(v<<12&4294967295|v>>>20),v=S+(E^w&(I^E))+C[6]+2821735955&4294967295,S=w+(v<<17&4294967295|v>>>15),v=E+(I^S&(w^I))+C[7]+4249261313&4294967295,E=S+(v<<22&4294967295|v>>>10),v=I+(w^E&(S^w))+C[8]+1770035416&4294967295,I=E+(v<<7&4294967295|v>>>25),v=w+(S^I&(E^S))+C[9]+2336552879&4294967295,w=I+(v<<12&4294967295|v>>>20),v=S+(E^w&(I^E))+C[10]+4294925233&4294967295,S=w+(v<<17&4294967295|v>>>15),v=E+(I^S&(w^I))+C[11]+2304563134&4294967295,E=S+(v<<22&4294967295|v>>>10),v=I+(w^E&(S^w))+C[12]+1804603682&4294967295,I=E+(v<<7&4294967295|v>>>25),v=w+(S^I&(E^S))+C[13]+4254626195&4294967295,w=I+(v<<12&4294967295|v>>>20),v=S+(E^w&(I^E))+C[14]+2792965006&4294967295,S=w+(v<<17&4294967295|v>>>15),v=E+(I^S&(w^I))+C[15]+1236535329&4294967295,E=S+(v<<22&4294967295|v>>>10),v=I+(S^w&(E^S))+C[1]+4129170786&4294967295,I=E+(v<<5&4294967295|v>>>27),v=w+(E^S&(I^E))+C[6]+3225465664&4294967295,w=I+(v<<9&4294967295|v>>>23),v=S+(I^E&(w^I))+C[11]+643717713&4294967295,S=w+(v<<14&4294967295|v>>>18),v=E+(w^I&(S^w))+C[0]+3921069994&4294967295,E=S+(v<<20&4294967295|v>>>12),v=I+(S^w&(E^S))+C[5]+3593408605&4294967295,I=E+(v<<5&4294967295|v>>>27),v=w+(E^S&(I^E))+C[10]+38016083&4294967295,w=I+(v<<9&4294967295|v>>>23),v=S+(I^E&(w^I))+C[15]+3634488961&4294967295,S=w+(v<<14&4294967295|v>>>18),v=E+(w^I&(S^w))+C[4]+3889429448&4294967295,E=S+(v<<20&4294967295|v>>>12),v=I+(S^w&(E^S))+C[9]+568446438&4294967295,I=E+(v<<5&4294967295|v>>>27),v=w+(E^S&(I^E))+C[14]+3275163606&4294967295,w=I+(v<<9&4294967295|v>>>23),v=S+(I^E&(w^I))+C[3]+4107603335&4294967295,S=w+(v<<14&4294967295|v>>>18),v=E+(w^I&(S^w))+C[8]+1163531501&4294967295,E=S+(v<<20&4294967295|v>>>12),v=I+(S^w&(E^S))+C[13]+2850285829&4294967295,I=E+(v<<5&4294967295|v>>>27),v=w+(E^S&(I^E))+C[2]+4243563512&4294967295,w=I+(v<<9&4294967295|v>>>23),v=S+(I^E&(w^I))+C[7]+1735328473&4294967295,S=w+(v<<14&4294967295|v>>>18),v=E+(w^I&(S^w))+C[12]+2368359562&4294967295,E=S+(v<<20&4294967295|v>>>12),v=I+(E^S^w)+C[5]+4294588738&4294967295,I=E+(v<<4&4294967295|v>>>28),v=w+(I^E^S)+C[8]+2272392833&4294967295,w=I+(v<<11&4294967295|v>>>21),v=S+(w^I^E)+C[11]+1839030562&4294967295,S=w+(v<<16&4294967295|v>>>16),v=E+(S^w^I)+C[14]+4259657740&4294967295,E=S+(v<<23&4294967295|v>>>9),v=I+(E^S^w)+C[1]+2763975236&4294967295,I=E+(v<<4&4294967295|v>>>28),v=w+(I^E^S)+C[4]+1272893353&4294967295,w=I+(v<<11&4294967295|v>>>21),v=S+(w^I^E)+C[7]+4139469664&4294967295,S=w+(v<<16&4294967295|v>>>16),v=E+(S^w^I)+C[10]+3200236656&4294967295,E=S+(v<<23&4294967295|v>>>9),v=I+(E^S^w)+C[13]+681279174&4294967295,I=E+(v<<4&4294967295|v>>>28),v=w+(I^E^S)+C[0]+3936430074&4294967295,w=I+(v<<11&4294967295|v>>>21),v=S+(w^I^E)+C[3]+3572445317&4294967295,S=w+(v<<16&4294967295|v>>>16),v=E+(S^w^I)+C[6]+76029189&4294967295,E=S+(v<<23&4294967295|v>>>9),v=I+(E^S^w)+C[9]+3654602809&4294967295,I=E+(v<<4&4294967295|v>>>28),v=w+(I^E^S)+C[12]+3873151461&4294967295,w=I+(v<<11&4294967295|v>>>21),v=S+(w^I^E)+C[15]+530742520&4294967295,S=w+(v<<16&4294967295|v>>>16),v=E+(S^w^I)+C[2]+3299628645&4294967295,E=S+(v<<23&4294967295|v>>>9),v=I+(S^(E|~w))+C[0]+4096336452&4294967295,I=E+(v<<6&4294967295|v>>>26),v=w+(E^(I|~S))+C[7]+1126891415&4294967295,w=I+(v<<10&4294967295|v>>>22),v=S+(I^(w|~E))+C[14]+2878612391&4294967295,S=w+(v<<15&4294967295|v>>>17),v=E+(w^(S|~I))+C[5]+4237533241&4294967295,E=S+(v<<21&4294967295|v>>>11),v=I+(S^(E|~w))+C[12]+1700485571&4294967295,I=E+(v<<6&4294967295|v>>>26),v=w+(E^(I|~S))+C[3]+2399980690&4294967295,w=I+(v<<10&4294967295|v>>>22),v=S+(I^(w|~E))+C[10]+4293915773&4294967295,S=w+(v<<15&4294967295|v>>>17),v=E+(w^(S|~I))+C[1]+2240044497&4294967295,E=S+(v<<21&4294967295|v>>>11),v=I+(S^(E|~w))+C[8]+1873313359&4294967295,I=E+(v<<6&4294967295|v>>>26),v=w+(E^(I|~S))+C[15]+4264355552&4294967295,w=I+(v<<10&4294967295|v>>>22),v=S+(I^(w|~E))+C[6]+2734768916&4294967295,S=w+(v<<15&4294967295|v>>>17),v=E+(w^(S|~I))+C[13]+1309151649&4294967295,E=S+(v<<21&4294967295|v>>>11),v=I+(S^(E|~w))+C[4]+4149444226&4294967295,I=E+(v<<6&4294967295|v>>>26),v=w+(E^(I|~S))+C[11]+3174756917&4294967295,w=I+(v<<10&4294967295|v>>>22),v=S+(I^(w|~E))+C[2]+718787259&4294967295,S=w+(v<<15&4294967295|v>>>17),v=E+(w^(S|~I))+C[9]+3951481745&4294967295,A.g[0]=A.g[0]+I&4294967295,A.g[1]=A.g[1]+(S+(v<<21&4294967295|v>>>11))&4294967295,A.g[2]=A.g[2]+S&4294967295,A.g[3]=A.g[3]+w&4294967295}i.prototype.v=function(A,I){I===void 0&&(I=A.length);const E=I-this.blockSize,C=this.C;let S=this.h,w=0;for(;w<I;){if(S==0)for(;w<=E;)o(this,A,w),w+=this.blockSize;if(typeof A=="string"){for(;w<I;)if(C[S++]=A.charCodeAt(w++),S==this.blockSize){o(this,C),S=0;break}}else for(;w<I;)if(C[S++]=A[w++],S==this.blockSize){o(this,C),S=0;break}}this.h=S,this.o+=I},i.prototype.A=function(){var A=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);A[0]=128;for(var I=1;I<A.length-8;++I)A[I]=0;I=this.o*8;for(var E=A.length-8;E<A.length;++E)A[E]=I&255,I/=256;for(this.v(A),A=Array(16),I=0,E=0;E<4;++E)for(let C=0;C<32;C+=8)A[I++]=this.g[E]>>>C&255;return A};function s(A,I){var E=c;return Object.prototype.hasOwnProperty.call(E,A)?E[A]:E[A]=I(A)}function r(A,I){this.h=I;const E=[];let C=!0;for(let S=A.length-1;S>=0;S--){const w=A[S]|0;C&&w==I||(E[S]=w,C=!1)}this.g=E}var c={};function f(A){return-128<=A&&A<128?s(A,function(I){return new r([I|0],I<0?-1:0)}):new r([A|0],A<0?-1:0)}function d(A){if(isNaN(A)||!isFinite(A))return m;if(A<0)return N(d(-A));const I=[];let E=1;for(let C=0;A>=E;C++)I[C]=A/E|0,E*=4294967296;return new r(I,0)}function h(A,I){if(A.length==0)throw Error("number format error: empty string");if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(A.charAt(0)=="-")return N(h(A.substring(1),I));if(A.indexOf("-")>=0)throw Error('number format error: interior "-" character');const E=d(Math.pow(I,8));let C=m;for(let w=0;w<A.length;w+=8){var S=Math.min(8,A.length-w);const v=parseInt(A.substring(w,w+S),I);S<8?(S=d(Math.pow(I,S)),C=C.j(S).add(d(v))):(C=C.j(E),C=C.add(d(v)))}return C}var m=f(0),g=f(1),T=f(16777216);n=r.prototype,n.m=function(){if(M(this))return-N(this).m();let A=0,I=1;for(let E=0;E<this.g.length;E++){const C=this.i(E);A+=(C>=0?C:4294967296+C)*I,I*=4294967296}return A},n.toString=function(A){if(A=A||10,A<2||36<A)throw Error("radix out of range: "+A);if(P(this))return"0";if(M(this))return"-"+N(this).toString(A);const I=d(Math.pow(A,6));var E=this;let C="";for(;;){const S=H(E,I).g;E=V(E,S.j(I));let w=((E.g.length>0?E.g[0]:E.h)>>>0).toString(A);if(E=S,P(E))return w+C;for(;w.length<6;)w="0"+w;C=w+C}},n.i=function(A){return A<0?0:A<this.g.length?this.g[A]:this.h};function P(A){if(A.h!=0)return!1;for(let I=0;I<A.g.length;I++)if(A.g[I]!=0)return!1;return!0}function M(A){return A.h==-1}n.l=function(A){return A=V(this,A),M(A)?-1:P(A)?0:1};function N(A){const I=A.g.length,E=[];for(let C=0;C<I;C++)E[C]=~A.g[C];return new r(E,~A.h).add(g)}n.abs=function(){return M(this)?N(this):this},n.add=function(A){const I=Math.max(this.g.length,A.g.length),E=[];let C=0;for(let S=0;S<=I;S++){let w=C+(this.i(S)&65535)+(A.i(S)&65535),v=(w>>>16)+(this.i(S)>>>16)+(A.i(S)>>>16);C=v>>>16,w&=65535,v&=65535,E[S]=v<<16|w}return new r(E,E[E.length-1]&-2147483648?-1:0)};function V(A,I){return A.add(N(I))}n.j=function(A){if(P(this)||P(A))return m;if(M(this))return M(A)?N(this).j(N(A)):N(N(this).j(A));if(M(A))return N(this.j(N(A)));if(this.l(T)<0&&A.l(T)<0)return d(this.m()*A.m());const I=this.g.length+A.g.length,E=[];for(var C=0;C<2*I;C++)E[C]=0;for(C=0;C<this.g.length;C++)for(let S=0;S<A.g.length;S++){const w=this.i(C)>>>16,v=this.i(C)&65535,re=A.i(S)>>>16,$e=A.i(S)&65535;E[2*C+2*S]+=v*$e,L(E,2*C+2*S),E[2*C+2*S+1]+=w*$e,L(E,2*C+2*S+1),E[2*C+2*S+1]+=v*re,L(E,2*C+2*S+1),E[2*C+2*S+2]+=w*re,L(E,2*C+2*S+2)}for(A=0;A<I;A++)E[A]=E[2*A+1]<<16|E[2*A];for(A=I;A<2*I;A++)E[A]=0;return new r(E,0)};function L(A,I){for(;(A[I]&65535)!=A[I];)A[I+1]+=A[I]>>>16,A[I]&=65535,I++}function b(A,I){this.g=A,this.h=I}function H(A,I){if(P(I))throw Error("division by zero");if(P(A))return new b(m,m);if(M(A))return I=H(N(A),I),new b(N(I.g),N(I.h));if(M(I))return I=H(A,N(I)),new b(N(I.g),I.h);if(A.g.length>30){if(M(A)||M(I))throw Error("slowDivide_ only works with positive integers.");for(var E=g,C=I;C.l(A)<=0;)E=z(E),C=z(C);var S=$(E,1),w=$(C,1);for(C=$(C,2),E=$(E,2);!P(C);){var v=w.add(C);v.l(A)<=0&&(S=S.add(E),w=v),C=$(C,1),E=$(E,1)}return I=V(A,S.j(I)),new b(S,I)}for(S=m;A.l(I)>=0;){for(E=Math.max(1,Math.floor(A.m()/I.m())),C=Math.ceil(Math.log(E)/Math.LN2),C=C<=48?1:Math.pow(2,C-48),w=d(E),v=w.j(I);M(v)||v.l(A)>0;)E-=C,w=d(E),v=w.j(I);P(w)&&(w=g),S=S.add(w),A=V(A,v)}return new b(S,A)}n.B=function(A){return H(this,A).h},n.and=function(A){const I=Math.max(this.g.length,A.g.length),E=[];for(let C=0;C<I;C++)E[C]=this.i(C)&A.i(C);return new r(E,this.h&A.h)},n.or=function(A){const I=Math.max(this.g.length,A.g.length),E=[];for(let C=0;C<I;C++)E[C]=this.i(C)|A.i(C);return new r(E,this.h|A.h)},n.xor=function(A){const I=Math.max(this.g.length,A.g.length),E=[];for(let C=0;C<I;C++)E[C]=this.i(C)^A.i(C);return new r(E,this.h^A.h)};function z(A){const I=A.g.length+1,E=[];for(let C=0;C<I;C++)E[C]=A.i(C)<<1|A.i(C-1)>>>31;return new r(E,A.h)}function $(A,I){const E=I>>5;I%=32;const C=A.g.length-E,S=[];for(let w=0;w<C;w++)S[w]=I>0?A.i(w+E)>>>I|A.i(w+E+1)<<32-I:A.i(w+E);return new r(S,A.h)}i.prototype.digest=i.prototype.A,i.prototype.reset=i.prototype.u,i.prototype.update=i.prototype.v,xc=i,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.B,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=d,r.fromString=h,gt=r}).apply(typeof Ya<"u"?Ya:typeof self<"u"?self:typeof window<"u"?window:{});var wi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var kc,Un,bc,xi,gs,Lc,Fc,Uc;(function(){var n,e=Object.defineProperty;function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof wi=="object"&&wi];for(var p=0;p<u.length;++p){var y=u[p];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var i=t(this);function o(u,p){if(p)e:{var y=i;u=u.split(".");for(var _=0;_<u.length-1;_++){var R=u[_];if(!(R in y))break e;y=y[R]}u=u[u.length-1],_=y[u],p=p(_),p!=_&&p!=null&&e(y,u,{configurable:!0,writable:!0,value:p})}}o("Symbol.dispose",function(u){return u||Symbol("Symbol.dispose")}),o("Array.prototype.values",function(u){return u||function(){return this[Symbol.iterator]()}}),o("Object.entries",function(u){return u||function(p){var y=[],_;for(_ in p)Object.prototype.hasOwnProperty.call(p,_)&&y.push([_,p[_]]);return y}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},r=this||self;function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function f(u,p,y){return u.call.apply(u.bind,arguments)}function d(u,p,y){return d=f,d.apply(null,arguments)}function h(u,p){var y=Array.prototype.slice.call(arguments,1);return function(){var _=y.slice();return _.push.apply(_,arguments),u.apply(this,_)}}function m(u,p){function y(){}y.prototype=p.prototype,u.Z=p.prototype,u.prototype=new y,u.prototype.constructor=u,u.Ob=function(_,R,D){for(var q=Array(arguments.length-2),Q=2;Q<arguments.length;Q++)q[Q-2]=arguments[Q];return p.prototype[R].apply(_,q)}}var g=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?u=>u&&AsyncContext.Snapshot.wrap(u):u=>u;function T(u){const p=u.length;if(p>0){const y=Array(p);for(let _=0;_<p;_++)y[_]=u[_];return y}return[]}function P(u,p){for(let _=1;_<arguments.length;_++){const R=arguments[_];var y=typeof R;if(y=y!="object"?y:R?Array.isArray(R)?"array":y:"null",y=="array"||y=="object"&&typeof R.length=="number"){y=u.length||0;const D=R.length||0;u.length=y+D;for(let q=0;q<D;q++)u[y+q]=R[q]}else u.push(R)}}class M{constructor(p,y){this.i=p,this.j=y,this.h=0,this.g=null}get(){let p;return this.h>0?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function N(u){r.setTimeout(()=>{throw u},0)}function V(){var u=A;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class L{constructor(){this.h=this.g=null}add(p,y){const _=b.get();_.set(p,y),this.h?this.h.next=_:this.g=_,this.h=_}}var b=new M(()=>new H,u=>u.reset());class H{constructor(){this.next=this.g=this.h=null}set(p,y){this.h=p,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let z,$=!1,A=new L,I=()=>{const u=Promise.resolve(void 0);z=()=>{u.then(E)}};function E(){for(var u;u=V();){try{u.h.call(u.g)}catch(y){N(y)}var p=b;p.j(u),p.h<100&&(p.h++,u.next=p.g,p.g=u)}$=!1}function C(){this.u=this.u,this.C=this.C}C.prototype.u=!1,C.prototype.dispose=function(){this.u||(this.u=!0,this.N())},C.prototype[Symbol.dispose]=function(){this.dispose()},C.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function S(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}S.prototype.h=function(){this.defaultPrevented=!0};var w=(function(){if(!r.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const y=()=>{};r.addEventListener("test",y,p),r.removeEventListener("test",y,p)}catch{}return u})();function v(u){return/^[\s\xa0]*$/.test(u)}function re(u,p){S.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u&&this.init(u,p)}m(re,S),re.prototype.init=function(u,p){const y=this.type=u.type,_=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget,p||(y=="mouseover"?p=u.fromElement:y=="mouseout"&&(p=u.toElement)),this.relatedTarget=p,_?(this.clientX=_.clientX!==void 0?_.clientX:_.pageX,this.clientY=_.clientY!==void 0?_.clientY:_.pageY,this.screenX=_.screenX||0,this.screenY=_.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=u.pointerType,this.state=u.state,this.i=u,u.defaultPrevented&&re.Z.h.call(this)},re.prototype.h=function(){re.Z.h.call(this);const u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var $e="closure_listenable_"+(Math.random()*1e6|0),Ge=0;function Tn(u,p,y,_,R){this.listener=u,this.proxy=null,this.src=p,this.type=y,this.capture=!!_,this.ha=R,this.key=++Ge,this.da=this.fa=!1}function di(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function fi(u,p,y){for(const _ in u)p.call(y,u[_],_,u)}function $f(u,p){for(const y in u)p.call(void 0,u[y],y,u)}function Fr(u){const p={};for(const y in u)p[y]=u[y];return p}const Ur="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function qr(u,p){let y,_;for(let R=1;R<arguments.length;R++){_=arguments[R];for(y in _)u[y]=_[y];for(let D=0;D<Ur.length;D++)y=Ur[D],Object.prototype.hasOwnProperty.call(_,y)&&(u[y]=_[y])}}function hi(u){this.src=u,this.g={},this.h=0}hi.prototype.add=function(u,p,y,_,R){const D=u.toString();u=this.g[D],u||(u=this.g[D]=[],this.h++);const q=Do(u,p,_,R);return q>-1?(p=u[q],y||(p.fa=!1)):(p=new Tn(p,this.src,D,!!_,R),p.fa=y,u.push(p)),p};function Mo(u,p){const y=p.type;if(y in u.g){var _=u.g[y],R=Array.prototype.indexOf.call(_,p,void 0),D;(D=R>=0)&&Array.prototype.splice.call(_,R,1),D&&(di(p),u.g[y].length==0&&(delete u.g[y],u.h--))}}function Do(u,p,y,_){for(let R=0;R<u.length;++R){const D=u[R];if(!D.da&&D.listener==p&&D.capture==!!y&&D.ha==_)return R}return-1}var Vo="closure_lm_"+(Math.random()*1e6|0),xo={};function Br(u,p,y,_,R){if(Array.isArray(p)){for(let D=0;D<p.length;D++)Br(u,p[D],y,_,R);return null}return y=Hr(y),u&&u[$e]?u.J(p,y,c(_)?!!_.capture:!1,R):Jf(u,p,y,!1,_,R)}function Jf(u,p,y,_,R,D){if(!p)throw Error("Invalid event type");const q=c(R)?!!R.capture:!!R;let Q=bo(u);if(Q||(u[Vo]=Q=new hi(u)),y=Q.add(p,y,_,q,D),y.proxy)return y;if(_=zf(),y.proxy=_,_.src=u,_.listener=y,u.addEventListener)w||(R=q),R===void 0&&(R=!1),u.addEventListener(p.toString(),_,R);else if(u.attachEvent)u.attachEvent(Or(p.toString()),_);else if(u.addListener&&u.removeListener)u.addListener(_);else throw Error("addEventListener and attachEvent are unavailable.");return y}function zf(){function u(y){return p.call(u.src,u.listener,y)}const p=Kf;return u}function Gr(u,p,y,_,R){if(Array.isArray(p))for(var D=0;D<p.length;D++)Gr(u,p[D],y,_,R);else _=c(_)?!!_.capture:!!_,y=Hr(y),u&&u[$e]?(u=u.i,D=String(p).toString(),D in u.g&&(p=u.g[D],y=Do(p,y,_,R),y>-1&&(di(p[y]),Array.prototype.splice.call(p,y,1),p.length==0&&(delete u.g[D],u.h--)))):u&&(u=bo(u))&&(p=u.g[p.toString()],u=-1,p&&(u=Do(p,y,_,R)),(y=u>-1?p[u]:null)&&ko(y))}function ko(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[$e])Mo(p.i,u);else{var y=u.type,_=u.proxy;p.removeEventListener?p.removeEventListener(y,_,u.capture):p.detachEvent?p.detachEvent(Or(y),_):p.addListener&&p.removeListener&&p.removeListener(_),(y=bo(p))?(Mo(y,u),y.h==0&&(y.src=null,p[Vo]=null)):di(u)}}}function Or(u){return u in xo?xo[u]:xo[u]="on"+u}function Kf(u,p){if(u.da)u=!0;else{p=new re(p,this);const y=u.listener,_=u.ha||u.src;u.fa&&ko(u),u=y.call(_,p)}return u}function bo(u){return u=u[Vo],u instanceof hi?u:null}var Lo="__closure_events_fn_"+(Math.random()*1e9>>>0);function Hr(u){return typeof u=="function"?u:(u[Lo]||(u[Lo]=function(p){return u.handleEvent(p)}),u[Lo])}function Se(){C.call(this),this.i=new hi(this),this.M=this,this.G=null}m(Se,C),Se.prototype[$e]=!0,Se.prototype.removeEventListener=function(u,p,y,_){Gr(this,u,p,y,_)};function Me(u,p){var y,_=u.G;if(_)for(y=[];_;_=_.G)y.push(_);if(u=u.M,_=p.type||p,typeof p=="string")p=new S(p,u);else if(p instanceof S)p.target=p.target||u;else{var R=p;p=new S(_,u),qr(p,R)}R=!0;let D,q;if(y)for(q=y.length-1;q>=0;q--)D=p.g=y[q],R=pi(D,_,!0,p)&&R;if(D=p.g=u,R=pi(D,_,!0,p)&&R,R=pi(D,_,!1,p)&&R,y)for(q=0;q<y.length;q++)D=p.g=y[q],R=pi(D,_,!1,p)&&R}Se.prototype.N=function(){if(Se.Z.N.call(this),this.i){var u=this.i;for(const p in u.g){const y=u.g[p];for(let _=0;_<y.length;_++)di(y[_]);delete u.g[p],u.h--}}this.G=null},Se.prototype.J=function(u,p,y,_){return this.i.add(String(u),p,!1,y,_)},Se.prototype.K=function(u,p,y,_){return this.i.add(String(u),p,!0,y,_)};function pi(u,p,y,_){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();let R=!0;for(let D=0;D<p.length;++D){const q=p[D];if(q&&!q.da&&q.capture==y){const Q=q.listener,ye=q.ha||q.src;q.fa&&Mo(u.i,q),R=Q.call(ye,_)!==!1&&R}}return R&&!_.defaultPrevented}function Wf(u,p){if(typeof u!="function")if(u&&typeof u.handleEvent=="function")u=d(u.handleEvent,u);else throw Error("Invalid listener argument");return Number(p)>2147483647?-1:r.setTimeout(u,p||0)}function $r(u){u.g=Wf(()=>{u.g=null,u.i&&(u.i=!1,$r(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class Yf extends C{constructor(p,y){super(),this.m=p,this.l=y,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:$r(this)}N(){super.N(),this.g&&(r.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function En(u){C.call(this),this.h=u,this.g={}}m(En,C);var Jr=[];function zr(u){fi(u.g,function(p,y){this.g.hasOwnProperty(y)&&ko(p)},u),u.g={}}En.prototype.N=function(){En.Z.N.call(this),zr(this)},En.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Fo=r.JSON.stringify,Qf=r.JSON.parse,Xf=class{stringify(u){return r.JSON.stringify(u,void 0)}parse(u){return r.JSON.parse(u,void 0)}};function Kr(){}function Wr(){}var In={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Uo(){S.call(this,"d")}m(Uo,S);function qo(){S.call(this,"c")}m(qo,S);var Nt={},Yr=null;function mi(){return Yr=Yr||new Se}Nt.Ia="serverreachability";function Qr(u){S.call(this,Nt.Ia,u)}m(Qr,S);function vn(u){const p=mi();Me(p,new Qr(p))}Nt.STAT_EVENT="statevent";function Xr(u,p){S.call(this,Nt.STAT_EVENT,u),this.stat=p}m(Xr,S);function De(u){const p=mi();Me(p,new Xr(p,u))}Nt.Ja="timingevent";function Zr(u,p){S.call(this,Nt.Ja,u),this.size=p}m(Zr,S);function An(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return r.setTimeout(function(){u()},p)}function Cn(){this.g=!0}Cn.prototype.ua=function(){this.g=!1};function Zf(u,p,y,_,R,D){u.info(function(){if(u.g)if(D){var q="",Q=D.split("&");for(let ie=0;ie<Q.length;ie++){var ye=Q[ie].split("=");if(ye.length>1){const Te=ye[0];ye=ye[1];const ze=Te.split("_");q=ze.length>=2&&ze[1]=="type"?q+(Te+"="+ye+"&"):q+(Te+"=redacted&")}}}else q=null;else q=D;return"XMLHTTP REQ ("+_+") [attempt "+R+"]: "+p+`
`+y+`
`+q})}function jf(u,p,y,_,R,D,q){u.info(function(){return"XMLHTTP RESP ("+_+") [ attempt "+R+"]: "+p+`
`+y+`
`+D+" "+q})}function Ht(u,p,y,_){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+th(u,y)+(_?" "+_:"")})}function eh(u,p){u.info(function(){return"TIMEOUT: "+p})}Cn.prototype.info=function(){};function th(u,p){if(!u.g)return p;if(!p)return null;try{const D=JSON.parse(p);if(D){for(u=0;u<D.length;u++)if(Array.isArray(D[u])){var y=D[u];if(!(y.length<2)){var _=y[1];if(Array.isArray(_)&&!(_.length<1)){var R=_[0];if(R!="noop"&&R!="stop"&&R!="close")for(let q=1;q<_.length;q++)_[q]=""}}}}return Fo(D)}catch{return p}}var gi={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},jr={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},ea;function Bo(){}m(Bo,Kr),Bo.prototype.g=function(){return new XMLHttpRequest},ea=new Bo;function Sn(u){return encodeURIComponent(String(u))}function nh(u){var p=1;u=u.split(":");const y=[];for(;p>0&&u.length;)y.push(u.shift()),p--;return u.length&&y.push(u.join(":")),y}function rt(u,p,y,_){this.j=u,this.i=p,this.l=y,this.S=_||1,this.V=new En(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ta}function ta(){this.i=null,this.g="",this.h=!1}var na={},Go={};function Oo(u,p,y){u.M=1,u.A=_i(Je(p)),u.u=y,u.R=!0,ia(u,null)}function ia(u,p){u.F=Date.now(),yi(u),u.B=Je(u.A);var y=u.B,_=u.S;Array.isArray(_)||(_=[String(_)]),ga(y.i,"t",_),u.C=0,y=u.j.L,u.h=new ta,u.g=ka(u.j,y?p:null,!u.u),u.P>0&&(u.O=new Yf(d(u.Y,u,u.g),u.P)),p=u.V,y=u.g,_=u.ba;var R="readystatechange";Array.isArray(R)||(R&&(Jr[0]=R.toString()),R=Jr);for(let D=0;D<R.length;D++){const q=Br(y,R[D],_||p.handleEvent,!1,p.h||p);if(!q)break;p.g[q.key]=q}p=u.J?Fr(u.J):{},u.u?(u.v||(u.v="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.B,u.v,u.u,p)):(u.v="GET",u.g.ea(u.B,u.v,null,p)),vn(),Zf(u.i,u.v,u.B,u.l,u.S,u.u)}rt.prototype.ba=function(u){u=u.target;const p=this.O;p&&ut(u)==3?p.j():this.Y(u)},rt.prototype.Y=function(u){try{if(u==this.g)e:{const Q=ut(this.g),ye=this.g.ya(),ie=this.g.ca();if(!(Q<3)&&(Q!=3||this.g&&(this.h.h||this.g.la()||Aa(this.g)))){this.K||Q!=4||ye==7||(ye==8||ie<=0?vn(3):vn(2)),Ho(this);var p=this.g.ca();this.X=p;var y=ih(this);if(this.o=p==200,jf(this.i,this.v,this.B,this.l,this.S,Q,p),this.o){if(this.U&&!this.L){t:{if(this.g){var _,R=this.g;if((_=R.g?R.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!v(_)){var D=_;break t}}D=null}if(u=D)Ht(this.i,this.l,u,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,$o(this,u);else{this.o=!1,this.m=3,De(12),Mt(this),wn(this);break e}}if(this.R){u=!0;let Te;for(;!this.K&&this.C<y.length;)if(Te=oh(this,y),Te==Go){Q==4&&(this.m=4,De(14),u=!1),Ht(this.i,this.l,null,"[Incomplete Response]");break}else if(Te==na){this.m=4,De(15),Ht(this.i,this.l,y,"[Invalid Chunk]"),u=!1;break}else Ht(this.i,this.l,Te,null),$o(this,Te);if(oa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Q!=4||y.length!=0||this.h.h||(this.m=1,De(16),u=!1),this.o=this.o&&u,!u)Ht(this.i,this.l,y,"[Invalid Chunked Response]"),Mt(this),wn(this);else if(y.length>0&&!this.W){this.W=!0;var q=this.j;q.g==this&&q.aa&&!q.P&&(q.j.info("Great, no buffering proxy detected. Bytes received: "+y.length),Zo(q),q.P=!0,De(11))}}else Ht(this.i,this.l,y,null),$o(this,y);Q==4&&Mt(this),this.o&&!this.K&&(Q==4?Ma(this.j,this):(this.o=!1,yi(this)))}else _h(this.g),p==400&&y.indexOf("Unknown SID")>0?(this.m=3,De(12)):(this.m=0,De(13)),Mt(this),wn(this)}}}catch{}finally{}};function ih(u){if(!oa(u))return u.g.la();const p=Aa(u.g);if(p==="")return"";let y="";const _=p.length,R=ut(u.g)==4;if(!u.h.i){if(typeof TextDecoder>"u")return Mt(u),wn(u),"";u.h.i=new r.TextDecoder}for(let D=0;D<_;D++)u.h.h=!0,y+=u.h.i.decode(p[D],{stream:!(R&&D==_-1)});return p.length=0,u.h.g+=y,u.C=0,u.h.g}function oa(u){return u.g?u.v=="GET"&&u.M!=2&&u.j.Aa:!1}function oh(u,p){var y=u.C,_=p.indexOf(`
`,y);return _==-1?Go:(y=Number(p.substring(y,_)),isNaN(y)?na:(_+=1,_+y>p.length?Go:(p=p.slice(_,_+y),u.C=_+y,p)))}rt.prototype.cancel=function(){this.K=!0,Mt(this)};function yi(u){u.T=Date.now()+u.H,sa(u,u.H)}function sa(u,p){if(u.D!=null)throw Error("WatchDog timer not null");u.D=An(d(u.aa,u),p)}function Ho(u){u.D&&(r.clearTimeout(u.D),u.D=null)}rt.prototype.aa=function(){this.D=null;const u=Date.now();u-this.T>=0?(eh(this.i,this.B),this.M!=2&&(vn(),De(17)),Mt(this),this.m=2,wn(this)):sa(this,this.T-u)};function wn(u){u.j.I==0||u.K||Ma(u.j,u)}function Mt(u){Ho(u);var p=u.O;p&&typeof p.dispose=="function"&&p.dispose(),u.O=null,zr(u.V),u.g&&(p=u.g,u.g=null,p.abort(),p.dispose())}function $o(u,p){try{var y=u.j;if(y.I!=0&&(y.g==u||Jo(y.h,u))){if(!u.L&&Jo(y.h,u)&&y.I==3){try{var _=y.Ba.g.parse(p)}catch{_=null}if(Array.isArray(_)&&_.length==3){var R=_;if(R[0]==0){e:if(!y.v){if(y.g)if(y.g.F+3e3<u.F)Ai(y),Ii(y);else break e;Xo(y),De(18)}}else y.xa=R[1],0<y.xa-y.K&&R[2]<37500&&y.F&&y.A==0&&!y.C&&(y.C=An(d(y.Va,y),6e3));la(y.h)<=1&&y.ta&&(y.ta=void 0)}else Vt(y,11)}else if((u.L||y.g==u)&&Ai(y),!v(p))for(R=y.Ba.g.parse(p),p=0;p<R.length;p++){let ie=R[p];const Te=ie[0];if(!(Te<=y.K))if(y.K=Te,ie=ie[1],y.I==2)if(ie[0]=="c"){y.M=ie[1],y.ba=ie[2];const ze=ie[3];ze!=null&&(y.ka=ze,y.j.info("VER="+y.ka));const xt=ie[4];xt!=null&&(y.za=xt,y.j.info("SVER="+y.za));const ct=ie[5];ct!=null&&typeof ct=="number"&&ct>0&&(_=1.5*ct,y.O=_,y.j.info("backChannelRequestTimeoutMs_="+_)),_=y;const dt=u.g;if(dt){const Si=dt.g?dt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Si){var D=_.h;D.g||Si.indexOf("spdy")==-1&&Si.indexOf("quic")==-1&&Si.indexOf("h2")==-1||(D.j=D.l,D.g=new Set,D.h&&(zo(D,D.h),D.h=null))}if(_.G){const jo=dt.g?dt.g.getResponseHeader("X-HTTP-Session-Id"):null;jo&&(_.wa=jo,ae(_.J,_.G,jo))}}y.I=3,y.l&&y.l.ra(),y.aa&&(y.T=Date.now()-u.F,y.j.info("Handshake RTT: "+y.T+"ms")),_=y;var q=u;if(_.na=xa(_,_.L?_.ba:null,_.W),q.L){ua(_.h,q);var Q=q,ye=_.O;ye&&(Q.H=ye),Q.D&&(Ho(Q),yi(Q)),_.g=q}else Pa(_);y.i.length>0&&vi(y)}else ie[0]!="stop"&&ie[0]!="close"||Vt(y,7);else y.I==3&&(ie[0]=="stop"||ie[0]=="close"?ie[0]=="stop"?Vt(y,7):Qo(y):ie[0]!="noop"&&y.l&&y.l.qa(ie),y.A=0)}}vn(4)}catch{}}var sh=class{constructor(u,p){this.g=u,this.map=p}};function ra(u){this.l=u||10,r.PerformanceNavigationTiming?(u=r.performance.getEntriesByType("navigation"),u=u.length>0&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(r.chrome&&r.chrome.loadTimes&&r.chrome.loadTimes()&&r.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function aa(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function la(u){return u.h?1:u.g?u.g.size:0}function Jo(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function zo(u,p){u.g?u.g.add(p):u.h=p}function ua(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}ra.prototype.cancel=function(){if(this.i=ca(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function ca(u){if(u.h!=null)return u.i.concat(u.h.G);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const y of u.g.values())p=p.concat(y.G);return p}return T(u.i)}var da=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function rh(u,p){if(u){u=u.split("&");for(let y=0;y<u.length;y++){const _=u[y].indexOf("=");let R,D=null;_>=0?(R=u[y].substring(0,_),D=u[y].substring(_+1)):R=u[y],p(R,D?decodeURIComponent(D.replace(/\+/g," ")):"")}}}function at(u){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let p;u instanceof at?(this.l=u.l,Rn(this,u.j),this.o=u.o,this.g=u.g,Pn(this,u.u),this.h=u.h,Ko(this,ya(u.i)),this.m=u.m):u&&(p=String(u).match(da))?(this.l=!1,Rn(this,p[1]||"",!0),this.o=Nn(p[2]||""),this.g=Nn(p[3]||"",!0),Pn(this,p[4]),this.h=Nn(p[5]||"",!0),Ko(this,p[6]||"",!0),this.m=Nn(p[7]||"")):(this.l=!1,this.i=new Dn(null,this.l))}at.prototype.toString=function(){const u=[];var p=this.j;p&&u.push(Mn(p,fa,!0),":");var y=this.g;return(y||p=="file")&&(u.push("//"),(p=this.o)&&u.push(Mn(p,fa,!0),"@"),u.push(Sn(y).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.u,y!=null&&u.push(":",String(y))),(y=this.h)&&(this.g&&y.charAt(0)!="/"&&u.push("/"),u.push(Mn(y,y.charAt(0)=="/"?uh:lh,!0))),(y=this.i.toString())&&u.push("?",y),(y=this.m)&&u.push("#",Mn(y,dh)),u.join("")},at.prototype.resolve=function(u){const p=Je(this);let y=!!u.j;y?Rn(p,u.j):y=!!u.o,y?p.o=u.o:y=!!u.g,y?p.g=u.g:y=u.u!=null;var _=u.h;if(y)Pn(p,u.u);else if(y=!!u.h){if(_.charAt(0)!="/")if(this.g&&!this.h)_="/"+_;else{var R=p.h.lastIndexOf("/");R!=-1&&(_=p.h.slice(0,R+1)+_)}if(R=_,R==".."||R==".")_="";else if(R.indexOf("./")!=-1||R.indexOf("/.")!=-1){_=R.lastIndexOf("/",0)==0,R=R.split("/");const D=[];for(let q=0;q<R.length;){const Q=R[q++];Q=="."?_&&q==R.length&&D.push(""):Q==".."?((D.length>1||D.length==1&&D[0]!="")&&D.pop(),_&&q==R.length&&D.push("")):(D.push(Q),_=!0)}_=D.join("/")}else _=R}return y?p.h=_:y=u.i.toString()!=="",y?Ko(p,ya(u.i)):y=!!u.m,y&&(p.m=u.m),p};function Je(u){return new at(u)}function Rn(u,p,y){u.j=y?Nn(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function Pn(u,p){if(p){if(p=Number(p),isNaN(p)||p<0)throw Error("Bad port number "+p);u.u=p}else u.u=null}function Ko(u,p,y){p instanceof Dn?(u.i=p,fh(u.i,u.l)):(y||(p=Mn(p,ch)),u.i=new Dn(p,u.l))}function ae(u,p,y){u.i.set(p,y)}function _i(u){return ae(u,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),u}function Nn(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Mn(u,p,y){return typeof u=="string"?(u=encodeURI(u).replace(p,ah),y&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function ah(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var fa=/[#\/\?@]/g,lh=/[#\?:]/g,uh=/[#\?]/g,ch=/[#\?@]/g,dh=/#/g;function Dn(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Dt(u){u.g||(u.g=new Map,u.h=0,u.i&&rh(u.i,function(p,y){u.add(decodeURIComponent(p.replace(/\+/g," ")),y)}))}n=Dn.prototype,n.add=function(u,p){Dt(this),this.i=null,u=$t(this,u);let y=this.g.get(u);return y||this.g.set(u,y=[]),y.push(p),this.h+=1,this};function ha(u,p){Dt(u),p=$t(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function pa(u,p){return Dt(u),p=$t(u,p),u.g.has(p)}n.forEach=function(u,p){Dt(this),this.g.forEach(function(y,_){y.forEach(function(R){u.call(p,R,_,this)},this)},this)};function ma(u,p){Dt(u);let y=[];if(typeof p=="string")pa(u,p)&&(y=y.concat(u.g.get($t(u,p))));else for(u=Array.from(u.g.values()),p=0;p<u.length;p++)y=y.concat(u[p]);return y}n.set=function(u,p){return Dt(this),this.i=null,u=$t(this,u),pa(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=ma(this,u),u.length>0?String(u[0]):p):p};function ga(u,p,y){ha(u,p),y.length>0&&(u.i=null,u.g.set($t(u,p),T(y)),u.h+=y.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(let _=0;_<p.length;_++){var y=p[_];const R=Sn(y);y=ma(this,y);for(let D=0;D<y.length;D++){let q=R;y[D]!==""&&(q+="="+Sn(y[D])),u.push(q)}}return this.i=u.join("&")};function ya(u){const p=new Dn;return p.i=u.i,u.g&&(p.g=new Map(u.g),p.h=u.h),p}function $t(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function fh(u,p){p&&!u.j&&(Dt(u),u.i=null,u.g.forEach(function(y,_){const R=_.toLowerCase();_!=R&&(ha(this,_),ga(this,R,y))},u)),u.j=p}function hh(u,p){const y=new Cn;if(r.Image){const _=new Image;_.onload=h(lt,y,"TestLoadImage: loaded",!0,p,_),_.onerror=h(lt,y,"TestLoadImage: error",!1,p,_),_.onabort=h(lt,y,"TestLoadImage: abort",!1,p,_),_.ontimeout=h(lt,y,"TestLoadImage: timeout",!1,p,_),r.setTimeout(function(){_.ontimeout&&_.ontimeout()},1e4),_.src=u}else p(!1)}function ph(u,p){const y=new Cn,_=new AbortController,R=setTimeout(()=>{_.abort(),lt(y,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:_.signal}).then(D=>{clearTimeout(R),D.ok?lt(y,"TestPingServer: ok",!0,p):lt(y,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(R),lt(y,"TestPingServer: error",!1,p)})}function lt(u,p,y,_,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),_(y)}catch{}}function mh(){this.g=new Xf}function Wo(u){this.i=u.Sb||null,this.h=u.ab||!1}m(Wo,Kr),Wo.prototype.g=function(){return new Ti(this.i,this.h)};function Ti(u,p){Se.call(this),this.H=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(Ti,Se),n=Ti.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=u,this.D=p,this.readyState=1,xn(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const p={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};u&&(p.body=u),(this.H||r).fetch(new Request(this.D,p)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Vn(this)),this.readyState=0},n.Pa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,xn(this)),this.g&&(this.readyState=3,xn(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof r.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;_a(this)}else u.text().then(this.Oa.bind(this),this.ga.bind(this))};function _a(u){u.j.read().then(u.Ma.bind(u)).catch(u.ga.bind(u))}n.Ma=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.B.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?Vn(this):xn(this),this.readyState==3&&_a(this)}},n.Oa=function(u){this.g&&(this.response=this.responseText=u,Vn(this))},n.Na=function(u){this.g&&(this.response=u,Vn(this))},n.ga=function(){this.g&&Vn(this)};function Vn(u){u.readyState=4,u.l=null,u.j=null,u.B=null,xn(u)}n.setRequestHeader=function(u,p){this.A.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var y=p.next();!y.done;)y=y.value,u.push(y[0]+": "+y[1]),y=p.next();return u.join(`\r
`)};function xn(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Ti.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function Ta(u){let p="";return fi(u,function(y,_){p+=_,p+=":",p+=y,p+=`\r
`}),p}function Yo(u,p,y){e:{for(_ in y){var _=!1;break e}_=!0}_||(y=Ta(y),typeof u=="string"?y!=null&&Sn(y):ae(u,p,y))}function de(u){Se.call(this),this.headers=new Map,this.L=u||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(de,Se);var gh=/^https?$/i,yh=["POST","PUT"];n=de.prototype,n.Fa=function(u){this.H=u},n.ea=function(u,p,y,_){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ea.g(),this.g.onreadystatechange=g(d(this.Ca,this));try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(D){Ea(this,D);return}if(u=y||"",y=new Map(this.headers),_)if(Object.getPrototypeOf(_)===Object.prototype)for(var R in _)y.set(R,_[R]);else if(typeof _.keys=="function"&&typeof _.get=="function")for(const D of _.keys())y.set(D,_.get(D));else throw Error("Unknown input type for opt_headers: "+String(_));_=Array.from(y.keys()).find(D=>D.toLowerCase()=="content-type"),R=r.FormData&&u instanceof r.FormData,!(Array.prototype.indexOf.call(yh,p,void 0)>=0)||_||R||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[D,q]of y)this.g.setRequestHeader(D,q);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(u),this.v=!1}catch(D){Ea(this,D)}};function Ea(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.o=5,Ia(u),Ei(u)}function Ia(u){u.A||(u.A=!0,Me(u,"complete"),Me(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=u||7,Me(this,"complete"),Me(this,"abort"),Ei(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ei(this,!0)),de.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?va(this):this.Xa())},n.Xa=function(){va(this)};function va(u){if(u.h&&typeof s<"u"){if(u.v&&ut(u)==4)setTimeout(u.Ca.bind(u),0);else if(Me(u,"readystatechange"),ut(u)==4){u.h=!1;try{const D=u.ca();e:switch(D){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var y;if(!(y=p)){var _;if(_=D===0){let q=String(u.D).match(da)[1]||null;!q&&r.self&&r.self.location&&(q=r.self.location.protocol.slice(0,-1)),_=!gh.test(q?q.toLowerCase():"")}y=_}if(y)Me(u,"complete"),Me(u,"success");else{u.o=6;try{var R=ut(u)>2?u.g.statusText:""}catch{R=""}u.l=R+" ["+u.ca()+"]",Ia(u)}}finally{Ei(u)}}}}function Ei(u,p){if(u.g){u.m&&(clearTimeout(u.m),u.m=null);const y=u.g;u.g=null,p||Me(u,"ready");try{y.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function ut(u){return u.g?u.g.readyState:0}n.ca=function(){try{return ut(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),Qf(p)}};function Aa(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.F){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function _h(u){const p={};u=(u.g&&ut(u)>=2&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let _=0;_<u.length;_++){if(v(u[_]))continue;var y=nh(u[_]);const R=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const D=p[R]||[];p[R]=D,D.push(y)}$f(p,function(_){return _.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function kn(u,p,y){return y&&y.internalChannelParams&&y.internalChannelParams[u]||p}function Ca(u){this.za=0,this.i=[],this.j=new Cn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=kn("failFast",!1,u),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=kn("baseRetryDelayMs",5e3,u),this.Za=kn("retryDelaySeedMs",1e4,u),this.Ta=kn("forwardChannelMaxRetries",2,u),this.va=kn("forwardChannelRequestTimeoutMs",2e4,u),this.ma=u&&u.xmlHttpFactory||void 0,this.Ua=u&&u.Rb||void 0,this.Aa=u&&u.useFetchStreams||!1,this.O=void 0,this.L=u&&u.supportsCrossDomainXhr||!1,this.M="",this.h=new ra(u&&u.concurrentRequestLimit),this.Ba=new mh,this.S=u&&u.fastHandshake||!1,this.R=u&&u.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=u&&u.Pb||!1,u&&u.ua&&this.j.ua(),u&&u.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&u&&u.detectBufferingProxy||!1,this.ia=void 0,u&&u.longPollingTimeout&&u.longPollingTimeout>0&&(this.ia=u.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Ca.prototype,n.ka=8,n.I=1,n.connect=function(u,p,y,_){De(0),this.W=u,this.H=p||{},y&&_!==void 0&&(this.H.OSID=y,this.H.OAID=_),this.F=this.X,this.J=xa(this,null,this.W),vi(this)};function Qo(u){if(Sa(u),u.I==3){var p=u.V++,y=Je(u.J);if(ae(y,"SID",u.M),ae(y,"RID",p),ae(y,"TYPE","terminate"),bn(u,y),p=new rt(u,u.j,p),p.M=2,p.A=_i(Je(y)),y=!1,r.navigator&&r.navigator.sendBeacon)try{y=r.navigator.sendBeacon(p.A.toString(),"")}catch{}!y&&r.Image&&(new Image().src=p.A,y=!0),y||(p.g=ka(p.j,null),p.g.ea(p.A)),p.F=Date.now(),yi(p)}Va(u)}function Ii(u){u.g&&(Zo(u),u.g.cancel(),u.g=null)}function Sa(u){Ii(u),u.v&&(r.clearTimeout(u.v),u.v=null),Ai(u),u.h.cancel(),u.m&&(typeof u.m=="number"&&r.clearTimeout(u.m),u.m=null)}function vi(u){if(!aa(u.h)&&!u.m){u.m=!0;var p=u.Ea;z||I(),$||(z(),$=!0),A.add(p,u),u.D=0}}function Th(u,p){return la(u.h)>=u.h.j-(u.m?1:0)?!1:u.m?(u.i=p.G.concat(u.i),!0):u.I==1||u.I==2||u.D>=(u.Sa?0:u.Ta)?!1:(u.m=An(d(u.Ea,u,p),Da(u,u.D)),u.D++,!0)}n.Ea=function(u){if(this.m)if(this.m=null,this.I==1){if(!u){this.V=Math.floor(Math.random()*1e5),u=this.V++;const R=new rt(this,this.j,u);let D=this.o;if(this.U&&(D?(D=Fr(D),qr(D,this.U)):D=this.U),this.u!==null||this.R||(R.J=D,D=null),this.S)e:{for(var p=0,y=0;y<this.i.length;y++){t:{var _=this.i[y];if("__data__"in _.map&&(_=_.map.__data__,typeof _=="string")){_=_.length;break t}_=void 0}if(_===void 0)break;if(p+=_,p>4096){p=y;break e}if(p===4096||y===this.i.length-1){p=y+1;break e}}p=1e3}else p=1e3;p=Ra(this,R,p),y=Je(this.J),ae(y,"RID",u),ae(y,"CVER",22),this.G&&ae(y,"X-HTTP-Session-Id",this.G),bn(this,y),D&&(this.R?p="headers="+Sn(Ta(D))+"&"+p:this.u&&Yo(y,this.u,D)),zo(this.h,R),this.Ra&&ae(y,"TYPE","init"),this.S?(ae(y,"$req",p),ae(y,"SID","null"),R.U=!0,Oo(R,y,null)):Oo(R,y,p),this.I=2}}else this.I==3&&(u?wa(this,u):this.i.length==0||aa(this.h)||wa(this))};function wa(u,p){var y;p?y=p.l:y=u.V++;const _=Je(u.J);ae(_,"SID",u.M),ae(_,"RID",y),ae(_,"AID",u.K),bn(u,_),u.u&&u.o&&Yo(_,u.u,u.o),y=new rt(u,u.j,y,u.D+1),u.u===null&&(y.J=u.o),p&&(u.i=p.G.concat(u.i)),p=Ra(u,y,1e3),y.H=Math.round(u.va*.5)+Math.round(u.va*.5*Math.random()),zo(u.h,y),Oo(y,_,p)}function bn(u,p){u.H&&fi(u.H,function(y,_){ae(p,_,y)}),u.l&&fi({},function(y,_){ae(p,_,y)})}function Ra(u,p,y){y=Math.min(u.i.length,y);const _=u.l?d(u.l.Ka,u.l,u):null;e:{var R=u.i;let Q=-1;for(;;){const ye=["count="+y];Q==-1?y>0?(Q=R[0].g,ye.push("ofs="+Q)):Q=0:ye.push("ofs="+Q);let ie=!0;for(let Te=0;Te<y;Te++){var D=R[Te].g;const ze=R[Te].map;if(D-=Q,D<0)Q=Math.max(0,R[Te].g-100),ie=!1;else try{D="req"+D+"_"||"";try{var q=ze instanceof Map?ze:Object.entries(ze);for(const[xt,ct]of q){let dt=ct;c(ct)&&(dt=Fo(ct)),ye.push(D+xt+"="+encodeURIComponent(dt))}}catch(xt){throw ye.push(D+"type="+encodeURIComponent("_badmap")),xt}}catch{_&&_(ze)}}if(ie){q=ye.join("&");break e}}q=void 0}return u=u.i.splice(0,y),p.G=u,q}function Pa(u){if(!u.g&&!u.v){u.Y=1;var p=u.Da;z||I(),$||(z(),$=!0),A.add(p,u),u.A=0}}function Xo(u){return u.g||u.v||u.A>=3?!1:(u.Y++,u.v=An(d(u.Da,u),Da(u,u.A)),u.A++,!0)}n.Da=function(){if(this.v=null,Na(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var u=4*this.T;this.j.info("BP detection timer enabled: "+u),this.B=An(d(this.Wa,this),u)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,De(10),Ii(this),Na(this))};function Zo(u){u.B!=null&&(r.clearTimeout(u.B),u.B=null)}function Na(u){u.g=new rt(u,u.j,"rpc",u.Y),u.u===null&&(u.g.J=u.o),u.g.P=0;var p=Je(u.na);ae(p,"RID","rpc"),ae(p,"SID",u.M),ae(p,"AID",u.K),ae(p,"CI",u.F?"0":"1"),!u.F&&u.ia&&ae(p,"TO",u.ia),ae(p,"TYPE","xmlhttp"),bn(u,p),u.u&&u.o&&Yo(p,u.u,u.o),u.O&&(u.g.H=u.O);var y=u.g;u=u.ba,y.M=1,y.A=_i(Je(p)),y.u=null,y.R=!0,ia(y,u)}n.Va=function(){this.C!=null&&(this.C=null,Ii(this),Xo(this),De(19))};function Ai(u){u.C!=null&&(r.clearTimeout(u.C),u.C=null)}function Ma(u,p){var y=null;if(u.g==p){Ai(u),Zo(u),u.g=null;var _=2}else if(Jo(u.h,p))y=p.G,ua(u.h,p),_=1;else return;if(u.I!=0){if(p.o)if(_==1){y=p.u?p.u.length:0,p=Date.now()-p.F;var R=u.D;_=mi(),Me(_,new Zr(_,y)),vi(u)}else Pa(u);else if(R=p.m,R==3||R==0&&p.X>0||!(_==1&&Th(u,p)||_==2&&Xo(u)))switch(y&&y.length>0&&(p=u.h,p.i=p.i.concat(y)),R){case 1:Vt(u,5);break;case 4:Vt(u,10);break;case 3:Vt(u,6);break;default:Vt(u,2)}}}function Da(u,p){let y=u.Qa+Math.floor(Math.random()*u.Za);return u.isActive()||(y*=2),y*p}function Vt(u,p){if(u.j.info("Error code "+p),p==2){var y=d(u.bb,u),_=u.Ua;const R=!_;_=new at(_||"//www.google.com/images/cleardot.gif"),r.location&&r.location.protocol=="http"||Rn(_,"https"),_i(_),R?hh(_.toString(),y):ph(_.toString(),y)}else De(2);u.I=0,u.l&&u.l.pa(p),Va(u),Sa(u)}n.bb=function(u){u?(this.j.info("Successfully pinged google.com"),De(2)):(this.j.info("Failed to ping google.com"),De(1))};function Va(u){if(u.I=0,u.ja=[],u.l){const p=ca(u.h);(p.length!=0||u.i.length!=0)&&(P(u.ja,p),P(u.ja,u.i),u.h.i.length=0,T(u.i),u.i.length=0),u.l.oa()}}function xa(u,p,y){var _=y instanceof at?Je(y):new at(y);if(_.g!="")p&&(_.g=p+"."+_.g),Pn(_,_.u);else{var R=r.location;_=R.protocol,p=p?p+"."+R.hostname:R.hostname,R=+R.port;const D=new at(null);_&&Rn(D,_),p&&(D.g=p),R&&Pn(D,R),y&&(D.h=y),_=D}return y=u.G,p=u.wa,y&&p&&ae(_,y,p),ae(_,"VER",u.ka),bn(u,_),_}function ka(u,p,y){if(p&&!u.L)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Aa&&!u.ma?new de(new Wo({ab:y})):new de(u.ma),p.Fa(u.L),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ba(){}n=ba.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Ci(){}Ci.prototype.g=function(u,p){return new be(u,p)};function be(u,p){Se.call(this),this.g=new Ca(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.sa&&(u?u["X-WebChannel-Client-Profile"]=p.sa:u={"X-WebChannel-Client-Profile":p.sa}),this.g.U=u,(u=p&&p.Qb)&&!v(u)&&(this.g.u=u),this.A=p&&p.supportsCrossDomainXhr||!1,this.v=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!v(p)&&(this.g.G=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new Jt(this)}m(be,Se),be.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},be.prototype.close=function(){Qo(this.g)},be.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var y={};y.__data__=u,u=y}else this.v&&(y={},y.__data__=Fo(u),u=y);p.i.push(new sh(p.Ya++,u)),p.I==3&&vi(p)},be.prototype.N=function(){this.g.l=null,delete this.j,Qo(this.g),delete this.g,be.Z.N.call(this)};function La(u){Uo.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const y in p){u=y;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}m(La,Uo);function Fa(){qo.call(this),this.status=1}m(Fa,qo);function Jt(u){this.g=u}m(Jt,ba),Jt.prototype.ra=function(){Me(this.g,"a")},Jt.prototype.qa=function(u){Me(this.g,new La(u))},Jt.prototype.pa=function(u){Me(this.g,new Fa)},Jt.prototype.oa=function(){Me(this.g,"b")},Ci.prototype.createWebChannel=Ci.prototype.g,be.prototype.send=be.prototype.o,be.prototype.open=be.prototype.m,be.prototype.close=be.prototype.close,Uc=function(){return new Ci},Fc=function(){return mi()},Lc=Nt,gs={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},gi.NO_ERROR=0,gi.TIMEOUT=8,gi.HTTP_ERROR=6,xi=gi,jr.COMPLETE="complete",bc=jr,Wr.EventType=In,In.OPEN="a",In.CLOSE="b",In.ERROR="c",In.MESSAGE="d",Se.prototype.listen=Se.prototype.J,Un=Wr,de.prototype.listenOnce=de.prototype.K,de.prototype.getLastError=de.prototype.Ha,de.prototype.getLastErrorCode=de.prototype.ya,de.prototype.getStatus=de.prototype.ca,de.prototype.getResponseJson=de.prototype.La,de.prototype.getResponseText=de.prototype.la,de.prototype.send=de.prototype.ea,de.prototype.setWithCredentials=de.prototype.Fa,kc=de}).apply(typeof wi<"u"?wi:typeof self<"u"?self:typeof window<"u"?window:{});const Qa="@firebase/firestore",Xa="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Re.UNAUTHENTICATED=new Re(null),Re.GOOGLE_CREDENTIALS=new Re("google-credentials-uid"),Re.FIRST_PARTY=new Re("first-party-uid"),Re.MOCK_USER=new Re("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dn="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ut=new Rc("@firebase/firestore");function Kt(){return Ut.logLevel}function O(n,...e){if(Ut.logLevel<=ee.DEBUG){const t=e.map(zs);Ut.debug(`Firestore (${dn}): ${n}`,...t)}}function et(n,...e){if(Ut.logLevel<=ee.ERROR){const t=e.map(zs);Ut.error(`Firestore (${dn}): ${n}`,...t)}}function on(n,...e){if(Ut.logLevel<=ee.WARN){const t=e.map(zs);Ut.warn(`Firestore (${dn}): ${n}`,...t)}}function zs(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(t){return JSON.stringify(t)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,qc(n,i,t)}function qc(n,e,t){let i=`FIRESTORE (${dn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw et(i),new Error(i)}function ne(n,e,t,i){let o="Unexpected state";typeof t=="string"?o=t:i=t,n||qc(e,o,i)}function Y(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class B extends cn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class sm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Re.UNAUTHENTICATED)))}shutdown(){}}class rm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class am{constructor(e){this.t=e,this.currentUser=Re.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ne(this.o===void 0,42304);let i=this.i;const o=f=>this.i!==i?(i=this.i,t(f)):Promise.resolve();let s=new yt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new yt,e.enqueueRetryable((()=>o(this.currentUser)))};const r=()=>{const f=s;e.enqueueRetryable((async()=>{await f.promise,await o(this.currentUser)}))},c=f=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),r())};this.t.onInit((f=>c(f))),setTimeout((()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?c(f):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new yt)}}),0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((i=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(ne(typeof i.accessToken=="string",31837,{l:i}),new Bc(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ne(e===null||typeof e=="string",2055,{h:e}),new Re(e)}}class lm{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=Re.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class um{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new lm(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Re.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Za{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class cm{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Op(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ne(this.o===void 0,3512);const i=s=>{s.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const r=s.token!==this.m;return this.m=s.token,O("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable((()=>i(s)))};const o=s=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((s=>o(s))),setTimeout((()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?o(s):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Za(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ne(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Za(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dm(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const o=dm(40);for(let s=0;s<o.length;++s)i.length<20&&o[s]<t&&(i+=e.charAt(o[s]%62))}return i}}function X(n,e){return n<e?-1:n>e?1:0}function ys(n,e){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++){const o=n.charAt(i),s=e.charAt(i);if(o!==s)return os(o)===os(s)?X(o,s):os(o)?1:-1}return X(n.length,e.length)}const fm=55296,hm=57343;function os(n){const e=n.charCodeAt(0);return e>=fm&&e<=hm}function sn(n,e,t){return n.length===e.length&&n.every(((i,o)=>t(i,e[o])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ja="__name__";class Ke{constructor(e,t,i){t===void 0?t=0:t>e.length&&K(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&K(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return Ke.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ke?e.forEach((i=>{t.push(i)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let o=0;o<i;o++){const s=Ke.compareSegments(e.get(o),t.get(o));if(s!==0)return s}return X(e.length,t.length)}static compareSegments(e,t){const i=Ke.isNumericId(e),o=Ke.isNumericId(t);return i&&!o?-1:!i&&o?1:i&&o?Ke.extractNumericId(e).compare(Ke.extractNumericId(t)):ys(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return gt.fromString(e.substring(4,e.length-2))}}class se extends Ke{construct(e,t,i){return new se(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new B(x.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter((o=>o.length>0)))}return new se(t)}static emptyPath(){return new se([])}}const pm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ae extends Ke{construct(e,t,i){return new Ae(e,t,i)}static isValidIdentifier(e){return pm.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ae.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ja}static keyField(){return new Ae([ja])}static fromServerFormat(e){const t=[];let i="",o=0;const s=()=>{if(i.length===0)throw new B(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let r=!1;for(;o<e.length;){const c=e[o];if(c==="\\"){if(o+1===e.length)throw new B(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[o+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new B(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=f,o+=2}else c==="`"?(r=!r,o++):c!=="."||r?(i+=c,o++):(s(),o++)}if(s(),r)throw new B(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ae(t)}static emptyPath(){return new Ae([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J{constructor(e){this.path=e}static fromPath(e){return new J(se.fromString(e))}static fromName(e){return new J(se.fromString(e).popFirst(5))}static empty(){return new J(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new J(new se(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gc(n,e,t){if(!t)throw new B(x.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function mm(n,e,t,i){if(e===!0&&i===!0)throw new B(x.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function el(n){if(!J.isDocumentKey(n))throw new B(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function tl(n){if(J.isDocumentKey(n))throw new B(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Oc(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function ro(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(i){return i.constructor?i.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":K(12329,{type:typeof n})}function Ue(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new B(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ro(n);throw new B(x.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function gm(n,e){if(e<=0)throw new B(x.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ge(n,e){const t={typeString:n};return e&&(t.value=e),t}function oi(n,e){if(!Oc(n))throw new B(x.INVALID_ARGUMENT,"JSON must be an object");let t;for(const i in e)if(e[i]){const o=e[i].typeString,s="value"in e[i]?{value:e[i].value}:void 0;if(!(i in n)){t=`JSON missing required field: '${i}'`;break}const r=n[i];if(o&&typeof r!==o){t=`JSON field '${i}' must be a ${o}.`;break}if(s!==void 0&&r!==s.value){t=`Expected '${i}' field to equal '${s.value}'`;break}}if(t)throw new B(x.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nl=-62135596800,il=1e6;class ue{static now(){return ue.fromMillis(Date.now())}static fromDate(e){return ue.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*il);return new ue(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new B(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new B(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<nl)throw new B(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new B(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/il}_compareTo(e){return this.seconds===e.seconds?X(this.nanoseconds,e.nanoseconds):X(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ue._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(oi(e,ue._jsonSchema))return new ue(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-nl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ue._jsonSchemaVersion="firestore/timestamp/1.0",ue._jsonSchema={type:ge("string",ue._jsonSchemaVersion),seconds:ge("number"),nanoseconds:ge("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W{static fromTimestamp(e){return new W(e)}static min(){return new W(new ue(0,0))}static max(){return new W(new ue(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qn=-1;function ym(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,o=W.fromTimestamp(i===1e9?new ue(t+1,0):new ue(t,i));return new Tt(o,J.empty(),e)}function _m(n){return new Tt(n.readTime,n.key,Qn)}class Tt{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new Tt(W.min(),J.empty(),Qn)}static max(){return new Tt(W.max(),J.empty(),Qn)}}function Tm(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=J.comparator(n.documentKey,e.documentKey),t!==0?t:X(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Em="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Im{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fn(n){if(n.code!==x.FAILED_PRECONDITION||n.message!==Em)throw n;O("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&K(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new k(((i,o)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,o)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,o)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof k?t:k.resolve(t)}catch(t){return k.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):k.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):k.reject(t)}static resolve(e){return new k(((t,i)=>{t(e)}))}static reject(e){return new k(((t,i)=>{i(e)}))}static waitFor(e){return new k(((t,i)=>{let o=0,s=0,r=!1;e.forEach((c=>{++o,c.next((()=>{++s,r&&s===o&&t()}),(f=>i(f)))})),r=!0,s===o&&t()}))}static or(e){let t=k.resolve(!1);for(const i of e)t=t.next((o=>o?k.resolve(o):i()));return t}static forEach(e,t){const i=[];return e.forEach(((o,s)=>{i.push(t.call(this,o,s))})),this.waitFor(i)}static mapArray(e,t){return new k(((i,o)=>{const s=e.length,r=new Array(s);let c=0;for(let f=0;f<s;f++){const d=f;t(e[d]).next((h=>{r[d]=h,++c,c===s&&i(r)}),(h=>o(h)))}}))}static doWhile(e,t){return new k(((i,o)=>{const s=()=>{e()===!0?t().next((()=>{s()}),o):i()};s()}))}}function vm(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function hn(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>t.writeSequenceNumber(i))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ao.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ws=-1;function lo(n){return n==null}function Ji(n){return n===0&&1/n==-1/0}function Am(n){return typeof n=="number"&&Number.isInteger(n)&&!Ji(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hc="";function Cm(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=ol(e)),e=Sm(n.get(t),e);return ol(e)}function Sm(n,e){let t=e;const i=n.length;for(let o=0;o<i;o++){const s=n.charAt(o);switch(s){case"\0":t+="";break;case Hc:t+="";break;default:t+=s}}return t}function ol(n){return n+Hc+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function wt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function $c(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ce{constructor(e,t){this.comparator=e,this.root=t||ve.EMPTY}insert(e,t){return new ce(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ve.BLACK,null,null))}remove(e){return new ce(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ve.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const o=this.comparator(e,i.key);if(o===0)return t+i.left.size;o<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,i)=>(e(t,i),!1)))}toString(){const e=[];return this.inorderTraversal(((t,i)=>(e.push(`${t}:${i}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ri(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ri(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ri(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ri(this.root,e,this.comparator,!0)}}class Ri{constructor(e,t,i,o){this.isReverse=o,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&o&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ve{constructor(e,t,i,o,s){this.key=e,this.value=t,this.color=i??ve.RED,this.left=o??ve.EMPTY,this.right=s??ve.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,o,s){return new ve(e??this.key,t??this.value,i??this.color,o??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let o=this;const s=i(e,o.key);return o=s<0?o.copy(null,null,null,o.left.insert(e,t,i),null):s===0?o.copy(null,t,null,null,null):o.copy(null,null,null,null,o.right.insert(e,t,i)),o.fixUp()}removeMin(){if(this.left.isEmpty())return ve.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,o=this;if(t(e,o.key)<0)o.left.isEmpty()||o.left.isRed()||o.left.left.isRed()||(o=o.moveRedLeft()),o=o.copy(null,null,null,o.left.remove(e,t),null);else{if(o.left.isRed()&&(o=o.rotateRight()),o.right.isEmpty()||o.right.isRed()||o.right.left.isRed()||(o=o.moveRedRight()),t(e,o.key)===0){if(o.right.isEmpty())return ve.EMPTY;i=o.right.min(),o=o.copy(i.key,i.value,null,null,o.right.removeMin())}o=o.copy(null,null,null,null,o.right.remove(e,t))}return o.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ve.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ve.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw K(43730,{key:this.key,value:this.value});if(this.right.isRed())throw K(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw K(27949);return e+(this.isRed()?0:1)}}ve.EMPTY=null,ve.RED=!0,ve.BLACK=!1;ve.EMPTY=new class{constructor(){this.size=0}get key(){throw K(57766)}get value(){throw K(16141)}get color(){throw K(16727)}get left(){throw K(29726)}get right(){throw K(36894)}copy(e,t,i,o,s){return this}insert(e,t,i){return new ve(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _e{constructor(e){this.comparator=e,this.data=new ce(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,i)=>(e(t),!1)))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const o=i.getNext();if(this.comparator(o.key,e[1])>=0)return;t(o.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new rl(this.data.getIterator())}getIteratorFrom(e){return new rl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((i=>{t=t.add(i)})),t}isEqual(e){if(!(e instanceof _e)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const o=t.getNext().key,s=i.getNext().key;if(this.comparator(o,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new _e(this.comparator);return t.data=e,t}}class rl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(e){this.fields=e,e.sort(Ae.comparator)}static empty(){return new Le([])}unionWith(e){let t=new _e(Ae.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new Le(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return sn(this.fields,e.fields,((t,i)=>t.isEqual(i)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(o){try{return atob(o)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Jc("Invalid base64 string: "+s):s}})(e);return new Ce(t)}static fromUint8Array(e){const t=(function(o){let s="";for(let r=0;r<o.length;++r)s+=String.fromCharCode(o[r]);return s})(e);return new Ce(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const i=new Uint8Array(t.length);for(let o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return X(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ce.EMPTY_BYTE_STRING=new Ce("");const wm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Et(n){if(ne(!!n,39018),typeof n=="string"){let e=0;const t=wm.exec(n);if(ne(!!t,46558,{timestamp:n}),t[1]){let o=t[1];o=(o+"000000000").substr(0,9),e=Number(o)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:fe(n.seconds),nanos:fe(n.nanos)}}function fe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function It(n){return typeof n=="string"?Ce.fromBase64String(n):Ce.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zc="server_timestamp",Kc="__type__",Wc="__previous_value__",Yc="__local_write_time__";function Ys(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Kc])==null?void 0:i.stringValue)===zc}function uo(n){const e=n.mapValue.fields[Wc];return Ys(e)?uo(e):e}function Xn(n){const e=Et(n.mapValue.fields[Yc].timestampValue);return new ue(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(e,t,i,o,s,r,c,f,d,h){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=o,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=c,this.longPollingOptions=f,this.useFetchStreams=d,this.isUsingEmulator=h}}const zi="(default)";class Zn{constructor(e,t){this.projectId=e,this.database=t||zi}static empty(){return new Zn("","")}get isDefaultDatabase(){return this.database===zi}isEqual(e){return e instanceof Zn&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qc="__type__",Pm="__max__",Pi={mapValue:{}},Xc="__vector__",Ki="value";function vt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ys(n)?4:Mm(n)?9007199254740991:Nm(n)?10:11:K(28295,{value:n})}function Ze(n,e){if(n===e)return!0;const t=vt(n);if(t!==vt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Xn(n).isEqual(Xn(e));case 3:return(function(o,s){if(typeof o.timestampValue=="string"&&typeof s.timestampValue=="string"&&o.timestampValue.length===s.timestampValue.length)return o.timestampValue===s.timestampValue;const r=Et(o.timestampValue),c=Et(s.timestampValue);return r.seconds===c.seconds&&r.nanos===c.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(o,s){return It(o.bytesValue).isEqual(It(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(o,s){return fe(o.geoPointValue.latitude)===fe(s.geoPointValue.latitude)&&fe(o.geoPointValue.longitude)===fe(s.geoPointValue.longitude)})(n,e);case 2:return(function(o,s){if("integerValue"in o&&"integerValue"in s)return fe(o.integerValue)===fe(s.integerValue);if("doubleValue"in o&&"doubleValue"in s){const r=fe(o.doubleValue),c=fe(s.doubleValue);return r===c?Ji(r)===Ji(c):isNaN(r)&&isNaN(c)}return!1})(n,e);case 9:return sn(n.arrayValue.values||[],e.arrayValue.values||[],Ze);case 10:case 11:return(function(o,s){const r=o.mapValue.fields||{},c=s.mapValue.fields||{};if(sl(r)!==sl(c))return!1;for(const f in r)if(r.hasOwnProperty(f)&&(c[f]===void 0||!Ze(r[f],c[f])))return!1;return!0})(n,e);default:return K(52216,{left:n})}}function jn(n,e){return(n.values||[]).find((t=>Ze(t,e)))!==void 0}function rn(n,e){if(n===e)return 0;const t=vt(n),i=vt(e);if(t!==i)return X(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return X(n.booleanValue,e.booleanValue);case 2:return(function(s,r){const c=fe(s.integerValue||s.doubleValue),f=fe(r.integerValue||r.doubleValue);return c<f?-1:c>f?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1})(n,e);case 3:return al(n.timestampValue,e.timestampValue);case 4:return al(Xn(n),Xn(e));case 5:return ys(n.stringValue,e.stringValue);case 6:return(function(s,r){const c=It(s),f=It(r);return c.compareTo(f)})(n.bytesValue,e.bytesValue);case 7:return(function(s,r){const c=s.split("/"),f=r.split("/");for(let d=0;d<c.length&&d<f.length;d++){const h=X(c[d],f[d]);if(h!==0)return h}return X(c.length,f.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,r){const c=X(fe(s.latitude),fe(r.latitude));return c!==0?c:X(fe(s.longitude),fe(r.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return ll(n.arrayValue,e.arrayValue);case 10:return(function(s,r){var g,T,P,M;const c=s.fields||{},f=r.fields||{},d=(g=c[Ki])==null?void 0:g.arrayValue,h=(T=f[Ki])==null?void 0:T.arrayValue,m=X(((P=d==null?void 0:d.values)==null?void 0:P.length)||0,((M=h==null?void 0:h.values)==null?void 0:M.length)||0);return m!==0?m:ll(d,h)})(n.mapValue,e.mapValue);case 11:return(function(s,r){if(s===Pi.mapValue&&r===Pi.mapValue)return 0;if(s===Pi.mapValue)return 1;if(r===Pi.mapValue)return-1;const c=s.fields||{},f=Object.keys(c),d=r.fields||{},h=Object.keys(d);f.sort(),h.sort();for(let m=0;m<f.length&&m<h.length;++m){const g=ys(f[m],h[m]);if(g!==0)return g;const T=rn(c[f[m]],d[h[m]]);if(T!==0)return T}return X(f.length,h.length)})(n.mapValue,e.mapValue);default:throw K(23264,{he:t})}}function al(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return X(n,e);const t=Et(n),i=Et(e),o=X(t.seconds,i.seconds);return o!==0?o:X(t.nanos,i.nanos)}function ll(n,e){const t=n.values||[],i=e.values||[];for(let o=0;o<t.length&&o<i.length;++o){const s=rn(t[o],i[o]);if(s)return s}return X(t.length,i.length)}function an(n){return _s(n)}function _s(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const i=Et(t);return`time(${i.seconds},${i.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return It(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return J.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let i="[",o=!0;for(const s of t.values||[])o?o=!1:i+=",",i+=_s(s);return i+"]"})(n.arrayValue):"mapValue"in n?(function(t){const i=Object.keys(t.fields||{}).sort();let o="{",s=!0;for(const r of i)s?s=!1:o+=",",o+=`${r}:${_s(t.fields[r])}`;return o+"}"})(n.mapValue):K(61005,{value:n})}function ki(n){switch(vt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=uo(n);return e?16+ki(e):16;case 5:return 2*n.stringValue.length;case 6:return It(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(i){return(i.values||[]).reduce(((o,s)=>o+ki(s)),0)})(n.arrayValue);case 10:case 11:return(function(i){let o=0;return wt(i.fields,((s,r)=>{o+=s.length+ki(r)})),o})(n.mapValue);default:throw K(13486,{value:n})}}function ul(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ts(n){return!!n&&"integerValue"in n}function Qs(n){return!!n&&"arrayValue"in n}function cl(n){return!!n&&"nullValue"in n}function dl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function bi(n){return!!n&&"mapValue"in n}function Nm(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Qc])==null?void 0:i.stringValue)===Xc}function Hn(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return wt(n.mapValue.fields,((t,i)=>e.mapValue.fields[t]=Hn(i))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Hn(n.arrayValue.values[t]);return e}return{...n}}function Mm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Pm}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xe{constructor(e){this.value=e}static empty(){return new xe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!bi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Hn(t)}setAll(e){let t=Ae.emptyPath(),i={},o=[];e.forEach(((r,c)=>{if(!t.isImmediateParentOf(c)){const f=this.getFieldsMap(t);this.applyChanges(f,i,o),i={},o=[],t=c.popLast()}r?i[c.lastSegment()]=Hn(r):o.push(c.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,i,o)}delete(e){const t=this.field(e.popLast());bi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ze(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let o=t.mapValue.fields[e.get(i)];bi(o)&&o.mapValue.fields||(o={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=o),t=o}return t.mapValue.fields}applyChanges(e,t,i){wt(t,((o,s)=>e[o]=s));for(const o of i)delete e[o]}clone(){return new xe(Hn(this.value))}}function Zc(n){const e=[];return wt(n.fields,((t,i)=>{const o=new Ae([t]);if(bi(i)){const s=Zc(i.mapValue).fields;if(s.length===0)e.push(o);else for(const r of s)e.push(o.child(r))}else e.push(o)})),new Le(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pe{constructor(e,t,i,o,s,r,c){this.key=e,this.documentType=t,this.version=i,this.readTime=o,this.createTime=s,this.data=r,this.documentState=c}static newInvalidDocument(e){return new Pe(e,0,W.min(),W.min(),W.min(),xe.empty(),0)}static newFoundDocument(e,t,i,o){return new Pe(e,1,t,W.min(),i,o,0)}static newNoDocument(e,t){return new Pe(e,2,t,W.min(),W.min(),xe.empty(),0)}static newUnknownDocument(e,t){return new Pe(e,3,t,W.min(),W.min(),xe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(W.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=xe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=xe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=W.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Pe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Pe(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{constructor(e,t){this.position=e,this.inclusive=t}}function fl(n,e,t){let i=0;for(let o=0;o<n.position.length;o++){const s=e[o],r=n.position[o];if(s.field.isKeyField()?i=J.comparator(J.fromName(r.referenceValue),t.key):i=rn(r,t.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function hl(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ze(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e,t="asc"){this.field=e,this.dir=t}}function Dm(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jc{}class me extends jc{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new xm(e,t,i):t==="array-contains"?new Lm(e,i):t==="in"?new Fm(e,i):t==="not-in"?new Um(e,i):t==="array-contains-any"?new qm(e,i):new me(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new km(e,i):new bm(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(rn(t,this.value)):t!==null&&vt(this.value)===vt(t)&&this.matchesComparison(rn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return K(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Oe extends jc{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Oe(e,t)}matches(e){return ed(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ed(n){return n.op==="and"}function td(n){return Vm(n)&&ed(n)}function Vm(n){for(const e of n.filters)if(e instanceof Oe)return!1;return!0}function Es(n){if(n instanceof me)return n.field.canonicalString()+n.op.toString()+an(n.value);if(td(n))return n.filters.map((e=>Es(e))).join(",");{const e=n.filters.map((t=>Es(t))).join(",");return`${n.op}(${e})`}}function nd(n,e){return n instanceof me?(function(i,o){return o instanceof me&&i.op===o.op&&i.field.isEqual(o.field)&&Ze(i.value,o.value)})(n,e):n instanceof Oe?(function(i,o){return o instanceof Oe&&i.op===o.op&&i.filters.length===o.filters.length?i.filters.reduce(((s,r,c)=>s&&nd(r,o.filters[c])),!0):!1})(n,e):void K(19439)}function id(n){return n instanceof me?(function(t){return`${t.field.canonicalString()} ${t.op} ${an(t.value)}`})(n):n instanceof Oe?(function(t){return t.op.toString()+" {"+t.getFilters().map(id).join(" ,")+"}"})(n):"Filter"}class xm extends me{constructor(e,t,i){super(e,t,i),this.key=J.fromName(i.referenceValue)}matches(e){const t=J.comparator(e.key,this.key);return this.matchesComparison(t)}}class km extends me{constructor(e,t){super(e,"in",t),this.keys=od("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class bm extends me{constructor(e,t){super(e,"not-in",t),this.keys=od("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function od(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map((i=>J.fromName(i.referenceValue)))}class Lm extends me{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Qs(t)&&jn(t.arrayValue,this.value)}}class Fm extends me{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&jn(this.value.arrayValue,t)}}class Um extends me{constructor(e,t){super(e,"not-in",t)}matches(e){if(jn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!jn(this.value.arrayValue,t)}}class qm extends me{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Qs(t)||!t.arrayValue.values)&&t.arrayValue.values.some((i=>jn(this.value.arrayValue,i)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bm{constructor(e,t=null,i=[],o=[],s=null,r=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=o,this.limit=s,this.startAt=r,this.endAt=c,this.Te=null}}function pl(n,e=null,t=[],i=[],o=null,s=null,r=null){return new Bm(n,e,t,i,o,s,r)}function Xs(n){const e=Y(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((i=>Es(i))).join(","),t+="|ob:",t+=e.orderBy.map((i=>(function(s){return s.field.canonicalString()+s.dir})(i))).join(","),lo(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((i=>an(i))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((i=>an(i))).join(",")),e.Te=t}return e.Te}function Zs(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Dm(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!nd(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!hl(n.startAt,e.startAt)&&hl(n.endAt,e.endAt)}function Is(n){return J.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(e,t=null,i=[],o=[],s=null,r="F",c=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=o,this.limit=s,this.limitType=r,this.startAt=c,this.endAt=f,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Gm(n,e,t,i,o,s,r,c){return new pn(n,e,t,i,o,s,r,c)}function js(n){return new pn(n)}function ml(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function sd(n){return n.collectionGroup!==null}function $n(n){const e=Y(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(r){let c=new _e(Ae.comparator);return r.filters.forEach((f=>{f.getFlattenedFilters().forEach((d=>{d.isInequality()&&(c=c.add(d.field))}))})),c})(e).forEach((s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new ei(s,i))})),t.has(Ae.keyField().canonicalString())||e.Ie.push(new ei(Ae.keyField(),i))}return e.Ie}function We(n){const e=Y(n);return e.Ee||(e.Ee=Om(e,$n(n))),e.Ee}function Om(n,e){if(n.limitType==="F")return pl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((o=>{const s=o.dir==="desc"?"asc":"desc";return new ei(o.field,s)}));const t=n.endAt?new Wi(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new Wi(n.startAt.position,n.startAt.inclusive):null;return pl(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function vs(n,e){const t=n.filters.concat([e]);return new pn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Yi(n,e,t){return new pn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function co(n,e){return Zs(We(n),We(e))&&n.limitType===e.limitType}function rd(n){return`${Xs(We(n))}|lt:${n.limitType}`}function Wt(n){return`Query(target=${(function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map((o=>id(o))).join(", ")}]`),lo(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map((o=>(function(r){return`${r.field.canonicalString()} (${r.dir})`})(o))).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map((o=>an(o))).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map((o=>an(o))).join(",")),`Target(${i})`})(We(n))}; limitType=${n.limitType})`}function fo(n,e){return e.isFoundDocument()&&(function(i,o){const s=o.key.path;return i.collectionGroup!==null?o.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):J.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)})(n,e)&&(function(i,o){for(const s of $n(i))if(!s.field.isKeyField()&&o.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(i,o){for(const s of i.filters)if(!s.matches(o))return!1;return!0})(n,e)&&(function(i,o){return!(i.startAt&&!(function(r,c,f){const d=fl(r,c,f);return r.inclusive?d<=0:d<0})(i.startAt,$n(i),o)||i.endAt&&!(function(r,c,f){const d=fl(r,c,f);return r.inclusive?d>=0:d>0})(i.endAt,$n(i),o))})(n,e)}function Hm(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ad(n){return(e,t)=>{let i=!1;for(const o of $n(n)){const s=$m(o,e,t);if(s!==0)return s;i=i||o.field.isKeyField()}return 0}}function $m(n,e,t){const i=n.field.isKeyField()?J.comparator(e.key,t.key):(function(s,r,c){const f=r.data.field(s),d=c.data.field(s);return f!==null&&d!==null?rn(f,d):K(42886)})(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return K(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[o,s]of i)if(this.equalsFn(o,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),o=this.inner[i];if(o===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<o.length;s++)if(this.equalsFn(o[s][0],e))return void(o[s]=[e,t]);o.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return i.length===1?delete this.inner[t]:i.splice(o,1),this.innerSize--,!0;return!1}forEach(e){wt(this.inner,((t,i)=>{for(const[o,s]of i)e(o,s)}))}isEmpty(){return $c(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jm=new ce(J.comparator);function tt(){return Jm}const ld=new ce(J.comparator);function qn(...n){let e=ld;for(const t of n)e=e.insert(t.key,t);return e}function ud(n){let e=ld;return n.forEach(((t,i)=>e=e.insert(t,i.overlayedDocument))),e}function bt(){return Jn()}function cd(){return Jn()}function Jn(){return new Bt((n=>n.toString()),((n,e)=>n.isEqual(e)))}const zm=new ce(J.comparator),Km=new _e(J.comparator);function Z(...n){let e=Km;for(const t of n)e=e.add(t);return e}const Wm=new _e(X);function Ym(){return Wm}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function er(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ji(e)?"-0":e}}function dd(n){return{integerValue:""+n}}function fd(n,e){return Am(e)?dd(e):er(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho{constructor(){this._=void 0}}function Qm(n,e,t){return n instanceof Qi?(function(o,s){const r={fields:{[Kc]:{stringValue:zc},[Yc]:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return s&&Ys(s)&&(s=uo(s)),s&&(r.fields[Wc]=s),{mapValue:r}})(t,e):n instanceof ti?pd(n,e):n instanceof ni?md(n,e):(function(o,s){const r=hd(o,s),c=gl(r)+gl(o.Ae);return Ts(r)&&Ts(o.Ae)?dd(c):er(o.serializer,c)})(n,e)}function Xm(n,e,t){return n instanceof ti?pd(n,e):n instanceof ni?md(n,e):t}function hd(n,e){return n instanceof ii?(function(i){return Ts(i)||(function(s){return!!s&&"doubleValue"in s})(i)})(e)?e:{integerValue:0}:null}class Qi extends ho{}class ti extends ho{constructor(e){super(),this.elements=e}}function pd(n,e){const t=gd(e);for(const i of n.elements)t.some((o=>Ze(o,i)))||t.push(i);return{arrayValue:{values:t}}}class ni extends ho{constructor(e){super(),this.elements=e}}function md(n,e){let t=gd(e);for(const i of n.elements)t=t.filter((o=>!Ze(o,i)));return{arrayValue:{values:t}}}class ii extends ho{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function gl(n){return fe(n.integerValue||n.doubleValue)}function gd(n){return Qs(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(e,t){this.field=e,this.transform=t}}function jm(n,e){return n.field.isEqual(e.field)&&(function(i,o){return i instanceof ti&&o instanceof ti||i instanceof ni&&o instanceof ni?sn(i.elements,o.elements,Ze):i instanceof ii&&o instanceof ii?Ze(i.Ae,o.Ae):i instanceof Qi&&o instanceof Qi})(n.transform,e.transform)}class eg{constructor(e,t){this.version=e,this.transformResults=t}}class ke{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ke}static exists(e){return new ke(void 0,e)}static updateTime(e){return new ke(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Li(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class po{}function yd(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new mo(n.key,ke.none()):new si(n.key,n.data,ke.none());{const t=n.data,i=xe.empty();let o=new _e(Ae.comparator);for(let s of e.fields)if(!o.has(s)){let r=t.field(s);r===null&&s.length>1&&(s=s.popLast(),r=t.field(s)),r===null?i.delete(s):i.set(s,r),o=o.add(s)}return new Rt(n.key,i,new Le(o.toArray()),ke.none())}}function tg(n,e,t){n instanceof si?(function(o,s,r){const c=o.value.clone(),f=_l(o.fieldTransforms,s,r.transformResults);c.setAll(f),s.convertToFoundDocument(r.version,c).setHasCommittedMutations()})(n,e,t):n instanceof Rt?(function(o,s,r){if(!Li(o.precondition,s))return void s.convertToUnknownDocument(r.version);const c=_l(o.fieldTransforms,s,r.transformResults),f=s.data;f.setAll(_d(o)),f.setAll(c),s.convertToFoundDocument(r.version,f).setHasCommittedMutations()})(n,e,t):(function(o,s,r){s.convertToNoDocument(r.version).setHasCommittedMutations()})(0,e,t)}function zn(n,e,t,i){return n instanceof si?(function(s,r,c,f){if(!Li(s.precondition,r))return c;const d=s.value.clone(),h=Tl(s.fieldTransforms,f,r);return d.setAll(h),r.convertToFoundDocument(r.version,d).setHasLocalMutations(),null})(n,e,t,i):n instanceof Rt?(function(s,r,c,f){if(!Li(s.precondition,r))return c;const d=Tl(s.fieldTransforms,f,r),h=r.data;return h.setAll(_d(s)),h.setAll(d),r.convertToFoundDocument(r.version,h).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map((m=>m.field)))})(n,e,t,i):(function(s,r,c){return Li(s.precondition,r)?(r.convertToNoDocument(r.version).setHasLocalMutations(),null):c})(n,e,t)}function ng(n,e){let t=null;for(const i of n.fieldTransforms){const o=e.data.field(i.field),s=hd(i.transform,o||null);s!=null&&(t===null&&(t=xe.empty()),t.set(i.field,s))}return t||null}function yl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(i,o){return i===void 0&&o===void 0||!(!i||!o)&&sn(i,o,((s,r)=>jm(s,r)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class si extends po{constructor(e,t,i,o=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=o,this.type=0}getFieldMask(){return null}}class Rt extends po{constructor(e,t,i,o,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=o,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function _d(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}})),e}function _l(n,e,t){const i=new Map;ne(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let o=0;o<t.length;o++){const s=n[o],r=s.transform,c=e.data.field(s.field);i.set(s.field,Xm(r,c,t[o]))}return i}function Tl(n,e,t){const i=new Map;for(const o of n){const s=o.transform,r=t.data.field(o.field);i.set(o.field,Qm(s,r,e))}return i}class mo extends po{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ig extends po{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class og{constructor(e,t,i,o){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=o}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let o=0;o<this.mutations.length;o++){const s=this.mutations[o];s.key.isEqual(e.key)&&tg(s,e,i[o])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=zn(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=zn(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=cd();return this.mutations.forEach((o=>{const s=e.get(o.key),r=s.overlayedDocument;let c=this.applyToLocalView(r,s.mutatedFields);c=t.has(o.key)?null:c;const f=yd(r,c);f!==null&&i.set(o.key,f),r.isValidDocument()||r.convertToNoDocument(W.min())})),i}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Z())}isEqual(e){return this.batchId===e.batchId&&sn(this.mutations,e.mutations,((t,i)=>yl(t,i)))&&sn(this.baseMutations,e.baseMutations,((t,i)=>yl(t,i)))}}class tr{constructor(e,t,i,o){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=o}static from(e,t,i){ne(e.mutations.length===i.length,58842,{me:e.mutations.length,fe:i.length});let o=(function(){return zm})();const s=e.mutations;for(let r=0;r<s.length;r++)o=o.insert(s[r].key,i[r].version);return new tr(e,t,i,o)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rg{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pe,j;function ag(n){switch(n){case x.OK:return K(64938);case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0;default:return K(15467,{code:n})}}function Td(n){if(n===void 0)return et("GRPC error has no .code"),x.UNKNOWN;switch(n){case pe.OK:return x.OK;case pe.CANCELLED:return x.CANCELLED;case pe.UNKNOWN:return x.UNKNOWN;case pe.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case pe.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case pe.INTERNAL:return x.INTERNAL;case pe.UNAVAILABLE:return x.UNAVAILABLE;case pe.UNAUTHENTICATED:return x.UNAUTHENTICATED;case pe.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case pe.NOT_FOUND:return x.NOT_FOUND;case pe.ALREADY_EXISTS:return x.ALREADY_EXISTS;case pe.PERMISSION_DENIED:return x.PERMISSION_DENIED;case pe.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case pe.ABORTED:return x.ABORTED;case pe.OUT_OF_RANGE:return x.OUT_OF_RANGE;case pe.UNIMPLEMENTED:return x.UNIMPLEMENTED;case pe.DATA_LOSS:return x.DATA_LOSS;default:return K(39323,{code:n})}}(j=pe||(pe={}))[j.OK=0]="OK",j[j.CANCELLED=1]="CANCELLED",j[j.UNKNOWN=2]="UNKNOWN",j[j.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",j[j.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",j[j.NOT_FOUND=5]="NOT_FOUND",j[j.ALREADY_EXISTS=6]="ALREADY_EXISTS",j[j.PERMISSION_DENIED=7]="PERMISSION_DENIED",j[j.UNAUTHENTICATED=16]="UNAUTHENTICATED",j[j.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",j[j.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",j[j.ABORTED=10]="ABORTED",j[j.OUT_OF_RANGE=11]="OUT_OF_RANGE",j[j.UNIMPLEMENTED=12]="UNIMPLEMENTED",j[j.INTERNAL=13]="INTERNAL",j[j.UNAVAILABLE=14]="UNAVAILABLE",j[j.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lg(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ug=new gt([4294967295,4294967295],0);function El(n){const e=lg().encode(n),t=new xc;return t.update(e),new Uint8Array(t.digest())}function Il(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),o=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new gt([t,i],0),new gt([o,s],0)]}class nr{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new Bn(`Invalid padding: ${t}`);if(i<0)throw new Bn(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Bn(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new Bn(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=gt.fromNumber(this.ge)}ye(e,t,i){let o=e.add(t.multiply(gt.fromNumber(i)));return o.compare(ug)===1&&(o=new gt([o.getBits(0),o.getBits(1)],0)),o.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=El(e),[i,o]=Il(t);for(let s=0;s<this.hashCount;s++){const r=this.ye(i,o,s);if(!this.we(r))return!1}return!0}static create(e,t,i){const o=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),r=new nr(s,o,t);return i.forEach((c=>r.insert(c))),r}insert(e){if(this.ge===0)return;const t=El(e),[i,o]=Il(t);for(let s=0;s<this.hashCount;s++){const r=this.ye(i,o,s);this.Se(r)}}Se(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class Bn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class go{constructor(e,t,i,o,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=o,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const o=new Map;return o.set(e,ri.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new go(W.min(),o,new ce(X),tt(),Z())}}class ri{constructor(e,t,i,o,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=o,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new ri(i,t,Z(),Z(),Z())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(e,t,i,o){this.be=e,this.removedTargetIds=t,this.key=i,this.De=o}}class Ed{constructor(e,t){this.targetId=e,this.Ce=t}}class Id{constructor(e,t,i=Ce.EMPTY_BYTE_STRING,o=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=o}}class vl{constructor(){this.ve=0,this.Fe=Al(),this.Me=Ce.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Z(),t=Z(),i=Z();return this.Fe.forEach(((o,s)=>{switch(s){case 0:e=e.add(o);break;case 2:t=t.add(o);break;case 1:i=i.add(o);break;default:K(38017,{changeType:s})}})),new ri(this.Me,this.xe,e,t,i)}qe(){this.Oe=!1,this.Fe=Al()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ne(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class cg{constructor(e){this.Ge=e,this.ze=new Map,this.je=tt(),this.Je=Ni(),this.He=Ni(),this.Ye=new ce(X)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const i=this.nt(t);switch(e.state){case 0:this.rt(t)&&i.Le(e.resumeToken);break;case 1:i.Ke(),i.Ne||i.qe(),i.Le(e.resumeToken);break;case 2:i.Ke(),i.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(i.We(),i.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),i.Le(e.resumeToken));break;default:K(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((i,o)=>{this.rt(o)&&t(o)}))}st(e){const t=e.targetId,i=e.Ce.count,o=this.ot(t);if(o){const s=o.target;if(Is(s))if(i===0){const r=new J(s.path);this.et(t,r,Pe.newNoDocument(r,W.min()))}else ne(i===1,20013,{expectedCount:i});else{const r=this._t(t);if(r!==i){const c=this.ut(e),f=c?this.ct(c,e,r):1;if(f!==0){this.it(t);const d=f===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:o=0},hashCount:s=0}=t;let r,c;try{r=It(i).toUint8Array()}catch(f){if(f instanceof Jc)return on("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{c=new nr(r,o,s)}catch(f){return on(f instanceof Bn?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return c.ge===0?null:c}ct(e,t,i){return t.Ce.count===i-this.Pt(e,t.targetId)?0:2}Pt(e,t){const i=this.Ge.getRemoteKeysForTarget(t);let o=0;return i.forEach((s=>{const r=this.Ge.ht(),c=`projects/${r.projectId}/databases/${r.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.et(t,s,null),o++)})),o}Tt(e){const t=new Map;this.ze.forEach(((s,r)=>{const c=this.ot(r);if(c){if(s.current&&Is(c.target)){const f=new J(c.target.path);this.It(f).has(r)||this.Et(r,f)||this.et(r,f,Pe.newNoDocument(f,e))}s.Be&&(t.set(r,s.ke()),s.qe())}}));let i=Z();this.He.forEach(((s,r)=>{let c=!0;r.forEachWhile((f=>{const d=this.ot(f);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(i=i.add(s))})),this.je.forEach(((s,r)=>r.setReadTime(e)));const o=new go(e,t,this.Ye,this.je,i);return this.je=tt(),this.Je=Ni(),this.He=Ni(),this.Ye=new ce(X),o}Xe(e,t){if(!this.rt(e))return;const i=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,i),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,i){if(!this.rt(e))return;const o=this.nt(e);this.Et(e,t)?o.Qe(t,1):o.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),i&&(this.je=this.je.insert(t,i))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new vl,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new _e(X),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new _e(X),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new vl),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ni(){return new ce(J.comparator)}function Al(){return new ce(J.comparator)}const dg={asc:"ASCENDING",desc:"DESCENDING"},fg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hg={and:"AND",or:"OR"};class pg{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function As(n,e){return n.useProto3Json||lo(e)?e:{value:e}}function Xi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function vd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function mg(n,e){return Xi(n,e.toTimestamp())}function Ye(n){return ne(!!n,49232),W.fromTimestamp((function(t){const i=Et(t);return new ue(i.seconds,i.nanos)})(n))}function ir(n,e){return Cs(n,e).canonicalString()}function Cs(n,e){const t=(function(o){return new se(["projects",o.projectId,"databases",o.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Ad(n){const e=se.fromString(n);return ne(Pd(e),10190,{key:e.toString()}),e}function Ss(n,e){return ir(n.databaseId,e.path)}function ss(n,e){const t=Ad(e);if(t.get(1)!==n.databaseId.projectId)throw new B(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new B(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new J(Sd(t))}function Cd(n,e){return ir(n.databaseId,e)}function gg(n){const e=Ad(n);return e.length===4?se.emptyPath():Sd(e)}function ws(n){return new se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Sd(n){return ne(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Cl(n,e,t){return{name:Ss(n,e),fields:t.value.mapValue.fields}}function yg(n,e){let t;if("targetChange"in e){e.targetChange;const i=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:K(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),o=e.targetChange.targetIds||[],s=(function(d,h){return d.useProto3Json?(ne(h===void 0||typeof h=="string",58123),Ce.fromBase64String(h||"")):(ne(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),Ce.fromUint8Array(h||new Uint8Array))})(n,e.targetChange.resumeToken),r=e.targetChange.cause,c=r&&(function(d){const h=d.code===void 0?x.UNKNOWN:Td(d.code);return new B(h,d.message||"")})(r);t=new Id(i,o,s,c||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const o=ss(n,i.document.name),s=Ye(i.document.updateTime),r=i.document.createTime?Ye(i.document.createTime):W.min(),c=new xe({mapValue:{fields:i.document.fields}}),f=Pe.newFoundDocument(o,s,r,c),d=i.targetIds||[],h=i.removedTargetIds||[];t=new Fi(d,h,f.key,f)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const o=ss(n,i.document),s=i.readTime?Ye(i.readTime):W.min(),r=Pe.newNoDocument(o,s),c=i.removedTargetIds||[];t=new Fi([],c,r.key,r)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const o=ss(n,i.document),s=i.removedTargetIds||[];t=new Fi([],s,o,null)}else{if(!("filter"in e))return K(11601,{Rt:e});{e.filter;const i=e.filter;i.targetId;const{count:o=0,unchangedNames:s}=i,r=new rg(o,s),c=i.targetId;t=new Ed(c,r)}}return t}function _g(n,e){let t;if(e instanceof si)t={update:Cl(n,e.key,e.value)};else if(e instanceof mo)t={delete:Ss(n,e.key)};else if(e instanceof Rt)t={update:Cl(n,e.key,e.data),updateMask:Rg(e.fieldMask)};else{if(!(e instanceof ig))return K(16599,{Vt:e.type});t={verify:Ss(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((i=>(function(s,r){const c=r.transform;if(c instanceof Qi)return{fieldPath:r.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof ti)return{fieldPath:r.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof ni)return{fieldPath:r.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof ii)return{fieldPath:r.field.canonicalString(),increment:c.Ae};throw K(20930,{transform:r.transform})})(0,i)))),e.precondition.isNone||(t.currentDocument=(function(o,s){return s.updateTime!==void 0?{updateTime:mg(o,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:K(27497)})(n,e.precondition)),t}function Tg(n,e){return n&&n.length>0?(ne(e!==void 0,14353),n.map((t=>(function(o,s){let r=o.updateTime?Ye(o.updateTime):Ye(s);return r.isEqual(W.min())&&(r=Ye(s)),new eg(r,o.transformResults||[])})(t,e)))):[]}function Eg(n,e){return{documents:[Cd(n,e.path)]}}function Ig(n,e){const t={structuredQuery:{}},i=e.path;let o;e.collectionGroup!==null?(o=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(o=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=Cd(n,o);const s=(function(d){if(d.length!==0)return Rd(Oe.create(d,"and"))})(e.filters);s&&(t.structuredQuery.where=s);const r=(function(d){if(d.length!==0)return d.map((h=>(function(g){return{field:Yt(g.field),direction:Cg(g.dir)}})(h)))})(e.orderBy);r&&(t.structuredQuery.orderBy=r);const c=As(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:o}}function vg(n){let e=gg(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let o=null;if(i>0){ne(i===1,65062);const h=t.from[0];h.allDescendants?o=h.collectionId:e=e.child(h.collectionId)}let s=[];t.where&&(s=(function(m){const g=wd(m);return g instanceof Oe&&td(g)?g.getFilters():[g]})(t.where));let r=[];t.orderBy&&(r=(function(m){return m.map((g=>(function(P){return new ei(Qt(P.field),(function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(P.direction))})(g)))})(t.orderBy));let c=null;t.limit&&(c=(function(m){let g;return g=typeof m=="object"?m.value:m,lo(g)?null:g})(t.limit));let f=null;t.startAt&&(f=(function(m){const g=!!m.before,T=m.values||[];return new Wi(T,g)})(t.startAt));let d=null;return t.endAt&&(d=(function(m){const g=!m.before,T=m.values||[];return new Wi(T,g)})(t.endAt)),Gm(e,o,r,s,c,"F",f,d)}function Ag(n,e){const t=(function(o){switch(o){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return K(28987,{purpose:o})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function wd(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=Qt(t.unaryFilter.field);return me.create(i,"==",{doubleValue:NaN});case"IS_NULL":const o=Qt(t.unaryFilter.field);return me.create(o,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Qt(t.unaryFilter.field);return me.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Qt(t.unaryFilter.field);return me.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return K(61313);default:return K(60726)}})(n):n.fieldFilter!==void 0?(function(t){return me.create(Qt(t.fieldFilter.field),(function(o){switch(o){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return K(58110);default:return K(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Oe.create(t.compositeFilter.filters.map((i=>wd(i))),(function(o){switch(o){case"AND":return"and";case"OR":return"or";default:return K(1026)}})(t.compositeFilter.op))})(n):K(30097,{filter:n})}function Cg(n){return dg[n]}function Sg(n){return fg[n]}function wg(n){return hg[n]}function Yt(n){return{fieldPath:n.canonicalString()}}function Qt(n){return Ae.fromServerFormat(n.fieldPath)}function Rd(n){return n instanceof me?(function(t){if(t.op==="=="){if(dl(t.value))return{unaryFilter:{field:Yt(t.field),op:"IS_NAN"}};if(cl(t.value))return{unaryFilter:{field:Yt(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(dl(t.value))return{unaryFilter:{field:Yt(t.field),op:"IS_NOT_NAN"}};if(cl(t.value))return{unaryFilter:{field:Yt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Yt(t.field),op:Sg(t.op),value:t.value}}})(n):n instanceof Oe?(function(t){const i=t.getFilters().map((o=>Rd(o)));return i.length===1?i[0]:{compositeFilter:{op:wg(t.op),filters:i}}})(n):K(54877,{filter:n})}function Rg(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Pd(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e,t,i,o,s=W.min(),r=W.min(),c=Ce.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=o,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=c,this.expectedCount=f}withSequenceNumber(e){return new ft(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ft(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ft(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ft(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(e){this.yt=e}}function Ng(n){const e=vg({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Yi(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mg{constructor(){this.Cn=new Dg}addToCollectionParentIndex(e,t){return this.Cn.add(t),k.resolve()}getCollectionParents(e,t){return k.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return k.resolve()}deleteFieldIndex(e,t){return k.resolve()}deleteAllFieldIndexes(e){return k.resolve()}createTargetIndexes(e,t){return k.resolve()}getDocumentsMatchingTarget(e,t){return k.resolve(null)}getIndexType(e,t){return k.resolve(0)}getFieldIndexes(e,t){return k.resolve([])}getNextCollectionGroupToUpdate(e){return k.resolve(null)}getMinOffset(e,t){return k.resolve(Tt.min())}getMinOffsetFromCollectionGroup(e,t){return k.resolve(Tt.min())}updateCollectionGroup(e,t,i){return k.resolve()}updateIndexEntries(e,t){return k.resolve()}}class Dg{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),o=this.index[t]||new _e(se.comparator),s=!o.has(i);return this.index[t]=o.add(i),s}has(e){const t=e.lastSegment(),i=e.popLast(),o=this.index[t];return o&&o.has(i)}getEntries(e){return(this.index[e]||new _e(se.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Nd=41943040;class Ve{static withCacheSize(e){return new Ve(e,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ve.DEFAULT_COLLECTION_PERCENTILE=10,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ve.DEFAULT=new Ve(Nd,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ve.DISABLED=new Ve(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new ln(0)}static cr(){return new ln(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wl="LruGarbageCollector",Vg=1048576;function Rl([n,e],[t,i]){const o=X(n,t);return o===0?X(e,i):o}class xg{constructor(e){this.Ir=e,this.buffer=new _e(Rl),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();Rl(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class kg{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){O(wl,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){hn(t)?O(wl,"Ignoring IndexedDB error during garbage collection: ",t):await fn(t)}await this.Vr(3e5)}))}}class bg{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((i=>Math.floor(t/100*i)))}nthSequenceNumber(e,t){if(t===0)return k.resolve(ao.ce);const i=new xg(t);return this.mr.forEachTarget(e,(o=>i.Ar(o.sequenceNumber))).next((()=>this.mr.pr(e,(o=>i.Ar(o))))).next((()=>i.maxValue))}removeTargets(e,t,i){return this.mr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),k.resolve(Sl)):this.getCacheSize(e).next((i=>i<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Sl):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let i,o,s,r,c,f,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),o=this.params.maximumSequenceNumbersToCollect):o=m,r=Date.now(),this.nthSequenceNumber(e,o)))).next((m=>(i=m,c=Date.now(),this.removeTargets(e,i,t)))).next((m=>(s=m,f=Date.now(),this.removeOrphanedDocuments(e,i)))).next((m=>(d=Date.now(),Kt()<=ee.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${r-h}ms
	Determined least recently used ${o} in `+(c-r)+`ms
	Removed ${s} targets in `+(f-c)+`ms
	Removed ${m} documents in `+(d-f)+`ms
Total Duration: ${d-h}ms`),k.resolve({didRun:!0,sequenceNumbersCollected:o,targetsRemoved:s,documentsRemoved:m}))))}}function Lg(n,e){return new bg(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fg{constructor(){this.changes=new Bt((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Pe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?k.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qg{constructor(e,t,i,o){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=o}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next((o=>(i=o,this.remoteDocumentCache.getEntry(e,t)))).next((o=>(i!==null&&zn(i.mutation,o,Le.empty(),ue.now()),o)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.getLocalViewOfDocuments(e,i,Z()).next((()=>i))))}getLocalViewOfDocuments(e,t,i=Z()){const o=bt();return this.populateOverlays(e,o,t).next((()=>this.computeViews(e,t,o,i).next((s=>{let r=qn();return s.forEach(((c,f)=>{r=r.insert(c,f.overlayedDocument)})),r}))))}getOverlayedDocuments(e,t){const i=bt();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,Z())))}populateOverlays(e,t,i){const o=[];return i.forEach((s=>{t.has(s)||o.push(s)})),this.documentOverlayCache.getOverlays(e,o).next((s=>{s.forEach(((r,c)=>{t.set(r,c)}))}))}computeViews(e,t,i,o){let s=tt();const r=Jn(),c=(function(){return Jn()})();return t.forEach(((f,d)=>{const h=i.get(d.key);o.has(d.key)&&(h===void 0||h.mutation instanceof Rt)?s=s.insert(d.key,d):h!==void 0?(r.set(d.key,h.mutation.getFieldMask()),zn(h.mutation,d,h.mutation.getFieldMask(),ue.now())):r.set(d.key,Le.empty())})),this.recalculateAndSaveOverlays(e,s).next((f=>(f.forEach(((d,h)=>r.set(d,h))),t.forEach(((d,h)=>c.set(d,new Ug(h,r.get(d)??null)))),c)))}recalculateAndSaveOverlays(e,t){const i=Jn();let o=new ce(((r,c)=>r-c)),s=Z();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((r=>{for(const c of r)c.keys().forEach((f=>{const d=t.get(f);if(d===null)return;let h=i.get(f)||Le.empty();h=c.applyToLocalView(d,h),i.set(f,h);const m=(o.get(c.batchId)||Z()).add(f);o=o.insert(c.batchId,m)}))})).next((()=>{const r=[],c=o.getReverseIterator();for(;c.hasNext();){const f=c.getNext(),d=f.key,h=f.value,m=cd();h.forEach((g=>{if(!s.has(g)){const T=yd(t.get(g),i.get(g));T!==null&&m.set(g,T),s=s.add(g)}})),r.push(this.documentOverlayCache.saveOverlays(e,d,m))}return k.waitFor(r)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((i=>this.recalculateAndSaveOverlays(e,i)))}getDocumentsMatchingQuery(e,t,i,o){return(function(r){return J.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):sd(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,o):this.getDocumentsMatchingCollectionQuery(e,t,i,o)}getNextDocuments(e,t,i,o){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,o).next((s=>{const r=o-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,o-s.size):k.resolve(bt());let c=Qn,f=s;return r.next((d=>k.forEach(d,((h,m)=>(c<m.largestBatchId&&(c=m.largestBatchId),s.get(h)?k.resolve():this.remoteDocumentCache.getEntry(e,h).next((g=>{f=f.insert(h,g)}))))).next((()=>this.populateOverlays(e,d,s))).next((()=>this.computeViews(e,f,d,Z()))).next((h=>({batchId:c,changes:ud(h)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new J(t)).next((i=>{let o=qn();return i.isFoundDocument()&&(o=o.insert(i.key,i)),o}))}getDocumentsMatchingCollectionGroupQuery(e,t,i,o){const s=t.collectionGroup;let r=qn();return this.indexManager.getCollectionParents(e,s).next((c=>k.forEach(c,(f=>{const d=(function(m,g){return new pn(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,f.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,i,o).next((h=>{h.forEach(((m,g)=>{r=r.insert(m,g)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(e,t,i,o){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next((r=>(s=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s,o)))).next((r=>{s.forEach(((f,d)=>{const h=d.getKey();r.get(h)===null&&(r=r.insert(h,Pe.newInvalidDocument(h)))}));let c=qn();return r.forEach(((f,d)=>{const h=s.get(f);h!==void 0&&zn(h.mutation,d,Le.empty(),ue.now()),fo(t,d)&&(c=c.insert(f,d))})),c}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return k.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(o){return{id:o.id,version:o.version,createTime:Ye(o.createTime)}})(t)),k.resolve()}getNamedQuery(e,t){return k.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(o){return{name:o.name,query:Ng(o.bundledQuery),readTime:Ye(o.readTime)}})(t)),k.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg{constructor(){this.overlays=new ce(J.comparator),this.qr=new Map}getOverlay(e,t){return k.resolve(this.overlays.get(t))}getOverlays(e,t){const i=bt();return k.forEach(t,(o=>this.getOverlay(e,o).next((s=>{s!==null&&i.set(o,s)})))).next((()=>i))}saveOverlays(e,t,i){return i.forEach(((o,s)=>{this.St(e,t,s)})),k.resolve()}removeOverlaysForBatchId(e,t,i){const o=this.qr.get(i);return o!==void 0&&(o.forEach((s=>this.overlays=this.overlays.remove(s))),this.qr.delete(i)),k.resolve()}getOverlaysForCollection(e,t,i){const o=bt(),s=t.length+1,r=new J(t.child("")),c=this.overlays.getIteratorFrom(r);for(;c.hasNext();){const f=c.getNext().value,d=f.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===s&&f.largestBatchId>i&&o.set(f.getKey(),f)}return k.resolve(o)}getOverlaysForCollectionGroup(e,t,i,o){let s=new ce(((d,h)=>d-h));const r=this.overlays.getIterator();for(;r.hasNext();){const d=r.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>i){let h=s.get(d.largestBatchId);h===null&&(h=bt(),s=s.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const c=bt(),f=s.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach(((d,h)=>c.set(d,h))),!(c.size()>=o)););return k.resolve(c)}St(e,t,i){const o=this.overlays.get(i.key);if(o!==null){const r=this.qr.get(o.largestBatchId).delete(i.key);this.qr.set(o.largestBatchId,r)}this.overlays=this.overlays.insert(i.key,new sg(t,i));let s=this.qr.get(t);s===void 0&&(s=Z(),this.qr.set(t,s)),this.qr.set(t,s.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og{constructor(){this.sessionToken=Ce.EMPTY_BYTE_STRING}getSessionToken(e){return k.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,k.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(){this.Qr=new _e(Ee.$r),this.Ur=new _e(Ee.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const i=new Ee(e,t);this.Qr=this.Qr.add(i),this.Ur=this.Ur.add(i)}Wr(e,t){e.forEach((i=>this.addReference(i,t)))}removeReference(e,t){this.Gr(new Ee(e,t))}zr(e,t){e.forEach((i=>this.removeReference(i,t)))}jr(e){const t=new J(new se([])),i=new Ee(t,e),o=new Ee(t,e+1),s=[];return this.Ur.forEachInRange([i,o],(r=>{this.Gr(r),s.push(r.key)})),s}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new J(new se([])),i=new Ee(t,e),o=new Ee(t,e+1);let s=Z();return this.Ur.forEachInRange([i,o],(r=>{s=s.add(r.key)})),s}containsKey(e){const t=new Ee(e,0),i=this.Qr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class Ee{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return J.comparator(e.key,t.key)||X(e.Yr,t.Yr)}static Kr(e,t){return X(e.Yr,t.Yr)||J.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new _e(Ee.$r)}checkEmpty(e){return k.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,o){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new og(s,t,i,o);this.mutationQueue.push(r);for(const c of o)this.Zr=this.Zr.add(new Ee(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return k.resolve(r)}lookupMutationBatch(e,t){return k.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,o=this.ei(i),s=o<0?0:o;return k.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return k.resolve(this.mutationQueue.length===0?Ws:this.tr-1)}getAllMutationBatches(e){return k.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Ee(t,0),o=new Ee(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([i,o],(r=>{const c=this.Xr(r.Yr);s.push(c)})),k.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new _e(X);return t.forEach((o=>{const s=new Ee(o,0),r=new Ee(o,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,r],(c=>{i=i.add(c.Yr)}))})),k.resolve(this.ti(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,o=i.length+1;let s=i;J.isDocumentKey(s)||(s=s.child(""));const r=new Ee(new J(s),0);let c=new _e(X);return this.Zr.forEachWhile((f=>{const d=f.key.path;return!!i.isPrefixOf(d)&&(d.length===o&&(c=c.add(f.Yr)),!0)}),r),k.resolve(this.ti(c))}ti(e){const t=[];return e.forEach((i=>{const o=this.Xr(i);o!==null&&t.push(o)})),t}removeMutationBatch(e,t){ne(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Zr;return k.forEach(t.mutations,(o=>{const s=new Ee(o.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,o.key)})).next((()=>{this.Zr=i}))}ir(e){}containsKey(e,t){const i=new Ee(t,0),o=this.Zr.firstAfterOrEqual(i);return k.resolve(t.isEqual(o&&o.key))}performConsistencyCheck(e){return this.mutationQueue.length,k.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(e){this.ri=e,this.docs=(function(){return new ce(J.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,o=this.docs.get(i),s=o?o.size:0,r=this.ri(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return k.resolve(i?i.document.mutableCopy():Pe.newInvalidDocument(t))}getEntries(e,t){let i=tt();return t.forEach((o=>{const s=this.docs.get(o);i=i.insert(o,s?s.document.mutableCopy():Pe.newInvalidDocument(o))})),k.resolve(i)}getDocumentsMatchingQuery(e,t,i,o){let s=tt();const r=t.path,c=new J(r.child("__id-9223372036854775808__")),f=this.docs.getIteratorFrom(c);for(;f.hasNext();){const{key:d,value:{document:h}}=f.getNext();if(!r.isPrefixOf(d.path))break;d.path.length>r.length+1||Tm(_m(h),i)<=0||(o.has(h.key)||fo(t,h))&&(s=s.insert(h.key,h.mutableCopy()))}return k.resolve(s)}getAllFromCollectionGroup(e,t,i,o){K(9500)}ii(e,t){return k.forEach(this.docs,(i=>t(i)))}newChangeBuffer(e){return new Jg(this)}getSize(e){return k.resolve(this.size)}}class Jg extends Fg{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((i,o)=>{o.isValidDocument()?t.push(this.Nr.addEntry(e,o)):this.Nr.removeEntry(i)})),k.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(e){this.persistence=e,this.si=new Bt((t=>Xs(t)),Zs),this.lastRemoteSnapshotVersion=W.min(),this.highestTargetId=0,this.oi=0,this._i=new or,this.targetCount=0,this.ai=ln.ur()}forEachTarget(e,t){return this.si.forEach(((i,o)=>t(o))),k.resolve()}getLastRemoteSnapshotVersion(e){return k.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return k.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),k.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.oi&&(this.oi=t),k.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new ln(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,k.resolve()}updateTargetData(e,t){return this.Pr(t),k.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,k.resolve()}removeTargets(e,t,i){let o=0;const s=[];return this.si.forEach(((r,c)=>{c.sequenceNumber<=t&&i.get(c.targetId)===null&&(this.si.delete(r),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),o++)})),k.waitFor(s).next((()=>o))}getTargetCount(e){return k.resolve(this.targetCount)}getTargetData(e,t){const i=this.si.get(t)||null;return k.resolve(i)}addMatchingKeys(e,t,i){return this._i.Wr(t,i),k.resolve()}removeMatchingKeys(e,t,i){this._i.zr(t,i);const o=this.persistence.referenceDelegate,s=[];return o&&t.forEach((r=>{s.push(o.markPotentiallyOrphaned(e,r))})),k.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),k.resolve()}getMatchingKeysForTargetId(e,t){const i=this._i.Hr(t);return k.resolve(i)}containsKey(e,t){return k.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Md{constructor(e,t){this.ui={},this.overlays={},this.ci=new ao(0),this.li=!1,this.li=!0,this.hi=new Og,this.referenceDelegate=e(this),this.Pi=new zg(this),this.indexManager=new Mg,this.remoteDocumentCache=(function(o){return new $g(o)})((i=>this.referenceDelegate.Ti(i))),this.serializer=new Pg(t),this.Ii=new Bg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Gg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.ui[e.toKey()];return i||(i=new Hg(t,this.referenceDelegate),this.ui[e.toKey()]=i),i}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,i){O("MemoryPersistence","Starting transaction:",e);const o=new Kg(this.ci.next());return this.referenceDelegate.Ei(),i(o).next((s=>this.referenceDelegate.di(o).next((()=>s)))).toPromise().then((s=>(o.raiseOnCommittedEvent(),s)))}Ai(e,t){return k.or(Object.values(this.ui).map((i=>()=>i.containsKey(e,t))))}}class Kg extends Im{constructor(e){super(),this.currentSequenceNumber=e}}class sr{constructor(e){this.persistence=e,this.Ri=new or,this.Vi=null}static mi(e){return new sr(e)}get fi(){if(this.Vi)return this.Vi;throw K(60996)}addReference(e,t,i){return this.Ri.addReference(i,t),this.fi.delete(i.toString()),k.resolve()}removeReference(e,t,i){return this.Ri.removeReference(i,t),this.fi.add(i.toString()),k.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),k.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((o=>this.fi.add(o.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next((o=>{o.forEach((s=>this.fi.add(s.toString())))})).next((()=>i.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return k.forEach(this.fi,(i=>{const o=J.fromPath(i);return this.gi(e,o).next((s=>{s||t.removeEntry(o,W.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((i=>{i?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return k.or([()=>k.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Zi{constructor(e,t){this.persistence=e,this.pi=new Bt((i=>Cm(i.path)),((i,o)=>i.isEqual(o))),this.garbageCollector=Lg(this,t)}static mi(e,t){return new Zi(e,t)}Ei(){}di(e){return k.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((i=>t.next((o=>i+o))))}wr(e){let t=0;return this.pr(e,(i=>{t++})).next((()=>t))}pr(e,t){return k.forEach(this.pi,((i,o)=>this.br(e,i,o).next((s=>s?k.resolve():t(o)))))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0;const o=this.persistence.getRemoteDocumentCache(),s=o.newChangeBuffer();return o.ii(e,(r=>this.br(e,r,t).next((c=>{c||(i++,s.removeEntry(r,W.min()))})))).next((()=>s.apply(e))).next((()=>i))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),k.resolve()}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.pi.set(i,e.currentSequenceNumber),k.resolve()}removeReference(e,t,i){return this.pi.set(i,e.currentSequenceNumber),k.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),k.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ki(e.data.value)),t}br(e,t,i){return k.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const o=this.pi.get(t);return k.resolve(o!==void 0&&o>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e,t,i,o){this.targetId=e,this.fromCache=t,this.Es=i,this.ds=o}static As(e,t){let i=Z(),o=Z();for(const s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:o=o.add(s.doc.key)}return new rr(e,t.fromCache,i,o)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return qh()?8:vm(Fh())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,i,o){const s={result:null};return this.ys(e,t).next((r=>{s.result=r})).next((()=>{if(!s.result)return this.ws(e,t,o,i).next((r=>{s.result=r}))})).next((()=>{if(s.result)return;const r=new Wg;return this.Ss(e,t,r).next((c=>{if(s.result=c,this.Vs)return this.bs(e,t,r,c.size)}))})).next((()=>s.result))}bs(e,t,i,o){return i.documentReadCount<this.fs?(Kt()<=ee.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",Wt(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),k.resolve()):(Kt()<=ee.DEBUG&&O("QueryEngine","Query:",Wt(t),"scans",i.documentReadCount,"local documents and returns",o,"documents as results."),i.documentReadCount>this.gs*o?(Kt()<=ee.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",Wt(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,We(t))):k.resolve())}ys(e,t){if(ml(t))return k.resolve(null);let i=We(t);return this.indexManager.getIndexType(e,i).next((o=>o===0?null:(t.limit!==null&&o===1&&(t=Yi(t,null,"F"),i=We(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next((s=>{const r=Z(...s);return this.ps.getDocuments(e,r).next((c=>this.indexManager.getMinOffset(e,i).next((f=>{const d=this.Ds(t,c);return this.Cs(t,d,r,f.readTime)?this.ys(e,Yi(t,null,"F")):this.vs(e,d,t,f)}))))})))))}ws(e,t,i,o){return ml(t)||o.isEqual(W.min())?k.resolve(null):this.ps.getDocuments(e,i).next((s=>{const r=this.Ds(t,s);return this.Cs(t,r,i,o)?k.resolve(null):(Kt()<=ee.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",o.toString(),Wt(t)),this.vs(e,r,t,ym(o,Qn)).next((c=>c)))}))}Ds(e,t){let i=new _e(ad(e));return t.forEach(((o,s)=>{fo(e,s)&&(i=i.add(s))})),i}Cs(e,t,i,o){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(o)>0)}Ss(e,t,i){return Kt()<=ee.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",Wt(t)),this.ps.getDocumentsMatchingQuery(e,t,Tt.min(),i)}vs(e,t,i,o){return this.ps.getDocumentsMatchingQuery(e,i,o).next((s=>(t.forEach((r=>{s=s.insert(r.key,r)})),s)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ar="LocalStore",Qg=3e8;class Xg{constructor(e,t,i,o){this.persistence=e,this.Fs=t,this.serializer=o,this.Ms=new ce(X),this.xs=new Bt((s=>Xs(s)),Zs),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(i)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new qg(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function Zg(n,e,t,i){return new Xg(n,e,t,i)}async function Dd(n,e){const t=Y(n);return await t.persistence.runTransaction("Handle user change","readonly",(i=>{let o;return t.mutationQueue.getAllMutationBatches(i).next((s=>(o=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(i)))).next((s=>{const r=[],c=[];let f=Z();for(const d of o){r.push(d.batchId);for(const h of d.mutations)f=f.add(h.key)}for(const d of s){c.push(d.batchId);for(const h of d.mutations)f=f.add(h.key)}return t.localDocuments.getDocuments(i,f).next((d=>({Ls:d,removedBatchIds:r,addedBatchIds:c})))}))}))}function jg(n,e){const t=Y(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(i=>{const o=e.batch.keys(),s=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,f,d,h){const m=d.batch,g=m.keys();let T=k.resolve();return g.forEach((P=>{T=T.next((()=>h.getEntry(f,P))).next((M=>{const N=d.docVersions.get(P);ne(N!==null,48541),M.version.compareTo(N)<0&&(m.applyToRemoteDocument(M,d),M.isValidDocument()&&(M.setReadTime(d.commitVersion),h.addEntry(M)))}))})),T.next((()=>c.mutationQueue.removeMutationBatch(f,m)))})(t,i,e,s).next((()=>s.apply(i))).next((()=>t.mutationQueue.performConsistencyCheck(i))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(i,o,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,(function(c){let f=Z();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(f=f.add(c.batch.mutations[d].key));return f})(e)))).next((()=>t.localDocuments.getDocuments(i,o)))}))}function Vd(n){const e=Y(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function ey(n,e){const t=Y(n),i=e.snapshotVersion;let o=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(s=>{const r=t.Ns.newChangeBuffer({trackRemovals:!0});o=t.Ms;const c=[];e.targetChanges.forEach(((h,m)=>{const g=o.get(m);if(!g)return;c.push(t.Pi.removeMatchingKeys(s,h.removedDocuments,m).next((()=>t.Pi.addMatchingKeys(s,h.addedDocuments,m))));let T=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?T=T.withResumeToken(Ce.EMPTY_BYTE_STRING,W.min()).withLastLimboFreeSnapshotVersion(W.min()):h.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(h.resumeToken,i)),o=o.insert(m,T),(function(M,N,V){return M.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-M.snapshotVersion.toMicroseconds()>=Qg?!0:V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0})(g,T,h)&&c.push(t.Pi.updateTargetData(s,T))}));let f=tt(),d=Z();if(e.documentUpdates.forEach((h=>{e.resolvedLimboDocuments.has(h)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,h))})),c.push(ty(s,r,e.documentUpdates).next((h=>{f=h.ks,d=h.qs}))),!i.isEqual(W.min())){const h=t.Pi.getLastRemoteSnapshotVersion(s).next((m=>t.Pi.setTargetsMetadata(s,s.currentSequenceNumber,i)));c.push(h)}return k.waitFor(c).next((()=>r.apply(s))).next((()=>t.localDocuments.getLocalViewOfDocuments(s,f,d))).next((()=>f))})).then((s=>(t.Ms=o,s)))}function ty(n,e,t){let i=Z(),o=Z();return t.forEach((s=>i=i.add(s))),e.getEntries(n,i).next((s=>{let r=tt();return t.forEach(((c,f)=>{const d=s.get(c);f.isFoundDocument()!==d.isFoundDocument()&&(o=o.add(c)),f.isNoDocument()&&f.version.isEqual(W.min())?(e.removeEntry(c,f.readTime),r=r.insert(c,f)):!d.isValidDocument()||f.version.compareTo(d.version)>0||f.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(f),r=r.insert(c,f)):O(ar,"Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",f.version)})),{ks:r,qs:o}}))}function ny(n,e){const t=Y(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(i=>(e===void 0&&(e=Ws),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e))))}function iy(n,e){const t=Y(n);return t.persistence.runTransaction("Allocate target","readwrite",(i=>{let o;return t.Pi.getTargetData(i,e).next((s=>s?(o=s,k.resolve(o)):t.Pi.allocateTargetId(i).next((r=>(o=new ft(e,r,"TargetPurposeListen",i.currentSequenceNumber),t.Pi.addTargetData(i,o).next((()=>o)))))))})).then((i=>{const o=t.Ms.get(i.targetId);return(o===null||i.snapshotVersion.compareTo(o.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(i.targetId,i),t.xs.set(e,i.targetId)),i}))}async function Rs(n,e,t){const i=Y(n),o=i.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",s,(r=>i.persistence.referenceDelegate.removeTarget(r,o)))}catch(r){if(!hn(r))throw r;O(ar,`Failed to update sequence numbers for target ${e}: ${r}`)}i.Ms=i.Ms.remove(e),i.xs.delete(o.target)}function Pl(n,e,t){const i=Y(n);let o=W.min(),s=Z();return i.persistence.runTransaction("Execute query","readwrite",(r=>(function(f,d,h){const m=Y(f),g=m.xs.get(h);return g!==void 0?k.resolve(m.Ms.get(g)):m.Pi.getTargetData(d,h)})(i,r,We(e)).next((c=>{if(c)return o=c.lastLimboFreeSnapshotVersion,i.Pi.getMatchingKeysForTargetId(r,c.targetId).next((f=>{s=f}))})).next((()=>i.Fs.getDocumentsMatchingQuery(r,e,t?o:W.min(),t?s:Z()))).next((c=>(oy(i,Hm(e),c),{documents:c,Qs:s})))))}function oy(n,e,t){let i=n.Os.get(e)||W.min();t.forEach(((o,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)})),n.Os.set(e,i)}class Nl{constructor(){this.activeTargetIds=Ym()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class sy{constructor(){this.Mo=new Nl,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,i){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Nl,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ry{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ml="ConnectivityMonitor";class Dl{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){O(Ml,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){O(Ml,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mi=null;function Ps(){return Mi===null?Mi=(function(){return 268435456+Math.round(2147483648*Math.random())})():Mi++,"0x"+Mi.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rs="RestConnection",ay={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ly{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${i}/databases/${o}`,this.Wo=this.databaseId.database===zi?`project_id=${i}`:`project_id=${i}&database_id=${o}`}Go(e,t,i,o,s){const r=Ps(),c=this.zo(e,t.toUriEncodedString());O(rs,`Sending RPC '${e}' ${r}:`,c,i);const f={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(f,o,s);const{host:d}=new URL(c),h=$s(d);return this.Jo(e,c,f,i,h).then((m=>(O(rs,`Received RPC '${e}' ${r}: `,m),m)),(m=>{throw on(rs,`RPC '${e}' ${r} failed with error: `,m,"url: ",c,"request:",i),m}))}Ho(e,t,i,o,s,r){return this.Go(e,t,i,o,s)}jo(e,t,i){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+dn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((o,s)=>e[s]=o)),i&&i.headers.forEach(((o,s)=>e[s]=o))}zo(e,t){const i=ay[e];return`${this.Uo}/v1/${t}:${i}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const we="WebChannelConnection";class cy extends ly{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,i,o,s){const r=Ps();return new Promise(((c,f)=>{const d=new kc;d.setWithCredentials(!0),d.listenOnce(bc.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case xi.NO_ERROR:const m=d.getResponseJson();O(we,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(m)),c(m);break;case xi.TIMEOUT:O(we,`RPC '${e}' ${r} timed out`),f(new B(x.DEADLINE_EXCEEDED,"Request time out"));break;case xi.HTTP_ERROR:const g=d.getStatus();if(O(we,`RPC '${e}' ${r} failed with status:`,g,"response text:",d.getResponseText()),g>0){let T=d.getResponseJson();Array.isArray(T)&&(T=T[0]);const P=T==null?void 0:T.error;if(P&&P.status&&P.message){const M=(function(V){const L=V.toLowerCase().replace(/_/g,"-");return Object.values(x).indexOf(L)>=0?L:x.UNKNOWN})(P.status);f(new B(M,P.message))}else f(new B(x.UNKNOWN,"Server responded with status "+d.getStatus()))}else f(new B(x.UNAVAILABLE,"Connection failed."));break;default:K(9055,{l_:e,streamId:r,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{O(we,`RPC '${e}' ${r} completed.`)}}));const h=JSON.stringify(o);O(we,`RPC '${e}' ${r} sending request:`,o),d.send(t,"POST",h,i,15)}))}T_(e,t,i){const o=Ps(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=Uc(),c=Fc(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(f.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(f.useFetchStreams=!0),this.jo(f.initMessageHeaders,t,i),f.encodeInitMessageHeaders=!0;const h=s.join("");O(we,`Creating RPC '${e}' stream ${o}: ${h}`,f);const m=r.createWebChannel(h,f);this.I_(m);let g=!1,T=!1;const P=new uy({Yo:N=>{T?O(we,`Not sending because RPC '${e}' stream ${o} is closed:`,N):(g||(O(we,`Opening RPC '${e}' stream ${o} transport.`),m.open(),g=!0),O(we,`RPC '${e}' stream ${o} sending:`,N),m.send(N))},Zo:()=>m.close()}),M=(N,V,L)=>{N.listen(V,(b=>{try{L(b)}catch(H){setTimeout((()=>{throw H}),0)}}))};return M(m,Un.EventType.OPEN,(()=>{T||(O(we,`RPC '${e}' stream ${o} transport opened.`),P.o_())})),M(m,Un.EventType.CLOSE,(()=>{T||(T=!0,O(we,`RPC '${e}' stream ${o} transport closed`),P.a_(),this.E_(m))})),M(m,Un.EventType.ERROR,(N=>{T||(T=!0,on(we,`RPC '${e}' stream ${o} transport errored. Name:`,N.name,"Message:",N.message),P.a_(new B(x.UNAVAILABLE,"The operation could not be completed")))})),M(m,Un.EventType.MESSAGE,(N=>{var V;if(!T){const L=N.data[0];ne(!!L,16349);const b=L,H=(b==null?void 0:b.error)||((V=b[0])==null?void 0:V.error);if(H){O(we,`RPC '${e}' stream ${o} received error:`,H);const z=H.status;let $=(function(E){const C=pe[E];if(C!==void 0)return Td(C)})(z),A=H.message;$===void 0&&($=x.INTERNAL,A="Unknown error status: "+z+" with message "+H.message),T=!0,P.a_(new B($,A)),m.close()}else O(we,`RPC '${e}' stream ${o} received:`,L),P.u_(L)}})),M(c,Lc.STAT_EVENT,(N=>{N.stat===gs.PROXY?O(we,`RPC '${e}' stream ${o} detected buffering proxy`):N.stat===gs.NOPROXY&&O(we,`RPC '${e}' stream ${o} detected no buffering proxy`)})),setTimeout((()=>{P.__()}),0),P}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function as(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yo(n){return new pg(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xd{constructor(e,t,i=1e3,o=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=i,this.A_=o,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),i=Math.max(0,Date.now()-this.f_),o=Math.max(0,t-i);o>0&&O("ExponentialBackoff",`Backing off for ${o} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,o,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vl="PersistentStream";class kd{constructor(e,t,i,o,s,r,c,f){this.Mi=e,this.S_=i,this.b_=o,this.connection=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=c,this.listener=f,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new xd(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(et(t.toString()),et("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===x.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([i,o])=>{this.D_===t&&this.G_(i,o)}),(i=>{e((()=>{const o=new B(x.UNKNOWN,"Fetching auth token failed: "+i.message);return this.z_(o)}))}))}G_(e,t){const i=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{i((()=>this.listener.Xo()))})),this.stream.t_((()=>{i((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((o=>{i((()=>this.z_(o)))})),this.stream.onMessage((o=>{i((()=>++this.F_==1?this.J_(o):this.onNext(o)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return O(Vl,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(O(Vl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class dy extends kd{constructor(e,t,i,o,s,r){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,o,r),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=yg(this.serializer,e),i=(function(s){if(!("targetChange"in s))return W.min();const r=s.targetChange;return r.targetIds&&r.targetIds.length?W.min():r.readTime?Ye(r.readTime):W.min()})(e);return this.listener.H_(t,i)}Y_(e){const t={};t.database=ws(this.serializer),t.addTarget=(function(s,r){let c;const f=r.target;if(c=Is(f)?{documents:Eg(s,f)}:{query:Ig(s,f).ft},c.targetId=r.targetId,r.resumeToken.approximateByteSize()>0){c.resumeToken=vd(s,r.resumeToken);const d=As(s,r.expectedCount);d!==null&&(c.expectedCount=d)}else if(r.snapshotVersion.compareTo(W.min())>0){c.readTime=Xi(s,r.snapshotVersion.toTimestamp());const d=As(s,r.expectedCount);d!==null&&(c.expectedCount=d)}return c})(this.serializer,e);const i=Ag(this.serializer,e);i&&(t.labels=i),this.q_(t)}Z_(e){const t={};t.database=ws(this.serializer),t.removeTarget=e,this.q_(t)}}class fy extends kd{constructor(e,t,i,o,s,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,o,r),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ne(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ne(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ne(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Tg(e.writeResults,e.commitTime),i=Ye(e.commitTime);return this.listener.na(i,t)}ra(){const e={};e.database=ws(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((i=>_g(this.serializer,i)))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{}class py extends hy{constructor(e,t,i,o){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=o,this.ia=!1}sa(){if(this.ia)throw new B(x.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,r])=>this.connection.Go(e,Cs(t,i),o,s,r))).catch((s=>{throw s.name==="FirebaseError"?(s.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new B(x.UNKNOWN,s.toString())}))}Ho(e,t,i,o,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,c])=>this.connection.Ho(e,Cs(t,i),o,r,c,s))).catch((r=>{throw r.name==="FirebaseError"?(r.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new B(x.UNKNOWN,r.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class my{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(et(t),this.aa=!1):O("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qt="RemoteStore";class gy{constructor(e,t,i,o,s){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo((r=>{i.enqueueAndForget((async()=>{Gt(this)&&(O(qt,"Restarting streams for network reachability change."),await(async function(f){const d=Y(f);d.Ea.add(4),await ai(d),d.Ra.set("Unknown"),d.Ea.delete(4),await _o(d)})(this))}))})),this.Ra=new my(i,o)}}async function _o(n){if(Gt(n))for(const e of n.da)await e(!0)}async function ai(n){for(const e of n.da)await e(!1)}function bd(n,e){const t=Y(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),dr(t)?cr(t):mn(t).O_()&&ur(t,e))}function lr(n,e){const t=Y(n),i=mn(t);t.Ia.delete(e),i.O_()&&Ld(t,e),t.Ia.size===0&&(i.O_()?i.L_():Gt(t)&&t.Ra.set("Unknown"))}function ur(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(W.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}mn(n).Y_(e)}function Ld(n,e){n.Va.Ue(e),mn(n).Z_(e)}function cr(n){n.Va=new cg({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),mn(n).start(),n.Ra.ua()}function dr(n){return Gt(n)&&!mn(n).x_()&&n.Ia.size>0}function Gt(n){return Y(n).Ea.size===0}function Fd(n){n.Va=void 0}async function yy(n){n.Ra.set("Online")}async function _y(n){n.Ia.forEach(((e,t)=>{ur(n,e)}))}async function Ty(n,e){Fd(n),dr(n)?(n.Ra.ha(e),cr(n)):n.Ra.set("Unknown")}async function Ey(n,e,t){if(n.Ra.set("Online"),e instanceof Id&&e.state===2&&e.cause)try{await(async function(o,s){const r=s.cause;for(const c of s.targetIds)o.Ia.has(c)&&(await o.remoteSyncer.rejectListen(c,r),o.Ia.delete(c),o.Va.removeTarget(c))})(n,e)}catch(i){O(qt,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),await ji(n,i)}else if(e instanceof Fi?n.Va.Ze(e):e instanceof Ed?n.Va.st(e):n.Va.tt(e),!t.isEqual(W.min()))try{const i=await Vd(n.localStore);t.compareTo(i)>=0&&await(function(s,r){const c=s.Va.Tt(r);return c.targetChanges.forEach(((f,d)=>{if(f.resumeToken.approximateByteSize()>0){const h=s.Ia.get(d);h&&s.Ia.set(d,h.withResumeToken(f.resumeToken,r))}})),c.targetMismatches.forEach(((f,d)=>{const h=s.Ia.get(f);if(!h)return;s.Ia.set(f,h.withResumeToken(Ce.EMPTY_BYTE_STRING,h.snapshotVersion)),Ld(s,f);const m=new ft(h.target,f,d,h.sequenceNumber);ur(s,m)})),s.remoteSyncer.applyRemoteEvent(c)})(n,t)}catch(i){O(qt,"Failed to raise snapshot:",i),await ji(n,i)}}async function ji(n,e,t){if(!hn(e))throw e;n.Ea.add(1),await ai(n),n.Ra.set("Offline"),t||(t=()=>Vd(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{O(qt,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await _o(n)}))}function Ud(n,e){return e().catch((t=>ji(n,t,e)))}async function To(n){const e=Y(n),t=At(e);let i=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ws;for(;Iy(e);)try{const o=await ny(e.localStore,i);if(o===null){e.Ta.length===0&&t.L_();break}i=o.batchId,vy(e,o)}catch(o){await ji(e,o)}qd(e)&&Bd(e)}function Iy(n){return Gt(n)&&n.Ta.length<10}function vy(n,e){n.Ta.push(e);const t=At(n);t.O_()&&t.X_&&t.ea(e.mutations)}function qd(n){return Gt(n)&&!At(n).x_()&&n.Ta.length>0}function Bd(n){At(n).start()}async function Ay(n){At(n).ra()}async function Cy(n){const e=At(n);for(const t of n.Ta)e.ea(t.mutations)}async function Sy(n,e,t){const i=n.Ta.shift(),o=tr.from(i,e,t);await Ud(n,(()=>n.remoteSyncer.applySuccessfulWrite(o))),await To(n)}async function wy(n,e){e&&At(n).X_&&await(async function(i,o){if((function(r){return ag(r)&&r!==x.ABORTED})(o.code)){const s=i.Ta.shift();At(i).B_(),await Ud(i,(()=>i.remoteSyncer.rejectFailedWrite(s.batchId,o))),await To(i)}})(n,e),qd(n)&&Bd(n)}async function xl(n,e){const t=Y(n);t.asyncQueue.verifyOperationInProgress(),O(qt,"RemoteStore received new credentials");const i=Gt(t);t.Ea.add(3),await ai(t),i&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await _o(t)}async function Ry(n,e){const t=Y(n);e?(t.Ea.delete(2),await _o(t)):e||(t.Ea.add(2),await ai(t),t.Ra.set("Unknown"))}function mn(n){return n.ma||(n.ma=(function(t,i,o){const s=Y(t);return s.sa(),new dy(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,o)})(n.datastore,n.asyncQueue,{Xo:yy.bind(null,n),t_:_y.bind(null,n),r_:Ty.bind(null,n),H_:Ey.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),dr(n)?cr(n):n.Ra.set("Unknown")):(await n.ma.stop(),Fd(n))}))),n.ma}function At(n){return n.fa||(n.fa=(function(t,i,o){const s=Y(t);return s.sa(),new fy(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,o)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Ay.bind(null,n),r_:wy.bind(null,n),ta:Cy.bind(null,n),na:Sy.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await To(n)):(await n.fa.stop(),n.Ta.length>0&&(O(qt,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr{constructor(e,t,i,o,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=o,this.removalCallback=s,this.deferred=new yt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((r=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,o,s){const r=Date.now()+i,c=new fr(e,t,r,o,s);return c.start(i),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new B(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hr(n,e){if(et("AsyncQueue",`${e}: ${n}`),hn(n))return new B(x.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{static emptySet(e){return new jt(e.comparator)}constructor(e){this.comparator=e?(t,i)=>e(t,i)||J.comparator(t.key,i.key):(t,i)=>J.comparator(t.key,i.key),this.keyedMap=qn(),this.sortedSet=new ce(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,i)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof jt)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const o=t.getNext().key,s=i.getNext().key;if(!o.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new jt;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl{constructor(){this.ga=new ce(J.comparator)}track(e){const t=e.doc.key,i=this.ga.get(t);i?e.type!==0&&i.type===3?this.ga=this.ga.insert(t,e):e.type===3&&i.type!==1?this.ga=this.ga.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.ga=this.ga.remove(t):e.type===1&&i.type===2?this.ga=this.ga.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):K(63341,{Rt:e,pa:i}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,i)=>{e.push(i)})),e}}class un{constructor(e,t,i,o,s,r,c,f,d){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=o,this.mutatedKeys=s,this.fromCache=r,this.syncStateChanged=c,this.excludesMetadataChanges=f,this.hasCachedResults=d}static fromInitialDocuments(e,t,i,o,s){const r=[];return t.forEach((c=>{r.push({type:0,doc:c})})),new un(e,t,jt.emptySet(t),r,i,o,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&co(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let o=0;o<t.length;o++)if(t[o].type!==i[o].type||!t[o].doc.isEqual(i[o].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Py{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class Ny{constructor(){this.queries=bl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,i){const o=Y(t),s=o.queries;o.queries=bl(),s.forEach(((r,c)=>{for(const f of c.Sa)f.onError(i)}))})(this,new B(x.ABORTED,"Firestore shutting down"))}}function bl(){return new Bt((n=>rd(n)),co)}async function Gd(n,e){const t=Y(n);let i=3;const o=e.query;let s=t.queries.get(o);s?!s.ba()&&e.Da()&&(i=2):(s=new Py,i=e.Da()?0:1);try{switch(i){case 0:s.wa=await t.onListen(o,!0);break;case 1:s.wa=await t.onListen(o,!1);break;case 2:await t.onFirstRemoteStoreListen(o)}}catch(r){const c=hr(r,`Initialization of query '${Wt(e.query)}' failed`);return void e.onError(c)}t.queries.set(o,s),s.Sa.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&pr(t)}async function Od(n,e){const t=Y(n),i=e.query;let o=3;const s=t.queries.get(i);if(s){const r=s.Sa.indexOf(e);r>=0&&(s.Sa.splice(r,1),s.Sa.length===0?o=e.Da()?0:1:!s.ba()&&e.Da()&&(o=2))}switch(o){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function My(n,e){const t=Y(n);let i=!1;for(const o of e){const s=o.query,r=t.queries.get(s);if(r){for(const c of r.Sa)c.Fa(o)&&(i=!0);r.wa=o}}i&&pr(t)}function Dy(n,e,t){const i=Y(n),o=i.queries.get(e);if(o)for(const s of o.Sa)s.onError(t);i.queries.delete(e)}function pr(n){n.Ca.forEach((e=>{e.next()}))}var Ns,Ll;(Ll=Ns||(Ns={})).Ma="default",Ll.Cache="cache";class Hd{constructor(e,t,i){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=i||{}}Fa(e){if(!this.options.includeMetadataChanges){const i=[];for(const o of e.docChanges)o.type!==3&&i.push(o);e=new un(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const i=t!=="Offline";return(!this.options.qa||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=un.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ns.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d{constructor(e){this.key=e}}class Jd{constructor(e){this.key=e}}class Vy{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Z(),this.mutatedKeys=Z(),this.eu=ad(e),this.tu=new jt(this.eu)}get nu(){return this.Ya}ru(e,t){const i=t?t.iu:new kl,o=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,r=o,c=!1;const f=this.query.limitType==="F"&&o.size===this.query.limit?o.last():null,d=this.query.limitType==="L"&&o.size===this.query.limit?o.first():null;if(e.inorderTraversal(((h,m)=>{const g=o.get(h),T=fo(this.query,m)?m:null,P=!!g&&this.mutatedKeys.has(g.key),M=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations);let N=!1;g&&T?g.data.isEqual(T.data)?P!==M&&(i.track({type:3,doc:T}),N=!0):this.su(g,T)||(i.track({type:2,doc:T}),N=!0,(f&&this.eu(T,f)>0||d&&this.eu(T,d)<0)&&(c=!0)):!g&&T?(i.track({type:0,doc:T}),N=!0):g&&!T&&(i.track({type:1,doc:g}),N=!0,(f||d)&&(c=!0)),N&&(T?(r=r.add(T),s=M?s.add(h):s.delete(h)):(r=r.delete(h),s=s.delete(h)))})),this.query.limit!==null)for(;r.size>this.query.limit;){const h=this.query.limitType==="F"?r.last():r.first();r=r.delete(h.key),s=s.delete(h.key),i.track({type:1,doc:h})}return{tu:r,iu:i,Cs:c,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,o){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const r=e.iu.ya();r.sort(((h,m)=>(function(T,P){const M=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return K(20277,{Rt:N})}};return M(T)-M(P)})(h.type,m.type)||this.eu(h.doc,m.doc))),this.ou(i),o=o??!1;const c=t&&!o?this._u():[],f=this.Xa.size===0&&this.current&&!o?1:0,d=f!==this.Za;return this.Za=f,r.length!==0||d?{snapshot:new un(this.query,e.tu,s,r,e.mutatedKeys,f===0,d,!1,!!i&&i.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new kl,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Z(),this.tu.forEach((i=>{this.uu(i.key)&&(this.Xa=this.Xa.add(i.key))}));const t=[];return e.forEach((i=>{this.Xa.has(i)||t.push(new Jd(i))})),this.Xa.forEach((i=>{e.has(i)||t.push(new $d(i))})),t}cu(e){this.Ya=e.Qs,this.Xa=Z();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return un.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const mr="SyncEngine";class xy{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class ky{constructor(e){this.key=e,this.hu=!1}}class by{constructor(e,t,i,o,s,r){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=o,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.Pu={},this.Tu=new Bt((c=>rd(c)),co),this.Iu=new Map,this.Eu=new Set,this.du=new ce(J.comparator),this.Au=new Map,this.Ru=new or,this.Vu={},this.mu=new Map,this.fu=ln.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Ly(n,e,t=!0){const i=Xd(n);let o;const s=i.Tu.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),o=s.view.lu()):o=await zd(i,e,t,!0),o}async function Fy(n,e){const t=Xd(n);await zd(t,e,!0,!1)}async function zd(n,e,t,i){const o=await iy(n.localStore,We(e)),s=o.targetId,r=n.sharedClientState.addLocalQueryTarget(s,t);let c;return i&&(c=await Uy(n,e,s,r==="current",o.resumeToken)),n.isPrimaryClient&&t&&bd(n.remoteStore,o),c}async function Uy(n,e,t,i,o){n.pu=(m,g,T)=>(async function(M,N,V,L){let b=N.view.ru(V);b.Cs&&(b=await Pl(M.localStore,N.query,!1).then((({documents:A})=>N.view.ru(A,b))));const H=L&&L.targetChanges.get(N.targetId),z=L&&L.targetMismatches.get(N.targetId)!=null,$=N.view.applyChanges(b,M.isPrimaryClient,H,z);return Ul(M,N.targetId,$.au),$.snapshot})(n,m,g,T);const s=await Pl(n.localStore,e,!0),r=new Vy(e,s.Qs),c=r.ru(s.documents),f=ri.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",o),d=r.applyChanges(c,n.isPrimaryClient,f);Ul(n,t,d.au);const h=new xy(e,t,r);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function qy(n,e,t){const i=Y(n),o=i.Tu.get(e),s=i.Iu.get(o.targetId);if(s.length>1)return i.Iu.set(o.targetId,s.filter((r=>!co(r,e)))),void i.Tu.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(o.targetId),i.sharedClientState.isActiveQueryTarget(o.targetId)||await Rs(i.localStore,o.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(o.targetId),t&&lr(i.remoteStore,o.targetId),Ms(i,o.targetId)})).catch(fn)):(Ms(i,o.targetId),await Rs(i.localStore,o.targetId,!0))}async function By(n,e){const t=Y(n),i=t.Tu.get(e),o=t.Iu.get(i.targetId);t.isPrimaryClient&&o.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),lr(t.remoteStore,i.targetId))}async function Gy(n,e,t){const i=Wy(n);try{const o=await(function(r,c){const f=Y(r),d=ue.now(),h=c.reduce(((T,P)=>T.add(P.key)),Z());let m,g;return f.persistence.runTransaction("Locally write mutations","readwrite",(T=>{let P=tt(),M=Z();return f.Ns.getEntries(T,h).next((N=>{P=N,P.forEach(((V,L)=>{L.isValidDocument()||(M=M.add(V))}))})).next((()=>f.localDocuments.getOverlayedDocuments(T,P))).next((N=>{m=N;const V=[];for(const L of c){const b=ng(L,m.get(L.key).overlayedDocument);b!=null&&V.push(new Rt(L.key,b,Zc(b.value.mapValue),ke.exists(!0)))}return f.mutationQueue.addMutationBatch(T,d,V,c)})).next((N=>{g=N;const V=N.applyToLocalDocumentSet(m,M);return f.documentOverlayCache.saveOverlays(T,N.batchId,V)}))})).then((()=>({batchId:g.batchId,changes:ud(m)})))})(i.localStore,e);i.sharedClientState.addPendingMutation(o.batchId),(function(r,c,f){let d=r.Vu[r.currentUser.toKey()];d||(d=new ce(X)),d=d.insert(c,f),r.Vu[r.currentUser.toKey()]=d})(i,o.batchId,t),await li(i,o.changes),await To(i.remoteStore)}catch(o){const s=hr(o,"Failed to persist write");t.reject(s)}}async function Kd(n,e){const t=Y(n);try{const i=await ey(t.localStore,e);e.targetChanges.forEach(((o,s)=>{const r=t.Au.get(s);r&&(ne(o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size<=1,22616),o.addedDocuments.size>0?r.hu=!0:o.modifiedDocuments.size>0?ne(r.hu,14607):o.removedDocuments.size>0&&(ne(r.hu,42227),r.hu=!1))})),await li(t,i,e)}catch(i){await fn(i)}}function Fl(n,e,t){const i=Y(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const o=[];i.Tu.forEach(((s,r)=>{const c=r.view.va(e);c.snapshot&&o.push(c.snapshot)})),(function(r,c){const f=Y(r);f.onlineState=c;let d=!1;f.queries.forEach(((h,m)=>{for(const g of m.Sa)g.va(c)&&(d=!0)})),d&&pr(f)})(i.eventManager,e),o.length&&i.Pu.H_(o),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function Oy(n,e,t){const i=Y(n);i.sharedClientState.updateQueryState(e,"rejected",t);const o=i.Au.get(e),s=o&&o.key;if(s){let r=new ce(J.comparator);r=r.insert(s,Pe.newNoDocument(s,W.min()));const c=Z().add(s),f=new go(W.min(),new Map,new ce(X),r,c);await Kd(i,f),i.du=i.du.remove(s),i.Au.delete(e),gr(i)}else await Rs(i.localStore,e,!1).then((()=>Ms(i,e,t))).catch(fn)}async function Hy(n,e){const t=Y(n),i=e.batch.batchId;try{const o=await jg(t.localStore,e);Yd(t,i,null),Wd(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await li(t,o)}catch(o){await fn(o)}}async function $y(n,e,t){const i=Y(n);try{const o=await(function(r,c){const f=Y(r);return f.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let h;return f.mutationQueue.lookupMutationBatch(d,c).next((m=>(ne(m!==null,37113),h=m.keys(),f.mutationQueue.removeMutationBatch(d,m)))).next((()=>f.mutationQueue.performConsistencyCheck(d))).next((()=>f.documentOverlayCache.removeOverlaysForBatchId(d,h,c))).next((()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h))).next((()=>f.localDocuments.getDocuments(d,h)))}))})(i.localStore,e);Yd(i,e,t),Wd(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await li(i,o)}catch(o){await fn(o)}}function Wd(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function Yd(n,e,t){const i=Y(n);let o=i.Vu[i.currentUser.toKey()];if(o){const s=o.get(e);s&&(t?s.reject(t):s.resolve(),o=o.remove(e)),i.Vu[i.currentUser.toKey()]=o}}function Ms(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Iu.get(e))n.Tu.delete(i),t&&n.Pu.yu(i,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((i=>{n.Ru.containsKey(i)||Qd(n,i)}))}function Qd(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(lr(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),gr(n))}function Ul(n,e,t){for(const i of t)i instanceof $d?(n.Ru.addReference(i.key,e),Jy(n,i)):i instanceof Jd?(O(mr,"Document no longer in limbo: "+i.key),n.Ru.removeReference(i.key,e),n.Ru.containsKey(i.key)||Qd(n,i.key)):K(19791,{wu:i})}function Jy(n,e){const t=e.key,i=t.path.canonicalString();n.du.get(t)||n.Eu.has(i)||(O(mr,"New document in limbo: "+t),n.Eu.add(i),gr(n))}function gr(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new J(se.fromString(e)),i=n.fu.next();n.Au.set(i,new ky(t)),n.du=n.du.insert(t,i),bd(n.remoteStore,new ft(We(js(t.path)),i,"TargetPurposeLimboResolution",ao.ce))}}async function li(n,e,t){const i=Y(n),o=[],s=[],r=[];i.Tu.isEmpty()||(i.Tu.forEach(((c,f)=>{r.push(i.pu(f,e,t).then((d=>{var h;if((d||t)&&i.isPrimaryClient){const m=d?!d.fromCache:(h=t==null?void 0:t.targetChanges.get(f.targetId))==null?void 0:h.current;i.sharedClientState.updateQueryState(f.targetId,m?"current":"not-current")}if(d){o.push(d);const m=rr.As(f.targetId,d);s.push(m)}})))})),await Promise.all(r),i.Pu.H_(o),await(async function(f,d){const h=Y(f);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>k.forEach(d,(g=>k.forEach(g.Es,(T=>h.persistence.referenceDelegate.addReference(m,g.targetId,T))).next((()=>k.forEach(g.ds,(T=>h.persistence.referenceDelegate.removeReference(m,g.targetId,T)))))))))}catch(m){if(!hn(m))throw m;O(ar,"Failed to update sequence numbers: "+m)}for(const m of d){const g=m.targetId;if(!m.fromCache){const T=h.Ms.get(g),P=T.snapshotVersion,M=T.withLastLimboFreeSnapshotVersion(P);h.Ms=h.Ms.insert(g,M)}}})(i.localStore,s))}async function zy(n,e){const t=Y(n);if(!t.currentUser.isEqual(e)){O(mr,"User change. New user:",e.toKey());const i=await Dd(t.localStore,e);t.currentUser=e,(function(s,r){s.mu.forEach((c=>{c.forEach((f=>{f.reject(new B(x.CANCELLED,r))}))})),s.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await li(t,i.Ls)}}function Ky(n,e){const t=Y(n),i=t.Au.get(e);if(i&&i.hu)return Z().add(i.key);{let o=Z();const s=t.Iu.get(e);if(!s)return o;for(const r of s){const c=t.Tu.get(r);o=o.unionWith(c.view.nu)}return o}}function Xd(n){const e=Y(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Kd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ky.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Oy.bind(null,e),e.Pu.H_=My.bind(null,e.eventManager),e.Pu.yu=Dy.bind(null,e.eventManager),e}function Wy(n){const e=Y(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Hy.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=$y.bind(null,e),e}class eo{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=yo(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Zg(this.persistence,new Yg,e.initialUser,this.serializer)}Cu(e){return new Md(sr.mi,this.serializer)}Du(e){return new sy}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}eo.provider={build:()=>new eo};class Yy extends eo{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ne(this.persistence.referenceDelegate instanceof Zi,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new kg(i,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Ve.withCacheSize(this.cacheSizeBytes):Ve.DEFAULT;return new Md((i=>Zi.mi(i,t)),this.serializer)}}class Ds{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Fl(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=zy.bind(null,this.syncEngine),await Ry(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Ny})()}createDatastore(e){const t=yo(e.databaseInfo.databaseId),i=(function(s){return new cy(s)})(e.databaseInfo);return(function(s,r,c,f){return new py(s,r,c,f)})(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return(function(i,o,s,r,c){return new gy(i,o,s,r,c)})(this.localStore,this.datastore,e.asyncQueue,(t=>Fl(this.syncEngine,t,0)),(function(){return Dl.v()?new Dl:new ry})())}createSyncEngine(e,t){return(function(o,s,r,c,f,d,h){const m=new by(o,s,r,c,f,d);return h&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await(async function(o){const s=Y(o);O(qt,"RemoteStore shutting down."),s.Ea.add(5),await ai(s),s.Aa.shutdown(),s.Ra.set("Unknown")})(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Ds.provider={build:()=>new Ds};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):et("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ct="FirestoreClient";class Qy{constructor(e,t,i,o,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=o,this.user=Re.UNAUTHENTICATED,this.clientId=Ks.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,(async r=>{O(Ct,"Received user=",r.uid),await this.authCredentialListener(r),this.user=r})),this.appCheckCredentials.start(i,(r=>(O(Ct,"Received new app check token=",r),this.appCheckCredentialListener(r,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new yt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=hr(t,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}async function ls(n,e){n.asyncQueue.verifyOperationInProgress(),O(Ct,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener((async o=>{i.isEqual(o)||(await Dd(e.localStore,o),i=o)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function ql(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Xy(n);O(Ct,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((i=>xl(e.remoteStore,i))),n.setAppCheckTokenChangeListener(((i,o)=>xl(e.remoteStore,o))),n._onlineComponents=e}async function Xy(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O(Ct,"Using user provided OfflineComponentProvider");try{await ls(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(o){return o.name==="FirebaseError"?o.code===x.FAILED_PRECONDITION||o.code===x.UNIMPLEMENTED:!(typeof DOMException<"u"&&o instanceof DOMException)||o.code===22||o.code===20||o.code===11})(t))throw t;on("Error using user provided cache. Falling back to memory cache: "+t),await ls(n,new eo)}}else O(Ct,"Using default OfflineComponentProvider"),await ls(n,new Yy(void 0));return n._offlineComponents}async function jd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(O(Ct,"Using user provided OnlineComponentProvider"),await ql(n,n._uninitializedComponentsProvider._online)):(O(Ct,"Using default OnlineComponentProvider"),await ql(n,new Ds))),n._onlineComponents}function Zy(n){return jd(n).then((e=>e.syncEngine))}async function Vs(n){const e=await jd(n),t=e.eventManager;return t.onListen=Ly.bind(null,e.syncEngine),t.onUnlisten=qy.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Fy.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=By.bind(null,e.syncEngine),t}function jy(n,e,t={}){const i=new yt;return n.asyncQueue.enqueueAndForget((async()=>(function(s,r,c,f,d){const h=new Zd({next:g=>{h.Nu(),r.enqueueAndForget((()=>Od(s,m))),g.fromCache&&f.source==="server"?d.reject(new B(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(g)},error:g=>d.reject(g)}),m=new Hd(c,h,{includeMetadataChanges:!0,qa:!0});return Gd(s,m)})(await Vs(n),n.asyncQueue,e,t,i))),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ef(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bl=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tf="firestore.googleapis.com",Gl=!0;class Ol{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new B(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=tf,this.ssl=Gl}else this.host=e.host,this.ssl=e.ssl??Gl;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Nd;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Vg)throw new B(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}mm("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ef(e.experimentalLongPollingOptions??{}),(function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new B(x.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new B(x.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new B(x.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(i,o){return i.timeoutSeconds===o.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Eo{constructor(e,t,i,o){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=o,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ol({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new B(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new B(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ol(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new sm;switch(i.type){case"firstParty":return new um(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new B(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const i=Bl.get(t);i&&(O("ComponentProvider","Removing Datastore"),Bl.delete(t),i.terminate())})(this),Promise.resolve()}}function e_(n,e,t,i={}){var d;n=Ue(n,Eo);const o=$s(e),s=n._getSettings(),r={...s,emulatorOptions:n._getEmulatorOptions()},c=`${e}:${t}`;o&&(Vh(`https://${c}`),Lh("Firestore",!0)),s.host!==tf&&s.host!==c&&on("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const f={...s,host:c,ssl:o,emulatorOptions:i};if(!Oi(f,r)&&(n._setSettings(f),i.mockUserToken)){let h,m;if(typeof i.mockUserToken=="string")h=i.mockUserToken,m=Re.MOCK_USER;else{h=xh(i.mockUserToken,(d=n._app)==null?void 0:d.options.projectId);const g=i.mockUserToken.sub||i.mockUserToken.user_id;if(!g)throw new B(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new Re(g)}n._authCredentials=new rm(new Bc(h,m))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new it(this.firestore,e,this._query)}}class he{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _t(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new he(this.firestore,e,this._key)}toJSON(){return{type:he._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,i){if(oi(t,he._jsonSchema))return new he(e,i||null,new J(se.fromString(t.referencePath)))}}he._jsonSchemaVersion="firestore/documentReference/1.0",he._jsonSchema={type:ge("string",he._jsonSchemaVersion),referencePath:ge("string")};class _t extends it{constructor(e,t,i){super(e,t,js(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new he(this.firestore,null,new J(e))}withConverter(e){return new _t(this.firestore,e,this._path)}}function zt(n,e,...t){if(n=Be(n),Gc("collection","path",e),n instanceof Eo){const i=se.fromString(e,...t);return tl(i),new _t(n,null,i)}{if(!(n instanceof he||n instanceof _t))throw new B(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(se.fromString(e,...t));return tl(i),new _t(n.firestore,null,i)}}function Ie(n,e,...t){if(n=Be(n),arguments.length===1&&(e=Ks.newId()),Gc("doc","path",e),n instanceof Eo){const i=se.fromString(e,...t);return el(i),new he(n,null,new J(i))}{if(!(n instanceof he||n instanceof _t))throw new B(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(se.fromString(e,...t));return el(i),new he(n.firestore,n instanceof _t?n.converter:null,new J(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hl="AsyncQueue";class $l{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new xd(this,"async_queue_retry"),this._c=()=>{const i=as();i&&O(Hl,"Visibility state changed to "+i.visibilityState),this.M_.w_()},this.ac=e;const t=as();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=as();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new yt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!hn(e))throw e;O(Hl,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((i=>{throw this.nc=i,this.rc=!1,et("INTERNAL UNHANDLED ERROR: ",Jl(i)),i})).then((i=>(this.rc=!1,i))))));return this.ac=t,t}enqueueAfterDelay(e,t,i){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const o=fr.createAndSchedule(this,e,t,i,(s=>this.hc(s)));return this.tc.push(o),o}uc(){this.nc&&K(47125,{Pc:Jl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,i)=>t.targetTimeMs-i.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Jl(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zl(n){return(function(t,i){if(typeof t!="object"||t===null)return!1;const o=t;for(const s of i)if(s in o&&typeof o[s]=="function")return!0;return!1})(n,["next","error","complete"])}class St extends Eo{constructor(e,t,i,o){super(e,t,i,o),this.type="firestore",this._queue=new $l,this._persistenceKey=(o==null?void 0:o.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new $l(e),this._firestoreClient=void 0,await e}}}function t_(n,e){const t=typeof n=="object"?n:zp(),i=typeof n=="string"?n:zi,o=Gp(t,"firestore").getImmediate({identifier:i});if(!o._initialized){const s=Mh("firestore");s&&e_(o,...s)}return o}function Io(n){if(n._terminated)throw new B(x.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||n_(n),n._firestoreClient}function n_(n){var i,o,s;const e=n._freezeSettings(),t=(function(c,f,d,h){return new Rm(c,f,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,ef(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(n._databaseId,((i=n._app)==null?void 0:i.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(o=e.localCache)!=null&&o._offlineComponentProvider&&((s=e.localCache)!=null&&s._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Qy(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(c){const f=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(f),_online:f}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fe{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Fe(Ce.fromBase64String(e))}catch(t){throw new B(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Fe(Ce.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Fe._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(oi(e,Fe._jsonSchema))return Fe.fromBase64String(e.bytes)}}Fe._jsonSchemaVersion="firestore/bytes/1.0",Fe._jsonSchema={type:ge("string",Fe._jsonSchemaVersion),bytes:ge("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new B(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ae(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qe{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new B(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new B(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return X(this._lat,e._lat)||X(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Qe._jsonSchemaVersion}}static fromJSON(e){if(oi(e,Qe._jsonSchema))return new Qe(e.latitude,e.longitude)}}Qe._jsonSchemaVersion="firestore/geoPoint/1.0",Qe._jsonSchema={type:ge("string",Qe._jsonSchemaVersion),latitude:ge("number"),longitude:ge("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xe{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(i,o){if(i.length!==o.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==o[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Xe._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(oi(e,Xe._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Xe(e.vectorValues);throw new B(x.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Xe._jsonSchemaVersion="firestore/vectorValue/1.0",Xe._jsonSchema={type:ge("string",Xe._jsonSchemaVersion),vectorValues:ge("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i_=/^__.*__$/;class o_{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Rt(e,this.data,this.fieldMask,t,this.fieldTransforms):new si(e,this.data,t,this.fieldTransforms)}}class nf{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Rt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function of(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw K(40011,{Ac:n})}}class yr{constructor(e,t,i,o,s,r){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=o,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=r||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new yr({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var o;const t=(o=this.path)==null?void 0:o.child(e),i=this.Vc({path:t,fc:!1});return i.gc(e),i}yc(e){var o;const t=(o=this.path)==null?void 0:o.child(e),i=this.Vc({path:t,fc:!1});return i.Rc(),i}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return to(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(of(this.Ac)&&i_.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class s_{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||yo(e)}Cc(e,t,i,o=!1){return new yr({Ac:e,methodName:t,Dc:i,path:Ae.emptyPath(),fc:!1,bc:o},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ao(n){const e=n._freezeSettings(),t=yo(n._databaseId);return new s_(n._databaseId,!!e.ignoreUndefinedProperties,t)}function sf(n,e,t,i,o,s={}){const r=n.Cc(s.merge||s.mergeFields?2:0,e,t,o);Tr("Data must be an object, but it was:",r,i);const c=lf(i,r);let f,d;if(s.merge)f=new Le(r.fieldMask),d=r.fieldTransforms;else if(s.mergeFields){const h=[];for(const m of s.mergeFields){const g=xs(e,m,t);if(!r.contains(g))throw new B(x.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);cf(h,g)||h.push(g)}f=new Le(h),d=r.fieldTransforms.filter((m=>f.covers(m.field)))}else f=null,d=r.fieldTransforms;return new o_(new xe(c),f,d)}class Co extends vo{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Co}}class _r extends vo{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new ii(e.serializer,fd(e.serializer,this.Fc));return new Zm(e.path,t)}isEqual(e){return e instanceof _r&&this.Fc===e.Fc}}function rf(n,e,t,i){const o=n.Cc(1,e,t);Tr("Data must be an object, but it was:",o,i);const s=[],r=xe.empty();wt(i,((f,d)=>{const h=Er(e,f,t);d=Be(d);const m=o.yc(h);if(d instanceof Co)s.push(h);else{const g=ci(d,m);g!=null&&(s.push(h),r.set(h,g))}}));const c=new Le(s);return new nf(r,c,o.fieldTransforms)}function af(n,e,t,i,o,s){const r=n.Cc(1,e,t),c=[xs(e,i,t)],f=[o];if(s.length%2!=0)throw new B(x.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)c.push(xs(e,s[g])),f.push(s[g+1]);const d=[],h=xe.empty();for(let g=c.length-1;g>=0;--g)if(!cf(d,c[g])){const T=c[g];let P=f[g];P=Be(P);const M=r.yc(T);if(P instanceof Co)d.push(T);else{const N=ci(P,M);N!=null&&(d.push(T),h.set(T,N))}}const m=new Le(d);return new nf(h,m,r.fieldTransforms)}function r_(n,e,t,i=!1){return ci(t,n.Cc(i?4:3,e))}function ci(n,e){if(uf(n=Be(n)))return Tr("Unsupported field value:",e,n),lf(n,e);if(n instanceof vo)return(function(i,o){if(!of(o.Ac))throw o.Sc(`${i._methodName}() can only be used with update() and set()`);if(!o.path)throw o.Sc(`${i._methodName}() is not currently supported inside arrays`);const s=i._toFieldTransform(o);s&&o.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(i,o){const s=[];let r=0;for(const c of i){let f=ci(c,o.wc(r));f==null&&(f={nullValue:"NULL_VALUE"}),s.push(f),r++}return{arrayValue:{values:s}}})(n,e)}return(function(i,o){if((i=Be(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return fd(o.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const s=ue.fromDate(i);return{timestampValue:Xi(o.serializer,s)}}if(i instanceof ue){const s=new ue(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:Xi(o.serializer,s)}}if(i instanceof Qe)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof Fe)return{bytesValue:vd(o.serializer,i._byteString)};if(i instanceof he){const s=o.databaseId,r=i.firestore._databaseId;if(!r.isEqual(s))throw o.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ir(i.firestore._databaseId||o.databaseId,i._key.path)}}if(i instanceof Xe)return(function(r,c){return{mapValue:{fields:{[Qc]:{stringValue:Xc},[Ki]:{arrayValue:{values:r.toArray().map((d=>{if(typeof d!="number")throw c.Sc("VectorValues must only contain numeric values.");return er(c.serializer,d)}))}}}}}})(i,o);throw o.Sc(`Unsupported field value: ${ro(i)}`)})(n,e)}function lf(n,e){const t={};return $c(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):wt(n,((i,o)=>{const s=ci(o,e.mc(i));s!=null&&(t[i]=s)})),{mapValue:{fields:t}}}function uf(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ue||n instanceof Qe||n instanceof Fe||n instanceof he||n instanceof vo||n instanceof Xe)}function Tr(n,e,t){if(!uf(t)||!Oc(t)){const i=ro(t);throw i==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+i)}}function xs(n,e,t){if((e=Be(e))instanceof ui)return e._internalPath;if(typeof e=="string")return Er(n,e);throw to("Field path arguments must be of type string or ",n,!1,void 0,t)}const a_=new RegExp("[~\\*/\\[\\]]");function Er(n,e,t){if(e.search(a_)>=0)throw to(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ui(...e.split("."))._internalPath}catch{throw to(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function to(n,e,t,i,o){const s=i&&!i.isEmpty(),r=o!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let f="";return(s||r)&&(f+=" (found",s&&(f+=` in field ${i}`),r&&(f+=` in document ${o}`),f+=")"),new B(x.INVALID_ARGUMENT,c+n+f)}function cf(n,e){return n.some((t=>t.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class df{constructor(e,t,i,o,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=o,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new he(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new l_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ir("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class l_ extends df{data(){return super.data()}}function Ir(n,e){return typeof e=="string"?Er(n,e):e instanceof ui?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ff(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new B(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class vr{}class Ar extends vr{}function Kl(n,e,...t){let i=[];e instanceof vr&&i.push(e),i=i.concat(t),(function(s){const r=s.filter((f=>f instanceof Sr)).length,c=s.filter((f=>f instanceof Cr)).length;if(r>1||r>0&&c>0)throw new B(x.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(i);for(const o of i)n=o._apply(n);return n}class Cr extends Ar{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new Cr(e,t,i)}_apply(e){const t=this._parse(e);return hf(e._query,t),new it(e.firestore,e.converter,vs(e._query,t))}_parse(e){const t=Ao(e.firestore);return(function(s,r,c,f,d,h,m){let g;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new B(x.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){Ql(m,h);const P=[];for(const M of m)P.push(Yl(f,s,M));g={arrayValue:{values:P}}}else g=Yl(f,s,m)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||Ql(m,h),g=r_(c,r,m,h==="in"||h==="not-in");return me.create(d,h,g)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class Sr extends vr{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Sr(e,t)}_parse(e){const t=this._queryConstraints.map((i=>i._parse(e))).filter((i=>i.getFilters().length>0));return t.length===1?t[0]:Oe.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(o,s){let r=o;const c=s.getFlattenedFilters();for(const f of c)hf(r,f),r=vs(r,f)})(e._query,t),new it(e.firestore,e.converter,vs(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class wr extends Ar{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new wr(e,t)}_apply(e){const t=(function(o,s,r){if(o.startAt!==null)throw new B(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(o.endAt!==null)throw new B(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ei(s,r)})(e._query,this._field,this._direction);return new it(e.firestore,e.converter,(function(o,s){const r=o.explicitOrderBy.concat([s]);return new pn(o.path,o.collectionGroup,r,o.filters.slice(),o.limit,o.limitType,o.startAt,o.endAt)})(e._query,t))}}function u_(n,e="asc"){const t=e,i=Ir("orderBy",n);return wr._create(i,t)}class Rr extends Ar{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new Rr(e,t,i)}_apply(e){return new it(e.firestore,e.converter,Yi(e._query,this._limit,this._limitType))}}function Wl(n){return gm("limit",n),Rr._create("limit",n,"F")}function Yl(n,e,t){if(typeof(t=Be(t))=="string"){if(t==="")throw new B(x.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sd(e)&&t.indexOf("/")!==-1)throw new B(x.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(se.fromString(t));if(!J.isDocumentKey(i))throw new B(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return ul(n,new J(i))}if(t instanceof he)return ul(n,t._key);throw new B(x.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ro(t)}.`)}function Ql(n,e){if(!Array.isArray(n)||n.length===0)throw new B(x.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function hf(n,e){const t=(function(o,s){for(const r of o)for(const c of r.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null})(n.filters,(function(o){switch(o){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new B(x.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new B(x.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class c_{convertValue(e,t="none"){switch(vt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return fe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(It(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw K(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return wt(e,((o,s)=>{i[o]=this.convertValue(s,t)})),i}convertVectorValue(e){var i,o,s;const t=(s=(o=(i=e.fields)==null?void 0:i[Ki].arrayValue)==null?void 0:o.values)==null?void 0:s.map((r=>fe(r.doubleValue)));return new Xe(t)}convertGeoPoint(e){return new Qe(fe(e.latitude),fe(e.longitude))}convertArray(e,t){return(e.values||[]).map((i=>this.convertValue(i,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const i=uo(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(Xn(e));default:return null}}convertTimestamp(e){const t=Et(e);return new ue(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=se.fromString(e);ne(Pd(i),9688,{name:e});const o=new Zn(i.get(1),i.get(3)),s=new J(i.popFirst(5));return o.isEqual(t)||et(`Document ${s} contains a document reference within a different database (${o.projectId}/${o.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pf(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class Gn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Lt extends df{constructor(e,t,i,o,s,r){super(e,t,i,o,r),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ui(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(Ir("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new B(x.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Lt._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Lt._jsonSchemaVersion="firestore/documentSnapshot/1.0",Lt._jsonSchema={type:ge("string",Lt._jsonSchemaVersion),bundleSource:ge("string","DocumentSnapshot"),bundleName:ge("string"),bundle:ge("string")};class Ui extends Lt{data(e={}){return super.data(e)}}class Ft{constructor(e,t,i,o){this._firestore=e,this._userDataWriter=t,this._snapshot=o,this.metadata=new Gn(o.hasPendingWrites,o.fromCache),this.query=i}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((i=>{e.call(t,new Ui(this._firestore,this._userDataWriter,i.key,i,new Gn(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new B(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(o,s){if(o._snapshot.oldDocs.isEmpty()){let r=0;return o._snapshot.docChanges.map((c=>{const f=new Ui(o._firestore,o._userDataWriter,c.doc.key,c.doc,new Gn(o._snapshot.mutatedKeys.has(c.doc.key),o._snapshot.fromCache),o.query.converter);return c.doc,{type:"added",doc:f,oldIndex:-1,newIndex:r++}}))}{let r=o._snapshot.oldDocs;return o._snapshot.docChanges.filter((c=>s||c.type!==3)).map((c=>{const f=new Ui(o._firestore,o._userDataWriter,c.doc.key,c.doc,new Gn(o._snapshot.mutatedKeys.has(c.doc.key),o._snapshot.fromCache),o.query.converter);let d=-1,h=-1;return c.type!==0&&(d=r.indexOf(c.doc.key),r=r.delete(c.doc.key)),c.type!==1&&(r=r.add(c.doc),h=r.indexOf(c.doc.key)),{type:d_(c.type),doc:f,oldIndex:d,newIndex:h}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new B(x.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Ft._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ks.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],i=[],o=[];return this.docs.forEach((s=>{s._document!==null&&(t.push(s._document),i.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),o.push(s.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function d_(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return K(61501,{type:n})}}Ft._jsonSchemaVersion="firestore/querySnapshot/1.0",Ft._jsonSchema={type:ge("string",Ft._jsonSchemaVersion),bundleSource:ge("string","QuerySnapshot"),bundleName:ge("string"),bundle:ge("string")};class Pr extends c_{constructor(e){super(),this.firestore=e}convertBytes(e){return new Fe(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new he(this.firestore,null,t)}}function f_(n){n=Ue(n,it);const e=Ue(n.firestore,St),t=Io(e),i=new Pr(e);return ff(n._query),jy(t,n._query).then((o=>new Ft(e,i,n,o)))}function us(n,e,t){n=Ue(n,he);const i=Ue(n.firestore,St),o=pf(n.converter,e,t);return So(i,[sf(Ao(i),"setDoc",n._key,o,n.converter!==null,t).toMutation(n._key,ke.none())])}function Di(n,e,t,...i){n=Ue(n,he);const o=Ue(n.firestore,St),s=Ao(o);let r;return r=typeof(e=Be(e))=="string"||e instanceof ui?af(s,"updateDoc",n._key,e,t,i):rf(s,"updateDoc",n._key,e),So(o,[r.toMutation(n._key,ke.exists(!0))])}function h_(n){return So(Ue(n.firestore,St),[new mo(n._key,ke.none())])}function Vi(n,...e){var f,d,h;n=Be(n);let t={includeMetadataChanges:!1,source:"default"},i=0;typeof e[i]!="object"||zl(e[i])||(t=e[i++]);const o={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(zl(e[i])){const m=e[i];e[i]=(f=m.next)==null?void 0:f.bind(m),e[i+1]=(d=m.error)==null?void 0:d.bind(m),e[i+2]=(h=m.complete)==null?void 0:h.bind(m)}let s,r,c;if(n instanceof he)r=Ue(n.firestore,St),c=js(n._key.path),s={next:m=>{e[i]&&e[i](p_(r,n,m))},error:e[i+1],complete:e[i+2]};else{const m=Ue(n,it);r=Ue(m.firestore,St),c=m._query;const g=new Pr(r);s={next:T=>{e[i]&&e[i](new Ft(r,g,m,T))},error:e[i+1],complete:e[i+2]},ff(n._query)}return(function(g,T,P,M){const N=new Zd(M),V=new Hd(T,N,P);return g.asyncQueue.enqueueAndForget((async()=>Gd(await Vs(g),V))),()=>{N.Nu(),g.asyncQueue.enqueueAndForget((async()=>Od(await Vs(g),V)))}})(Io(r),c,o,s)}function So(n,e){return(function(i,o){const s=new yt;return i.asyncQueue.enqueueAndForget((async()=>Gy(await Zy(i),o,s))),s.promise})(Io(n),e)}function p_(n,e,t){const i=t.docs.get(e._key),o=new Pr(n);return new Lt(n,o,e._key,i,new Gn(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m_{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ao(e)}set(e,t,i){this._verifyNotCommitted();const o=cs(e,this._firestore),s=pf(o.converter,t,i),r=sf(this._dataReader,"WriteBatch.set",o._key,s,o.converter!==null,i);return this._mutations.push(r.toMutation(o._key,ke.none())),this}update(e,t,i,...o){this._verifyNotCommitted();const s=cs(e,this._firestore);let r;return r=typeof(t=Be(t))=="string"||t instanceof ui?af(this._dataReader,"WriteBatch.update",s._key,t,i,o):rf(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(r.toMutation(s._key,ke.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=cs(e,this._firestore);return this._mutations=this._mutations.concat(new mo(t._key,ke.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new B(x.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function cs(n,e){if((n=Be(n)).firestore!==e)throw new B(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function Xl(n){return new _r("increment",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ln(n){return Io(n=Ue(n,St)),new m_(n,(e=>So(n,e)))}(function(e,t=!0){(function(o){dn=o})(Jp),$i(new Wn("firestore",((i,{instanceIdentifier:o,options:s})=>{const r=i.getProvider("app").getImmediate(),c=new St(new am(i.getProvider("auth-internal")),new cm(r,i.getProvider("app-check-internal")),(function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new B(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zn(d.options.projectId,h)})(r,o),r);return s={useFetchStreams:t,...s},c._setSettings(s),c}),"PUBLIC").setMultipleInstances(!0)),Zt(Qa,Xa,e),Zt(Qa,Xa,"esm2020")})();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let g_,y_;function __(){return{geminiUrl:g_,vertexUrl:y_}}function T_(n,e,t,i){var o,s;if(!(n!=null&&n.baseUrl)){const r=__();return e?(o=r.vertexUrl)!==null&&o!==void 0?o:t:(s=r.geminiUrl)!==null&&s!==void 0?s:i}return n.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ot{}function G(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(i,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){const s=e[o];return s!=null?String(s):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function l(n,e,t){for(let s=0;s<e.length-1;s++){const r=e[s];if(r.endsWith("[]")){const c=r.slice(0,-2);if(!(c in n))if(Array.isArray(t))n[c]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${r}`);if(Array.isArray(n[c])){const f=n[c];if(Array.isArray(t))for(let d=0;d<f.length;d++){const h=f[d];l(h,e.slice(s+1),t[d])}else for(const d of f)l(d,e.slice(s+1),t)}return}else if(r.endsWith("[0]")){const c=r.slice(0,-3);c in n||(n[c]=[{}]);const f=n[c];l(f[0],e.slice(s+1),t);return}(!n[r]||typeof n[r]!="object")&&(n[r]={}),n=n[r]}const i=e[e.length-1],o=n[i];if(o!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===o)return;if(typeof o=="object"&&typeof t=="object"&&o!==null&&t!==null)Object.assign(o,t);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else i==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[i]=t}function a(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let i=0;i<e.length;i++){if(typeof n!="object"||n===null)return t;const o=e[i];if(o.endsWith("[]")){const s=o.slice(0,-2);if(s in n){const r=n[s];return Array.isArray(r)?r.map(c=>a(c,e.slice(i+1),t)):t}else return t}else n=n[o]}return n}catch(i){if(i instanceof TypeError)return t;throw i}}function E_(n,e){for(const[t,i]of Object.entries(e)){const o=t.split("."),s=i.split("."),r=new Set;let c=-1;for(let f=0;f<o.length;f++)if(o[f]==="*"){c=f;break}if(c!==-1&&s.length>c)for(let f=c;f<s.length;f++){const d=s[f];d!=="*"&&!d.endsWith("[]")&&!d.endsWith("[0]")&&r.add(d)}ks(n,o,s,0,r)}}function ks(n,e,t,i,o){if(i>=e.length||typeof n!="object"||n===null)return;const s=e[i];if(s.endsWith("[]")){const r=s.slice(0,-2),c=n;if(r in c&&Array.isArray(c[r]))for(const f of c[r])ks(f,e,t,i+1,o)}else if(s==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){const r=n,c=Object.keys(r).filter(d=>!d.startsWith("_")&&!o.has(d)),f={};for(const d of c)f[d]=r[d];for(const[d,h]of Object.entries(f)){const m=[];for(const g of t.slice(i))g==="*"?m.push(d):m.push(g);l(r,m,h)}for(const d of c)delete r[d]}}else{const r=n;s in r&&ks(r[s],e,t,i+1,o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Nr(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function I_(n){const e={},t=a(n,["operationName"]);t!=null&&l(e,["operationName"],t);const i=a(n,["resourceName"]);return i!=null&&l(e,["_url","resourceName"],i),e}function v_(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata"]);i!=null&&l(e,["metadata"],i);const o=a(n,["done"]);o!=null&&l(e,["done"],o);const s=a(n,["error"]);s!=null&&l(e,["error"],s);const r=a(n,["response","generateVideoResponse"]);return r!=null&&l(e,["response"],C_(r)),e}function A_(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata"]);i!=null&&l(e,["metadata"],i);const o=a(n,["done"]);o!=null&&l(e,["done"],o);const s=a(n,["error"]);s!=null&&l(e,["error"],s);const r=a(n,["response"]);return r!=null&&l(e,["response"],S_(r)),e}function C_(n){const e={},t=a(n,["generatedSamples"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>w_(r))),l(e,["generatedVideos"],s)}const i=a(n,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);const o=a(n,["raiMediaFilteredReasons"]);return o!=null&&l(e,["raiMediaFilteredReasons"],o),e}function S_(n){const e={},t=a(n,["videos"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>R_(r))),l(e,["generatedVideos"],s)}const i=a(n,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);const o=a(n,["raiMediaFilteredReasons"]);return o!=null&&l(e,["raiMediaFilteredReasons"],o),e}function w_(n){const e={},t=a(n,["video"]);return t!=null&&l(e,["video"],x_(t)),e}function R_(n){const e={},t=a(n,["_self"]);return t!=null&&l(e,["video"],k_(t)),e}function P_(n){const e={},t=a(n,["operationName"]);return t!=null&&l(e,["_url","operationName"],t),e}function N_(n){const e={},t=a(n,["operationName"]);return t!=null&&l(e,["_url","operationName"],t),e}function M_(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata"]);i!=null&&l(e,["metadata"],i);const o=a(n,["done"]);o!=null&&l(e,["done"],o);const s=a(n,["error"]);s!=null&&l(e,["error"],s);const r=a(n,["response"]);return r!=null&&l(e,["response"],D_(r)),e}function D_(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["parent"]);i!=null&&l(e,["parent"],i);const o=a(n,["documentName"]);return o!=null&&l(e,["documentName"],o),e}function mf(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata"]);i!=null&&l(e,["metadata"],i);const o=a(n,["done"]);o!=null&&l(e,["done"],o);const s=a(n,["error"]);s!=null&&l(e,["error"],s);const r=a(n,["response"]);return r!=null&&l(e,["response"],V_(r)),e}function V_(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["parent"]);i!=null&&l(e,["parent"],i);const o=a(n,["documentName"]);return o!=null&&l(e,["documentName"],o),e}function x_(n){const e={},t=a(n,["uri"]);t!=null&&l(e,["uri"],t);const i=a(n,["encodedVideo"]);i!=null&&l(e,["videoBytes"],Nr(i));const o=a(n,["encoding"]);return o!=null&&l(e,["mimeType"],o),e}function k_(n){const e={},t=a(n,["gcsUri"]);t!=null&&l(e,["uri"],t);const i=a(n,["bytesBase64Encoded"]);i!=null&&l(e,["videoBytes"],Nr(i));const o=a(n,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Zl;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Zl||(Zl={}));var jl;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(jl||(jl={}));var eu;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(eu||(eu={}));var ht;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(ht||(ht={}));var tu;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(tu||(tu={}));var nu;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(nu||(nu={}));var iu;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(iu||(iu={}));var ou;(function(n){n.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",n.HTTP_IN_QUERY="HTTP_IN_QUERY",n.HTTP_IN_HEADER="HTTP_IN_HEADER",n.HTTP_IN_PATH="HTTP_IN_PATH",n.HTTP_IN_BODY="HTTP_IN_BODY",n.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(ou||(ou={}));var su;(function(n){n.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",n.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",n.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",n.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(su||(su={}));var ru;(function(n){n.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",n.LOW="LOW",n.HIGH="HIGH"})(ru||(ru={}));var au;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(au||(au={}));var lu;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(lu||(lu={}));var uu;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(uu||(uu={}));var cu;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",n.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",n.NO_IMAGE="NO_IMAGE"})(cu||(cu={}));var du;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(du||(du={}));var fu;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(fu||(fu={}));var hu;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(hu||(hu={}));var pu;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY",n.MODEL_ARMOR="MODEL_ARMOR",n.JAILBREAK="JAILBREAK"})(pu||(pu={}));var mu;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(mu||(mu={}));var no;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(no||(no={}));var gu;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(gu||(gu={}));var yu;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(yu||(yu={}));var _u;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(_u||(_u={}));var bs;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(bs||(bs={}));var Tu;(function(n){n.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",n.TUNING_TASK_I2V="TUNING_TASK_I2V",n.TUNING_TASK_T2V="TUNING_TASK_T2V",n.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Tu||(Tu={}));var Eu;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Eu||(Eu={}));var Iu;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(Iu||(Iu={}));var vu;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(vu||(vu={}));var Au;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(Au||(Au={}));var Cu;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Cu||(Cu={}));var Su;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE",n.VALIDATED="VALIDATED"})(Su||(Su={}));var wu;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(wu||(wu={}));var Ru;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(Ru||(Ru={}));var Pu;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(Pu||(Pu={}));var Nu;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Nu||(Nu={}));var Mu;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Mu||(Mu={}));var Du;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Du||(Du={}));var Vu;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Vu||(Vu={}));var xu;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(xu||(xu={}));var ku;(function(n){n.ASSET="ASSET",n.STYLE="STYLE"})(ku||(ku={}));var bu;(function(n){n.INSERT="INSERT",n.REMOVE="REMOVE",n.REMOVE_STATIC="REMOVE_STATIC",n.OUTPAINT="OUTPAINT"})(bu||(bu={}));var Lu;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(Lu||(Lu={}));var Fu;(function(n){n.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",n.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Fu||(Fu={}));var Uu;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.STATE_PENDING="STATE_PENDING",n.STATE_ACTIVE="STATE_ACTIVE",n.STATE_FAILED="STATE_FAILED"})(Uu||(Uu={}));var qu;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(qu||(qu={}));var Bu;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(Bu||(Bu={}));var Gu;(function(n){n.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.RESPONSE_REJECTED="RESPONSE_REJECTED",n.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Gu||(Gu={}));var Ou;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(Ou||(Ou={}));var Hu;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Hu||(Hu={}));var $u;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})($u||($u={}));var Ju;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(Ju||(Ju={}));var zu;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(zu||(zu={}));var Ku;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Ku||(Ku={}));var Wu;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(Wu||(Wu={}));var Xt;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(Xt||(Xt={}));class Ls{constructor(e){const t={};for(const i of e.headers.entries())t[i[0]]=i[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class Fn{get text(){var e,t,i,o,s,r,c,f;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",h=!1;const m=[];for(const g of(f=(c=(r=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||r===void 0?void 0:r.content)===null||c===void 0?void 0:c.parts)!==null&&f!==void 0?f:[]){for(const[T,P]of Object.entries(g))T!=="text"&&T!=="thought"&&T!=="thoughtSignature"&&(P!==null||P!==void 0)&&m.push(T);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;h=!0,d+=g.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?d:void 0}get data(){var e,t,i,o,s,r,c,f;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const h=[];for(const m of(f=(c=(r=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||r===void 0?void 0:r.content)===null||c===void 0?void 0:c.parts)!==null&&f!==void 0?f:[]){for(const[g,T]of Object.entries(m))g!=="inlineData"&&(T!==null||T!==void 0)&&h.push(g);m.inlineData&&typeof m.inlineData.data=="string"&&(d+=atob(m.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,t,i,o,s,r,c,f;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(f=(c=(r=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||r===void 0?void 0:r.content)===null||c===void 0?void 0:c.parts)===null||f===void 0?void 0:f.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var e,t,i,o,s,r,c,f,d;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(f=(c=(r=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||r===void 0?void 0:r.content)===null||c===void 0?void 0:c.parts)===null||f===void 0?void 0:f.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,t,i,o,s,r,c,f,d;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(f=(c=(r=(s=this.candidates)===null||s===void 0?void 0:s[0])===null||r===void 0?void 0:r.content)===null||c===void 0?void 0:c.parts)===null||f===void 0?void 0:f.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.output}}class Yu{}class Qu{}class b_{}class L_{}class F_{}class U_{}class Xu{}class Zu{}class ju{}class q_{}class io{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const i=new io;let o;const s=e;return t?o=A_(s):o=v_(s),Object.assign(i,o),i}}class ec{}class tc{}class nc{}class ic{}class B_{}class G_{}class O_{}class Mr{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const i=new Mr,s=M_(e);return Object.assign(i,s),i}}class H_{}class $_{}class J_{}class oc{}class z_{get text(){var e,t,i;let o="",s=!1;const r=[];for(const c of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[f,d]of Object.entries(c))f!=="text"&&f!=="thought"&&d!==null&&r.push(f);if(typeof c.text=="string"){if(typeof c.thought=="boolean"&&c.thought)continue;s=!0,o+=c.text}}return r.length>0&&console.warn(`there are non-text parts ${r} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),s?o:void 0}get data(){var e,t,i;let o="";const s=[];for(const r of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[c,f]of Object.entries(r))c!=="inlineData"&&f!==null&&s.push(c);r.inlineData&&typeof r.inlineData.data=="string"&&(o+=atob(r.inlineData.data))}return s.length>0&&console.warn(`there are non-data parts ${s} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}}class K_{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Dr{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const i=new Dr,s=mf(e);return Object.assign(i,s),i}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function te(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function gf(n,e){const t=te(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function yf(n){return Array.isArray(n)?n.map(e=>oo(e)):[oo(n)]}function oo(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function _f(n){const e=oo(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Tf(n){const e=oo(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function sc(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function Ef(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>sc(e)):[sc(n)]}function Fs(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function rc(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function ac(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function Ne(n){if(n==null)throw new Error("ContentUnion is required");return Fs(n)?n:{role:"user",parts:Ef(n)}}function Vr(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const i=Ne(t);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(n.isVertexAI()){const t=Ne(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>Ne(t)):[Ne(e)]}function qe(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(rc(n)||ac(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Ne(n)]}const e=[],t=[],i=Fs(n[0]);for(const o of n){const s=Fs(o);if(s!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(s)e.push(o);else{if(rc(o)||ac(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(o)}}return i||e.push({role:"user",parts:Ef(t)}),e}function W_(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(i=>i!=="null");if(t.length===1)e.type=Object.values(ht).includes(t[0].toUpperCase())?t[0].toUpperCase():ht.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const i of t)e.anyOf.push({type:Object.values(ht).includes(i.toUpperCase())?i.toUpperCase():ht.TYPE_UNSPECIFIED})}}function en(n){const e={},t=["items"],i=["anyOf"],o=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const s=n.anyOf;s!=null&&s.length==2&&(s[0].type==="null"?(e.nullable=!0,n=s[1]):s[1].type==="null"&&(e.nullable=!0,n=s[0])),n.type instanceof Array&&W_(n.type,e);for(const[r,c]of Object.entries(n))if(c!=null)if(r=="type"){if(c==="null")throw new Error("type: null can not be the only possible type for the field.");if(c instanceof Array)continue;e.type=Object.values(ht).includes(c.toUpperCase())?c.toUpperCase():ht.TYPE_UNSPECIFIED}else if(t.includes(r))e[r]=en(c);else if(i.includes(r)){const f=[];for(const d of c){if(d.type=="null"){e.nullable=!0;continue}f.push(en(d))}e[r]=f}else if(o.includes(r)){const f={};for(const[d,h]of Object.entries(c))f[d]=en(h);e[r]=f}else{if(r==="additionalProperties")continue;e[r]=c}return e}function xr(n){return en(n)}function kr(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function br(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function gn(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=en(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=en(e.response));return n}function yn(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function Y_(n,e,t,i=1){const o=!e.startsWith(`${t}/`)&&e.split("/").length===i;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:o?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:o?`${t}/${e}`:e}function st(n,e){if(typeof e!="string")throw new Error("name must be a string");return Y_(n,e,"cachedContents")}function If(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function Pt(n){return Nr(n)}function Q_(n){return n!=null&&typeof n=="object"&&"name"in n}function X_(n){return n!=null&&typeof n=="object"&&"video"in n}function Z_(n){return n!=null&&typeof n=="object"&&"uri"in n}function vf(n){var e;let t;if(Q_(n)&&(t=n.name),!(Z_(n)&&(t=n.uri,t===void 0))&&!(X_(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const o=t.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${t}`);t=o[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function Af(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function Cf(n){for(const e of["models","tunedModels","publisherModels"])if(j_(n,e))return n[e];return[]}function j_(n,e){return n!==null&&typeof n=="object"&&e in n}function eT(n,e={}){const t=n,i={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(i.responseJsonSchema=t.outputSchema),e.behavior&&(i.behavior=e.behavior),{functionDeclarations:[i]}}function tT(n,e={}){const t=[],i=new Set;for(const o of n){const s=o.name;if(i.has(s))throw new Error(`Duplicate function name ${s} found in MCP tools. Please ensure function names are unique.`);i.add(s);const r=eT(o,e);r.functionDeclarations&&t.push(...r.functionDeclarations)}return{functionDeclarations:t}}function Sf(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const i=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,o=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(o>0||i!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(i>0||o!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function nT(n){if(typeof n!="string")return n;const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function wf(n){if(typeof n!="object"||n===null)return{};const e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;const o=t.inlinedResponses;if(!Array.isArray(o)||o.length===0)return n;let s=!1;for(const r of o){if(typeof r!="object"||r===null)continue;const f=r.response;if(typeof f!="object"||f===null)continue;if(f.embedding!==void 0){s=!0;break}}return s&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function _n(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function Rf(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function iT(n){const e={},t=a(n,["responsesFile"]);t!=null&&l(e,["fileName"],t);const i=a(n,["inlinedResponses","inlinedResponses"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>FT(r))),l(e,["inlinedResponses"],s)}const o=a(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>r)),l(e,["inlinedEmbedContentResponses"],s)}return e}function oT(n){const e={},t=a(n,["predictionsFormat"]);t!=null&&l(e,["format"],t);const i=a(n,["gcsDestination","outputUriPrefix"]);i!=null&&l(e,["gcsUri"],i);const o=a(n,["bigqueryDestination","outputUri"]);return o!=null&&l(e,["bigqueryUri"],o),e}function sT(n){const e={},t=a(n,["format"]);t!=null&&l(e,["predictionsFormat"],t);const i=a(n,["gcsUri"]);i!=null&&l(e,["gcsDestination","outputUriPrefix"],i);const o=a(n,["bigqueryUri"]);if(o!=null&&l(e,["bigqueryDestination","outputUri"],o),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(a(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function qi(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata","displayName"]);i!=null&&l(e,["displayName"],i);const o=a(n,["metadata","state"]);o!=null&&l(e,["state"],Rf(o));const s=a(n,["metadata","createTime"]);s!=null&&l(e,["createTime"],s);const r=a(n,["metadata","endTime"]);r!=null&&l(e,["endTime"],r);const c=a(n,["metadata","updateTime"]);c!=null&&l(e,["updateTime"],c);const f=a(n,["metadata","model"]);f!=null&&l(e,["model"],f);const d=a(n,["metadata","output"]);return d!=null&&l(e,["dest"],iT(wf(d))),e}function Us(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["displayName"]);i!=null&&l(e,["displayName"],i);const o=a(n,["state"]);o!=null&&l(e,["state"],Rf(o));const s=a(n,["error"]);s!=null&&l(e,["error"],s);const r=a(n,["createTime"]);r!=null&&l(e,["createTime"],r);const c=a(n,["startTime"]);c!=null&&l(e,["startTime"],c);const f=a(n,["endTime"]);f!=null&&l(e,["endTime"],f);const d=a(n,["updateTime"]);d!=null&&l(e,["updateTime"],d);const h=a(n,["model"]);h!=null&&l(e,["model"],h);const m=a(n,["inputConfig"]);m!=null&&l(e,["src"],rT(m));const g=a(n,["outputConfig"]);g!=null&&l(e,["dest"],oT(wf(g)));const T=a(n,["completionStats"]);return T!=null&&l(e,["completionStats"],T),e}function rT(n){const e={},t=a(n,["instancesFormat"]);t!=null&&l(e,["format"],t);const i=a(n,["gcsSource","uris"]);i!=null&&l(e,["gcsUri"],i);const o=a(n,["bigquerySource","inputUri"]);return o!=null&&l(e,["bigqueryUri"],o),e}function aT(n,e){const t={};if(a(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(a(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const i=a(e,["fileName"]);i!=null&&l(t,["fileName"],i);const o=a(e,["inlinedRequests"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>LT(n,r))),l(t,["requests","requests"],s)}return t}function lT(n){const e={},t=a(n,["format"]);t!=null&&l(e,["instancesFormat"],t);const i=a(n,["gcsUri"]);i!=null&&l(e,["gcsSource","uris"],i);const o=a(n,["bigqueryUri"]);if(o!=null&&l(e,["bigquerySource","inputUri"],o),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function uT(n){const e={},t=a(n,["data"]);if(t!=null&&l(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function cT(n,e){const t={},i=a(e,["name"]);return i!=null&&l(t,["_url","name"],_n(n,i)),t}function dT(n,e){const t={},i=a(e,["name"]);return i!=null&&l(t,["_url","name"],_n(n,i)),t}function fT(n){const e={},t=a(n,["content"]);t!=null&&l(e,["content"],t);const i=a(n,["citationMetadata"]);i!=null&&l(e,["citationMetadata"],hT(i));const o=a(n,["tokenCount"]);o!=null&&l(e,["tokenCount"],o);const s=a(n,["finishReason"]);s!=null&&l(e,["finishReason"],s);const r=a(n,["avgLogprobs"]);r!=null&&l(e,["avgLogprobs"],r);const c=a(n,["groundingMetadata"]);c!=null&&l(e,["groundingMetadata"],c);const f=a(n,["index"]);f!=null&&l(e,["index"],f);const d=a(n,["logprobsResult"]);d!=null&&l(e,["logprobsResult"],d);const h=a(n,["safetyRatings"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(T=>T)),l(e,["safetyRatings"],g)}const m=a(n,["urlContextMetadata"]);return m!=null&&l(e,["urlContextMetadata"],m),e}function hT(n){const e={},t=a(n,["citationSources"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>o)),l(e,["citations"],i)}return e}function Pf(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>$T(s))),l(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function pT(n,e){const t={},i=a(n,["displayName"]);if(e!==void 0&&i!=null&&l(e,["batch","displayName"],i),a(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function mT(n,e){const t={},i=a(n,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);const o=a(n,["dest"]);return e!==void 0&&o!=null&&l(e,["outputConfig"],sT(nT(o))),t}function lc(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["src"]);o!=null&&l(t,["batch","inputConfig"],aT(n,Sf(n,o)));const s=a(e,["config"]);return s!=null&&pT(s,t),t}function gT(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["model"],te(n,i));const o=a(e,["src"]);o!=null&&l(t,["inputConfig"],lT(Sf(n,o)));const s=a(e,["config"]);return s!=null&&mT(s,t),t}function yT(n,e){const t={},i=a(n,["displayName"]);return e!==void 0&&i!=null&&l(e,["batch","displayName"],i),t}function _T(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["src"]);o!=null&&l(t,["batch","inputConfig"],ST(n,o));const s=a(e,["config"]);return s!=null&&yT(s,t),t}function TT(n,e){const t={},i=a(e,["name"]);return i!=null&&l(t,["_url","name"],_n(n,i)),t}function ET(n,e){const t={},i=a(e,["name"]);return i!=null&&l(t,["_url","name"],_n(n,i)),t}function IT(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["name"]);i!=null&&l(e,["name"],i);const o=a(n,["done"]);o!=null&&l(e,["done"],o);const s=a(n,["error"]);return s!=null&&l(e,["error"],s),e}function vT(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["name"]);i!=null&&l(e,["name"],i);const o=a(n,["done"]);o!=null&&l(e,["done"],o);const s=a(n,["error"]);return s!=null&&l(e,["error"],s),e}function AT(n,e){const t={},i=a(e,["contents"]);if(i!=null){let s=Vr(n,i);Array.isArray(s)&&(s=s.map(r=>r)),l(t,["requests[]","request","content"],s)}const o=a(e,["config"]);return o!=null&&(l(t,["_self"],CT(o,t)),E_(t,{"requests[].*":"requests[].request.*"})),t}function CT(n,e){const t={},i=a(n,["taskType"]);e!==void 0&&i!=null&&l(e,["requests[]","taskType"],i);const o=a(n,["title"]);e!==void 0&&o!=null&&l(e,["requests[]","title"],o);const s=a(n,["outputDimensionality"]);if(e!==void 0&&s!=null&&l(e,["requests[]","outputDimensionality"],s),a(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function ST(n,e){const t={},i=a(e,["fileName"]);i!=null&&l(t,["file_name"],i);const o=a(e,["inlinedRequests"]);return o!=null&&l(t,["requests"],AT(n,o)),t}function wT(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function RT(n){const e={},t=a(n,["id"]);t!=null&&l(e,["id"],t);const i=a(n,["args"]);i!=null&&l(e,["args"],i);const o=a(n,["name"]);if(o!=null&&l(e,["name"],o),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function PT(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["allowedFunctionNames"]);if(i!=null&&l(e,["allowedFunctionNames"],i),a(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function NT(n,e,t){const i={},o=a(e,["systemInstruction"]);t!==void 0&&o!=null&&l(t,["systemInstruction"],Pf(Ne(o)));const s=a(e,["temperature"]);s!=null&&l(i,["temperature"],s);const r=a(e,["topP"]);r!=null&&l(i,["topP"],r);const c=a(e,["topK"]);c!=null&&l(i,["topK"],c);const f=a(e,["candidateCount"]);f!=null&&l(i,["candidateCount"],f);const d=a(e,["maxOutputTokens"]);d!=null&&l(i,["maxOutputTokens"],d);const h=a(e,["stopSequences"]);h!=null&&l(i,["stopSequences"],h);const m=a(e,["responseLogprobs"]);m!=null&&l(i,["responseLogprobs"],m);const g=a(e,["logprobs"]);g!=null&&l(i,["logprobs"],g);const T=a(e,["presencePenalty"]);T!=null&&l(i,["presencePenalty"],T);const P=a(e,["frequencyPenalty"]);P!=null&&l(i,["frequencyPenalty"],P);const M=a(e,["seed"]);M!=null&&l(i,["seed"],M);const N=a(e,["responseMimeType"]);N!=null&&l(i,["responseMimeType"],N);const V=a(e,["responseSchema"]);V!=null&&l(i,["responseSchema"],xr(V));const L=a(e,["responseJsonSchema"]);if(L!=null&&l(i,["responseJsonSchema"],L),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const b=a(e,["safetySettings"]);if(t!==void 0&&b!=null){let v=b;Array.isArray(v)&&(v=v.map(re=>JT(re))),l(t,["safetySettings"],v)}const H=a(e,["tools"]);if(t!==void 0&&H!=null){let v=yn(H);Array.isArray(v)&&(v=v.map(re=>KT(gn(re)))),l(t,["tools"],v)}const z=a(e,["toolConfig"]);if(t!==void 0&&z!=null&&l(t,["toolConfig"],zT(z)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const $=a(e,["cachedContent"]);t!==void 0&&$!=null&&l(t,["cachedContent"],st(n,$));const A=a(e,["responseModalities"]);A!=null&&l(i,["responseModalities"],A);const I=a(e,["mediaResolution"]);I!=null&&l(i,["mediaResolution"],I);const E=a(e,["speechConfig"]);if(E!=null&&l(i,["speechConfig"],kr(E)),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const C=a(e,["thinkingConfig"]);C!=null&&l(i,["thinkingConfig"],C);const S=a(e,["imageConfig"]);S!=null&&l(i,["imageConfig"],bT(S));const w=a(e,["enableEnhancedCivicAnswers"]);return w!=null&&l(i,["enableEnhancedCivicAnswers"],w),i}function MT(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["candidates"]);if(i!=null){let f=i;Array.isArray(f)&&(f=f.map(d=>fT(d))),l(e,["candidates"],f)}const o=a(n,["modelVersion"]);o!=null&&l(e,["modelVersion"],o);const s=a(n,["promptFeedback"]);s!=null&&l(e,["promptFeedback"],s);const r=a(n,["responseId"]);r!=null&&l(e,["responseId"],r);const c=a(n,["usageMetadata"]);return c!=null&&l(e,["usageMetadata"],c),e}function DT(n,e){const t={},i=a(e,["name"]);return i!=null&&l(t,["_url","name"],_n(n,i)),t}function VT(n,e){const t={},i=a(e,["name"]);return i!=null&&l(t,["_url","name"],_n(n,i)),t}function xT(n){const e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=a(n,["enableWidget"]);return t!=null&&l(e,["enableWidget"],t),e}function kT(n){const e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],t),e}function bT(n){const e={},t=a(n,["aspectRatio"]);t!=null&&l(e,["aspectRatio"],t);const i=a(n,["imageSize"]);if(i!=null&&l(e,["imageSize"],i),a(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(a(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function LT(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["request","model"],te(n,i));const o=a(e,["contents"]);if(o!=null){let c=qe(o);Array.isArray(c)&&(c=c.map(f=>Pf(f))),l(t,["request","contents"],c)}const s=a(e,["metadata"]);s!=null&&l(t,["metadata"],s);const r=a(e,["config"]);return r!=null&&l(t,["request","generationConfig"],NT(n,r,a(t,["request"],{}))),t}function FT(n){const e={},t=a(n,["response"]);t!=null&&l(e,["response"],MT(t));const i=a(n,["error"]);return i!=null&&l(e,["error"],i),e}function UT(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);if(e!==void 0&&o!=null&&l(e,["_query","pageToken"],o),a(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function qT(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);e!==void 0&&o!=null&&l(e,["_query","pageToken"],o);const s=a(n,["filter"]);return e!==void 0&&s!=null&&l(e,["_query","filter"],s),t}function BT(n){const e={},t=a(n,["config"]);return t!=null&&UT(t,e),e}function GT(n){const e={},t=a(n,["config"]);return t!=null&&qT(t,e),e}function OT(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&l(e,["nextPageToken"],i);const o=a(n,["operations"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>qi(r))),l(e,["batchJobs"],s)}return e}function HT(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&l(e,["nextPageToken"],i);const o=a(n,["batchPredictionJobs"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>Us(r))),l(e,["batchJobs"],s)}return e}function $T(n){const e={},t=a(n,["mediaResolution"]);t!=null&&l(e,["mediaResolution"],t);const i=a(n,["codeExecutionResult"]);i!=null&&l(e,["codeExecutionResult"],i);const o=a(n,["executableCode"]);o!=null&&l(e,["executableCode"],o);const s=a(n,["fileData"]);s!=null&&l(e,["fileData"],wT(s));const r=a(n,["functionCall"]);r!=null&&l(e,["functionCall"],RT(r));const c=a(n,["functionResponse"]);c!=null&&l(e,["functionResponse"],c);const f=a(n,["inlineData"]);f!=null&&l(e,["inlineData"],uT(f));const d=a(n,["text"]);d!=null&&l(e,["text"],d);const h=a(n,["thought"]);h!=null&&l(e,["thought"],h);const m=a(n,["thoughtSignature"]);m!=null&&l(e,["thoughtSignature"],m);const g=a(n,["videoMetadata"]);return g!=null&&l(e,["videoMetadata"],g),e}function JT(n){const e={},t=a(n,["category"]);if(t!=null&&l(e,["category"],t),a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const i=a(n,["threshold"]);return i!=null&&l(e,["threshold"],i),e}function zT(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&l(e,["functionCallingConfig"],PT(t));const i=a(n,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],i),e}function KT(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);const o=a(n,["computerUse"]);o!=null&&l(e,["computerUse"],o);const s=a(n,["fileSearch"]);s!=null&&l(e,["fileSearch"],s);const r=a(n,["codeExecution"]);if(r!=null&&l(e,["codeExecution"],r),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const c=a(n,["googleMaps"]);c!=null&&l(e,["googleMaps"],xT(c));const f=a(n,["googleSearch"]);f!=null&&l(e,["googleSearch"],kT(f));const d=a(n,["urlContext"]);return d!=null&&l(e,["urlContext"],d),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var nt;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents"})(nt||(nt={}));class Ot{constructor(e,t,i,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,i,o)}init(e,t,i){var o,s;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let r={config:{}};!i||Object.keys(i).length===0?r={config:{}}:typeof i=="object"?r=Object.assign({},i):r=i,r.config&&(r.config.pageToken=t.nextPageToken),this.paramsInternal=r,this.pageInternalSize=(s=(o=r.config)===null||o===void 0?void 0:o.pageSize)!==null&&s!==void 0?s:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class WT extends ot{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ot(nt.PAGED_ITEM_BATCH_JOBS,i=>this.listInternal(i),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){const t=lc(this.apiClient,e),i=t._url,o=G("{model}:batchGenerateContent",i),c=t.batch.inputConfig.requests,f=c.requests,d=[];for(const h of f){const m=Object.assign({},h);if(m.systemInstruction){const g=m.systemInstruction;delete m.systemInstruction;const T=m.request;T.systemInstruction=g,m.request=T}d.push(m)}return c.requests=d,delete t.config,delete t._url,delete t._query,{path:o,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const i=t?Object.assign({},t):{},o=Date.now().toString();if(i.displayName||(i.displayName=`genaiBatchJob_${o}`),i.dest===void 0){const s=this.getGcsUri(e),r=this.getBigqueryUri(e);if(s)s.endsWith(".jsonl")?i.dest=`${s.slice(0,-6)}/dest`:i.dest=`${s}_dest_${o}`;else if(r)i.dest=`${r}_dest_${o}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return i}async createInternal(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=gT(this.apiClient,e);return c=G("batchPredictionJobs",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),r.then(h=>Us(h))}else{const d=lc(this.apiClient,e);return c=G("{model}:batchGenerateContent",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),r.then(h=>qi(h))}}async createEmbeddingsInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=_T(this.apiClient,e);return s=G("{model}:asyncBatchEmbedContent",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>qi(f))}}async get(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=VT(this.apiClient,e);return c=G("batchPredictionJobs/{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),r.then(h=>Us(h))}else{const d=DT(this.apiClient,e);return c=G("batches/{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),r.then(h=>qi(h))}}async cancel(e){var t,i,o,s;let r="",c={};if(this.apiClient.isVertexAI()){const f=dT(this.apiClient,e);r=G("batchPredictionJobs/{name}:cancel",f._url),c=f._query,delete f._url,delete f._query,await this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{const f=cT(this.apiClient,e);r=G("batches/{name}:cancel",f._url),c=f._query,delete f._url,delete f._query,await this.apiClient.request({path:r,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=GT(e);return c=G("batchPredictionJobs",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=HT(h),g=new oc;return Object.assign(g,m),g})}else{const d=BT(e);return c=G("batches",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=OT(h),g=new oc;return Object.assign(g,m),g})}}async delete(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=ET(this.apiClient,e);return c=G("batchPredictionJobs/{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>vT(h))}else{const d=TT(this.apiClient,e);return c=G("batches/{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>IT(h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function YT(n){const e={},t=a(n,["data"]);if(t!=null&&l(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function uc(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>_E(s))),l(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function QT(n,e){const t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);const o=a(n,["expireTime"]);e!==void 0&&o!=null&&l(e,["expireTime"],o);const s=a(n,["displayName"]);e!==void 0&&s!=null&&l(e,["displayName"],s);const r=a(n,["contents"]);if(e!==void 0&&r!=null){let h=qe(r);Array.isArray(h)&&(h=h.map(m=>uc(m))),l(e,["contents"],h)}const c=a(n,["systemInstruction"]);e!==void 0&&c!=null&&l(e,["systemInstruction"],uc(Ne(c)));const f=a(n,["tools"]);if(e!==void 0&&f!=null){let h=f;Array.isArray(h)&&(h=h.map(m=>EE(m))),l(e,["tools"],h)}const d=a(n,["toolConfig"]);if(e!==void 0&&d!=null&&l(e,["toolConfig"],TE(d)),a(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function XT(n,e){const t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);const o=a(n,["expireTime"]);e!==void 0&&o!=null&&l(e,["expireTime"],o);const s=a(n,["displayName"]);e!==void 0&&s!=null&&l(e,["displayName"],s);const r=a(n,["contents"]);if(e!==void 0&&r!=null){let m=qe(r);Array.isArray(m)&&(m=m.map(g=>g)),l(e,["contents"],m)}const c=a(n,["systemInstruction"]);e!==void 0&&c!=null&&l(e,["systemInstruction"],Ne(c));const f=a(n,["tools"]);if(e!==void 0&&f!=null){let m=f;Array.isArray(m)&&(m=m.map(g=>IE(g))),l(e,["tools"],m)}const d=a(n,["toolConfig"]);e!==void 0&&d!=null&&l(e,["toolConfig"],d);const h=a(n,["kmsKeyName"]);return e!==void 0&&h!=null&&l(e,["encryption_spec","kmsKeyName"],h),t}function ZT(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["model"],gf(n,i));const o=a(e,["config"]);return o!=null&&QT(o,t),t}function jT(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["model"],gf(n,i));const o=a(e,["config"]);return o!=null&&XT(o,t),t}function eE(n,e){const t={},i=a(e,["name"]);return i!=null&&l(t,["_url","name"],st(n,i)),t}function tE(n,e){const t={},i=a(e,["name"]);return i!=null&&l(t,["_url","name"],st(n,i)),t}function nE(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}function iE(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}function oE(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function sE(n){const e={},t=a(n,["id"]);t!=null&&l(e,["id"],t);const i=a(n,["args"]);i!=null&&l(e,["args"],i);const o=a(n,["name"]);if(o!=null&&l(e,["name"],o),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function rE(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["allowedFunctionNames"]);if(i!=null&&l(e,["allowedFunctionNames"],i),a(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function aE(n){const e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=a(n,["description"]);t!=null&&l(e,["description"],t);const i=a(n,["name"]);i!=null&&l(e,["name"],i);const o=a(n,["parameters"]);o!=null&&l(e,["parameters"],o);const s=a(n,["parametersJsonSchema"]);s!=null&&l(e,["parametersJsonSchema"],s);const r=a(n,["response"]);r!=null&&l(e,["response"],r);const c=a(n,["responseJsonSchema"]);return c!=null&&l(e,["responseJsonSchema"],c),e}function lE(n,e){const t={},i=a(e,["name"]);return i!=null&&l(t,["_url","name"],st(n,i)),t}function uE(n,e){const t={},i=a(e,["name"]);return i!=null&&l(t,["_url","name"],st(n,i)),t}function cE(n){const e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=a(n,["enableWidget"]);return t!=null&&l(e,["enableWidget"],t),e}function dE(n){const e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],t),e}function fE(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);return e!==void 0&&o!=null&&l(e,["_query","pageToken"],o),t}function hE(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);return e!==void 0&&o!=null&&l(e,["_query","pageToken"],o),t}function pE(n){const e={},t=a(n,["config"]);return t!=null&&fE(t,e),e}function mE(n){const e={},t=a(n,["config"]);return t!=null&&hE(t,e),e}function gE(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&l(e,["nextPageToken"],i);const o=a(n,["cachedContents"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>r)),l(e,["cachedContents"],s)}return e}function yE(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&l(e,["nextPageToken"],i);const o=a(n,["cachedContents"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>r)),l(e,["cachedContents"],s)}return e}function _E(n){const e={},t=a(n,["mediaResolution"]);t!=null&&l(e,["mediaResolution"],t);const i=a(n,["codeExecutionResult"]);i!=null&&l(e,["codeExecutionResult"],i);const o=a(n,["executableCode"]);o!=null&&l(e,["executableCode"],o);const s=a(n,["fileData"]);s!=null&&l(e,["fileData"],oE(s));const r=a(n,["functionCall"]);r!=null&&l(e,["functionCall"],sE(r));const c=a(n,["functionResponse"]);c!=null&&l(e,["functionResponse"],c);const f=a(n,["inlineData"]);f!=null&&l(e,["inlineData"],YT(f));const d=a(n,["text"]);d!=null&&l(e,["text"],d);const h=a(n,["thought"]);h!=null&&l(e,["thought"],h);const m=a(n,["thoughtSignature"]);m!=null&&l(e,["thoughtSignature"],m);const g=a(n,["videoMetadata"]);return g!=null&&l(e,["videoMetadata"],g),e}function TE(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&l(e,["functionCallingConfig"],rE(t));const i=a(n,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],i),e}function EE(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);const o=a(n,["computerUse"]);o!=null&&l(e,["computerUse"],o);const s=a(n,["fileSearch"]);s!=null&&l(e,["fileSearch"],s);const r=a(n,["codeExecution"]);if(r!=null&&l(e,["codeExecution"],r),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const c=a(n,["googleMaps"]);c!=null&&l(e,["googleMaps"],cE(c));const f=a(n,["googleSearch"]);f!=null&&l(e,["googleSearch"],dE(f));const d=a(n,["urlContext"]);return d!=null&&l(e,["urlContext"],d),e}function IE(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(g=>aE(g))),l(e,["functionDeclarations"],m)}const i=a(n,["retrieval"]);i!=null&&l(e,["retrieval"],i);const o=a(n,["googleSearchRetrieval"]);o!=null&&l(e,["googleSearchRetrieval"],o);const s=a(n,["computerUse"]);if(s!=null&&l(e,["computerUse"],s),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const r=a(n,["codeExecution"]);r!=null&&l(e,["codeExecution"],r);const c=a(n,["enterpriseWebSearch"]);c!=null&&l(e,["enterpriseWebSearch"],c);const f=a(n,["googleMaps"]);f!=null&&l(e,["googleMaps"],f);const d=a(n,["googleSearch"]);d!=null&&l(e,["googleSearch"],d);const h=a(n,["urlContext"]);return h!=null&&l(e,["urlContext"],h),e}function vE(n,e){const t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);const o=a(n,["expireTime"]);return e!==void 0&&o!=null&&l(e,["expireTime"],o),t}function AE(n,e){const t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);const o=a(n,["expireTime"]);return e!==void 0&&o!=null&&l(e,["expireTime"],o),t}function CE(n,e){const t={},i=a(e,["name"]);i!=null&&l(t,["_url","name"],st(n,i));const o=a(e,["config"]);return o!=null&&vE(o,t),t}function SE(n,e){const t={},i=a(e,["name"]);i!=null&&l(t,["_url","name"],st(n,i));const o=a(e,["config"]);return o!=null&&AE(o,t),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class wE extends ot{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ot(nt.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(t),t)}async create(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=jT(this.apiClient,e);return c=G("cachedContents",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),r.then(h=>h)}else{const d=ZT(this.apiClient,e);return c=G("cachedContents",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),r.then(h=>h)}}async get(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=uE(this.apiClient,e);return c=G("{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),r.then(h=>h)}else{const d=lE(this.apiClient,e);return c=G("{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),r.then(h=>h)}}async delete(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=tE(this.apiClient,e);return c=G("{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=iE(h),g=new nc;return Object.assign(g,m),g})}else{const d=eE(this.apiClient,e);return c=G("{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=nE(h),g=new nc;return Object.assign(g,m),g})}}async update(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=SE(this.apiClient,e);return c=G("{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),r.then(h=>h)}else{const d=CE(this.apiClient,e);return c=G("{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),r.then(h=>h)}}async listInternal(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=mE(e);return c=G("cachedContents",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=yE(h),g=new ic;return Object.assign(g,m),g})}else{const d=pE(e);return c=G("cachedContents",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=gE(h),g=new ic;return Object.assign(g,m),g})}}}function cc(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function le(n){return this instanceof le?(this.v=n,this):new le(n)}function tn(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),o,s=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",r),o[Symbol.asyncIterator]=function(){return this},o;function r(T){return function(P){return Promise.resolve(P).then(T,m)}}function c(T,P){i[T]&&(o[T]=function(M){return new Promise(function(N,V){s.push([T,M,N,V])>1||f(T,M)})},P&&(o[T]=P(o[T])))}function f(T,P){try{d(i[T](P))}catch(M){g(s[0][3],M)}}function d(T){T.value instanceof le?Promise.resolve(T.value.v).then(h,m):g(s[0][2],T)}function h(T){f("next",T)}function m(T){f("throw",T)}function g(T,P){T(P),s.shift(),s.length&&f(s[0][0],s[0][1])}}function Kn(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof cc=="function"?cc(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(r){return new Promise(function(c,f){r=n[s](r),o(c,f,r.done,r.value)})}}function o(s,r,c,f){Promise.resolve(f).then(function(d){s({value:d,done:c})},r)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function RE(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:Nf(t)}function Nf(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function PE(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function dc(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let i=0;for(;i<t;)if(n[i].role==="user")e.push(n[i]),i++;else{const o=[];let s=!0;for(;i<t&&n[i].role==="model";)o.push(n[i]),s&&!Nf(n[i])&&(s=!1),i++;s?e.push(...o):e.pop()}return e}class NE{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new ME(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class ME{constructor(e,t,i,o={},s=[]){this.apiClient=e,this.modelsModule=t,this.model=i,this.config=o,this.history=s,this.sendPromise=Promise.resolve(),PE(s)}async sendMessage(e){var t;await this.sendPromise;const i=Ne(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var s,r,c;const f=await o,d=(r=(s=f.candidates)===null||s===void 0?void 0:s[0])===null||r===void 0?void 0:r.content,h=f.automaticFunctionCallingHistory,m=this.getHistory(!0).length;let g=[];h!=null&&(g=(c=h.slice(m))!==null&&c!==void 0?c:[]);const T=d?[d]:[];this.recordHistory(i,T,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var t;await this.sendPromise;const i=Ne(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});const s=await o;return this.processStreamResponse(s,i)}getHistory(e=!1){const t=e?dc(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return tn(this,arguments,function*(){var o,s,r,c,f,d;const h=[];try{for(var m=!0,g=Kn(e),T;T=yield le(g.next()),o=T.done,!o;m=!0){c=T.value,m=!1;const P=c;if(RE(P)){const M=(d=(f=P.candidates)===null||f===void 0?void 0:f[0])===null||d===void 0?void 0:d.content;M!==void 0&&h.push(M)}yield yield le(P)}}catch(P){s={error:P}}finally{try{!m&&!o&&(r=g.return)&&(yield le(r.call(g)))}finally{if(s)throw s.error}}this.recordHistory(t,h)})}recordHistory(e,t,i){let o=[];t.length>0&&t.every(s=>s.role!==void 0)?o=t:o.push({role:"model",parts:[]}),i&&i.length>0?this.history.push(...dc(i)):this.history.push(e),this.history.push(...o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class wo extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,wo.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function DE(n){const e={},t=a(n,["file"]);return t!=null&&l(e,["file"],t),e}function VE(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}function xE(n){const e={},t=a(n,["name"]);return t!=null&&l(e,["_url","file"],vf(t)),e}function kE(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}function bE(n){const e={},t=a(n,["name"]);return t!=null&&l(e,["_url","file"],vf(t)),e}function LE(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);return e!==void 0&&o!=null&&l(e,["_query","pageToken"],o),t}function FE(n){const e={},t=a(n,["config"]);return t!=null&&LE(t,e),e}function UE(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&l(e,["nextPageToken"],i);const o=a(n,["files"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>r)),l(e,["files"],s)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class qE extends ot{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ot(nt.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=FE(e);return s=G("files",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const d=UE(f),h=new H_;return Object.assign(h,d),h})}}async createInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=DE(e);return s=G("upload/v1beta/files",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{const d=VE(f),h=new $_;return Object.assign(h,d),h})}}async get(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=bE(e);return s=G("files/{file}",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async delete(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=xE(e);return s=G("files/{file}",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const d=kE(f),h=new J_;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Bi(n){const e={},t=a(n,["data"]);if(t!=null&&l(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function BE(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>nI(s))),l(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function GE(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function OE(n){const e={},t=a(n,["id"]);t!=null&&l(e,["id"],t);const i=a(n,["args"]);i!=null&&l(e,["args"],i);const o=a(n,["name"]);if(o!=null&&l(e,["name"],o),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function HE(n){const e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=a(n,["description"]);t!=null&&l(e,["description"],t);const i=a(n,["name"]);i!=null&&l(e,["name"],i);const o=a(n,["parameters"]);o!=null&&l(e,["parameters"],o);const s=a(n,["parametersJsonSchema"]);s!=null&&l(e,["parametersJsonSchema"],s);const r=a(n,["response"]);r!=null&&l(e,["response"],r);const c=a(n,["responseJsonSchema"]);return c!=null&&l(e,["responseJsonSchema"],c),e}function $E(n){const e={},t=a(n,["modelSelectionConfig"]);t!=null&&l(e,["modelConfig"],t);const i=a(n,["responseJsonSchema"]);i!=null&&l(e,["responseJsonSchema"],i);const o=a(n,["audioTimestamp"]);o!=null&&l(e,["audioTimestamp"],o);const s=a(n,["candidateCount"]);s!=null&&l(e,["candidateCount"],s);const r=a(n,["enableAffectiveDialog"]);r!=null&&l(e,["enableAffectiveDialog"],r);const c=a(n,["frequencyPenalty"]);c!=null&&l(e,["frequencyPenalty"],c);const f=a(n,["logprobs"]);f!=null&&l(e,["logprobs"],f);const d=a(n,["maxOutputTokens"]);d!=null&&l(e,["maxOutputTokens"],d);const h=a(n,["mediaResolution"]);h!=null&&l(e,["mediaResolution"],h);const m=a(n,["presencePenalty"]);m!=null&&l(e,["presencePenalty"],m);const g=a(n,["responseLogprobs"]);g!=null&&l(e,["responseLogprobs"],g);const T=a(n,["responseMimeType"]);T!=null&&l(e,["responseMimeType"],T);const P=a(n,["responseModalities"]);P!=null&&l(e,["responseModalities"],P);const M=a(n,["responseSchema"]);M!=null&&l(e,["responseSchema"],M);const N=a(n,["routingConfig"]);N!=null&&l(e,["routingConfig"],N);const V=a(n,["seed"]);V!=null&&l(e,["seed"],V);const L=a(n,["speechConfig"]);L!=null&&l(e,["speechConfig"],Mf(L));const b=a(n,["stopSequences"]);b!=null&&l(e,["stopSequences"],b);const H=a(n,["temperature"]);H!=null&&l(e,["temperature"],H);const z=a(n,["thinkingConfig"]);z!=null&&l(e,["thinkingConfig"],z);const $=a(n,["topK"]);$!=null&&l(e,["topK"],$);const A=a(n,["topP"]);if(A!=null&&l(e,["topP"],A),a(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function JE(n){const e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=a(n,["enableWidget"]);return t!=null&&l(e,["enableWidget"],t),e}function zE(n){const e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],t),e}function KE(n,e){const t={},i=a(n,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],i);const o=a(n,["responseModalities"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","responseModalities"],o);const s=a(n,["temperature"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","temperature"],s);const r=a(n,["topP"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","topP"],r);const c=a(n,["topK"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","topK"],c);const f=a(n,["maxOutputTokens"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","maxOutputTokens"],f);const d=a(n,["mediaResolution"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","mediaResolution"],d);const h=a(n,["seed"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","seed"],h);const m=a(n,["speechConfig"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","speechConfig"],br(m));const g=a(n,["thinkingConfig"]);e!==void 0&&g!=null&&l(e,["setup","generationConfig","thinkingConfig"],g);const T=a(n,["enableAffectiveDialog"]);e!==void 0&&T!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],T);const P=a(n,["systemInstruction"]);e!==void 0&&P!=null&&l(e,["setup","systemInstruction"],BE(Ne(P)));const M=a(n,["tools"]);if(e!==void 0&&M!=null){let $=yn(M);Array.isArray($)&&($=$.map(A=>oI(gn(A)))),l(e,["setup","tools"],$)}const N=a(n,["sessionResumption"]);e!==void 0&&N!=null&&l(e,["setup","sessionResumption"],iI(N));const V=a(n,["inputAudioTranscription"]);e!==void 0&&V!=null&&l(e,["setup","inputAudioTranscription"],V);const L=a(n,["outputAudioTranscription"]);e!==void 0&&L!=null&&l(e,["setup","outputAudioTranscription"],L);const b=a(n,["realtimeInputConfig"]);e!==void 0&&b!=null&&l(e,["setup","realtimeInputConfig"],b);const H=a(n,["contextWindowCompression"]);e!==void 0&&H!=null&&l(e,["setup","contextWindowCompression"],H);const z=a(n,["proactivity"]);return e!==void 0&&z!=null&&l(e,["setup","proactivity"],z),t}function WE(n,e){const t={},i=a(n,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],$E(i));const o=a(n,["responseModalities"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","responseModalities"],o);const s=a(n,["temperature"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","temperature"],s);const r=a(n,["topP"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","topP"],r);const c=a(n,["topK"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","topK"],c);const f=a(n,["maxOutputTokens"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","maxOutputTokens"],f);const d=a(n,["mediaResolution"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","mediaResolution"],d);const h=a(n,["seed"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","seed"],h);const m=a(n,["speechConfig"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","speechConfig"],Mf(br(m)));const g=a(n,["thinkingConfig"]);e!==void 0&&g!=null&&l(e,["setup","generationConfig","thinkingConfig"],g);const T=a(n,["enableAffectiveDialog"]);e!==void 0&&T!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],T);const P=a(n,["systemInstruction"]);e!==void 0&&P!=null&&l(e,["setup","systemInstruction"],Ne(P));const M=a(n,["tools"]);if(e!==void 0&&M!=null){let $=yn(M);Array.isArray($)&&($=$.map(A=>sI(gn(A)))),l(e,["setup","tools"],$)}const N=a(n,["sessionResumption"]);e!==void 0&&N!=null&&l(e,["setup","sessionResumption"],N);const V=a(n,["inputAudioTranscription"]);e!==void 0&&V!=null&&l(e,["setup","inputAudioTranscription"],V);const L=a(n,["outputAudioTranscription"]);e!==void 0&&L!=null&&l(e,["setup","outputAudioTranscription"],L);const b=a(n,["realtimeInputConfig"]);e!==void 0&&b!=null&&l(e,["setup","realtimeInputConfig"],b);const H=a(n,["contextWindowCompression"]);e!==void 0&&H!=null&&l(e,["setup","contextWindowCompression"],H);const z=a(n,["proactivity"]);return e!==void 0&&z!=null&&l(e,["setup","proactivity"],z),t}function YE(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["setup","model"],te(n,i));const o=a(e,["config"]);return o!=null&&l(t,["config"],KE(o,t)),t}function QE(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["setup","model"],te(n,i));const o=a(e,["config"]);return o!=null&&l(t,["config"],WE(o,t)),t}function XE(n){const e={},t=a(n,["musicGenerationConfig"]);return t!=null&&l(e,["musicGenerationConfig"],t),e}function ZE(n){const e={},t=a(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>o)),l(e,["weightedPrompts"],i)}return e}function jE(n){const e={},t=a(n,["media"]);if(t!=null){let d=yf(t);Array.isArray(d)&&(d=d.map(h=>Bi(h))),l(e,["mediaChunks"],d)}const i=a(n,["audio"]);i!=null&&l(e,["audio"],Bi(Tf(i)));const o=a(n,["audioStreamEnd"]);o!=null&&l(e,["audioStreamEnd"],o);const s=a(n,["video"]);s!=null&&l(e,["video"],Bi(_f(s)));const r=a(n,["text"]);r!=null&&l(e,["text"],r);const c=a(n,["activityStart"]);c!=null&&l(e,["activityStart"],c);const f=a(n,["activityEnd"]);return f!=null&&l(e,["activityEnd"],f),e}function eI(n){const e={},t=a(n,["media"]);if(t!=null){let d=yf(t);Array.isArray(d)&&(d=d.map(h=>h)),l(e,["mediaChunks"],d)}const i=a(n,["audio"]);i!=null&&l(e,["audio"],Tf(i));const o=a(n,["audioStreamEnd"]);o!=null&&l(e,["audioStreamEnd"],o);const s=a(n,["video"]);s!=null&&l(e,["video"],_f(s));const r=a(n,["text"]);r!=null&&l(e,["text"],r);const c=a(n,["activityStart"]);c!=null&&l(e,["activityStart"],c);const f=a(n,["activityEnd"]);return f!=null&&l(e,["activityEnd"],f),e}function tI(n){const e={},t=a(n,["setupComplete"]);t!=null&&l(e,["setupComplete"],t);const i=a(n,["serverContent"]);i!=null&&l(e,["serverContent"],i);const o=a(n,["toolCall"]);o!=null&&l(e,["toolCall"],o);const s=a(n,["toolCallCancellation"]);s!=null&&l(e,["toolCallCancellation"],s);const r=a(n,["usageMetadata"]);r!=null&&l(e,["usageMetadata"],rI(r));const c=a(n,["goAway"]);c!=null&&l(e,["goAway"],c);const f=a(n,["sessionResumptionUpdate"]);return f!=null&&l(e,["sessionResumptionUpdate"],f),e}function nI(n){const e={},t=a(n,["mediaResolution"]);t!=null&&l(e,["mediaResolution"],t);const i=a(n,["codeExecutionResult"]);i!=null&&l(e,["codeExecutionResult"],i);const o=a(n,["executableCode"]);o!=null&&l(e,["executableCode"],o);const s=a(n,["fileData"]);s!=null&&l(e,["fileData"],GE(s));const r=a(n,["functionCall"]);r!=null&&l(e,["functionCall"],OE(r));const c=a(n,["functionResponse"]);c!=null&&l(e,["functionResponse"],c);const f=a(n,["inlineData"]);f!=null&&l(e,["inlineData"],Bi(f));const d=a(n,["text"]);d!=null&&l(e,["text"],d);const h=a(n,["thought"]);h!=null&&l(e,["thought"],h);const m=a(n,["thoughtSignature"]);m!=null&&l(e,["thoughtSignature"],m);const g=a(n,["videoMetadata"]);return g!=null&&l(e,["videoMetadata"],g),e}function iI(n){const e={},t=a(n,["handle"]);if(t!=null&&l(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Mf(n){const e={},t=a(n,["voiceConfig"]);t!=null&&l(e,["voiceConfig"],t);const i=a(n,["languageCode"]);if(i!=null&&l(e,["languageCode"],i),a(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function oI(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);const o=a(n,["computerUse"]);o!=null&&l(e,["computerUse"],o);const s=a(n,["fileSearch"]);s!=null&&l(e,["fileSearch"],s);const r=a(n,["codeExecution"]);if(r!=null&&l(e,["codeExecution"],r),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const c=a(n,["googleMaps"]);c!=null&&l(e,["googleMaps"],JE(c));const f=a(n,["googleSearch"]);f!=null&&l(e,["googleSearch"],zE(f));const d=a(n,["urlContext"]);return d!=null&&l(e,["urlContext"],d),e}function sI(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(g=>HE(g))),l(e,["functionDeclarations"],m)}const i=a(n,["retrieval"]);i!=null&&l(e,["retrieval"],i);const o=a(n,["googleSearchRetrieval"]);o!=null&&l(e,["googleSearchRetrieval"],o);const s=a(n,["computerUse"]);if(s!=null&&l(e,["computerUse"],s),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const r=a(n,["codeExecution"]);r!=null&&l(e,["codeExecution"],r);const c=a(n,["enterpriseWebSearch"]);c!=null&&l(e,["enterpriseWebSearch"],c);const f=a(n,["googleMaps"]);f!=null&&l(e,["googleMaps"],f);const d=a(n,["googleSearch"]);d!=null&&l(e,["googleSearch"],d);const h=a(n,["urlContext"]);return h!=null&&l(e,["urlContext"],h),e}function rI(n){const e={},t=a(n,["promptTokenCount"]);t!=null&&l(e,["promptTokenCount"],t);const i=a(n,["cachedContentTokenCount"]);i!=null&&l(e,["cachedContentTokenCount"],i);const o=a(n,["candidatesTokenCount"]);o!=null&&l(e,["responseTokenCount"],o);const s=a(n,["toolUsePromptTokenCount"]);s!=null&&l(e,["toolUsePromptTokenCount"],s);const r=a(n,["thoughtsTokenCount"]);r!=null&&l(e,["thoughtsTokenCount"],r);const c=a(n,["totalTokenCount"]);c!=null&&l(e,["totalTokenCount"],c);const f=a(n,["promptTokensDetails"]);if(f!=null){let T=f;Array.isArray(T)&&(T=T.map(P=>P)),l(e,["promptTokensDetails"],T)}const d=a(n,["cacheTokensDetails"]);if(d!=null){let T=d;Array.isArray(T)&&(T=T.map(P=>P)),l(e,["cacheTokensDetails"],T)}const h=a(n,["candidatesTokensDetails"]);if(h!=null){let T=h;Array.isArray(T)&&(T=T.map(P=>P)),l(e,["responseTokensDetails"],T)}const m=a(n,["toolUsePromptTokensDetails"]);if(m!=null){let T=m;Array.isArray(T)&&(T=T.map(P=>P)),l(e,["toolUsePromptTokensDetails"],T)}const g=a(n,["trafficType"]);return g!=null&&l(e,["trafficType"],g),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function aI(n){const e={},t=a(n,["data"]);if(t!=null&&l(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function lI(n){const e={},t=a(n,["content"]);t!=null&&l(e,["content"],t);const i=a(n,["citationMetadata"]);i!=null&&l(e,["citationMetadata"],uI(i));const o=a(n,["tokenCount"]);o!=null&&l(e,["tokenCount"],o);const s=a(n,["finishReason"]);s!=null&&l(e,["finishReason"],s);const r=a(n,["avgLogprobs"]);r!=null&&l(e,["avgLogprobs"],r);const c=a(n,["groundingMetadata"]);c!=null&&l(e,["groundingMetadata"],c);const f=a(n,["index"]);f!=null&&l(e,["index"],f);const d=a(n,["logprobsResult"]);d!=null&&l(e,["logprobsResult"],d);const h=a(n,["safetyRatings"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(T=>T)),l(e,["safetyRatings"],g)}const m=a(n,["urlContextMetadata"]);return m!=null&&l(e,["urlContextMetadata"],m),e}function uI(n){const e={},t=a(n,["citationSources"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>o)),l(e,["citations"],i)}return e}function cI(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["contents"]);if(o!=null){let s=qe(o);Array.isArray(s)&&(s=s.map(r=>r)),l(t,["contents"],s)}return t}function dI(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["tokensInfo"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),l(e,["tokensInfo"],o)}return e}function fI(n){const e={},t=a(n,["values"]);t!=null&&l(e,["values"],t);const i=a(n,["statistics"]);return i!=null&&l(e,["statistics"],hI(i)),e}function hI(n){const e={},t=a(n,["truncated"]);t!=null&&l(e,["truncated"],t);const i=a(n,["token_count"]);return i!=null&&l(e,["tokenCount"],i),e}function Ro(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>vv(s))),l(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function pI(n){const e={},t=a(n,["controlType"]);t!=null&&l(e,["controlType"],t);const i=a(n,["enableControlImageComputation"]);return i!=null&&l(e,["computeControl"],i),e}function mI(n){const e={};if(a(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(a(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(a(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function gI(n,e){const t={},i=a(n,["systemInstruction"]);e!==void 0&&i!=null&&l(e,["systemInstruction"],Ne(i));const o=a(n,["tools"]);if(e!==void 0&&o!=null){let r=o;Array.isArray(r)&&(r=r.map(c=>bf(c))),l(e,["tools"],r)}const s=a(n,["generationConfig"]);return e!==void 0&&s!=null&&l(e,["generationConfig"],av(s)),t}function yI(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["contents"]);if(o!=null){let r=qe(o);Array.isArray(r)&&(r=r.map(c=>Ro(c))),l(t,["contents"],r)}const s=a(e,["config"]);return s!=null&&mI(s),t}function _I(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["contents"]);if(o!=null){let r=qe(o);Array.isArray(r)&&(r=r.map(c=>c)),l(t,["contents"],r)}const s=a(e,["config"]);return s!=null&&gI(s,t),t}function TI(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["totalTokens"]);i!=null&&l(e,["totalTokens"],i);const o=a(n,["cachedContentTokenCount"]);return o!=null&&l(e,["cachedContentTokenCount"],o),e}function EI(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["totalTokens"]);return i!=null&&l(e,["totalTokens"],i),e}function II(n,e){const t={},i=a(e,["model"]);return i!=null&&l(t,["_url","name"],te(n,i)),t}function vI(n,e){const t={},i=a(e,["model"]);return i!=null&&l(t,["_url","name"],te(n,i)),t}function AI(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}function CI(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}function SI(n,e){const t={},i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);const o=a(n,["negativePrompt"]);e!==void 0&&o!=null&&l(e,["parameters","negativePrompt"],o);const s=a(n,["numberOfImages"]);e!==void 0&&s!=null&&l(e,["parameters","sampleCount"],s);const r=a(n,["aspectRatio"]);e!==void 0&&r!=null&&l(e,["parameters","aspectRatio"],r);const c=a(n,["guidanceScale"]);e!==void 0&&c!=null&&l(e,["parameters","guidanceScale"],c);const f=a(n,["seed"]);e!==void 0&&f!=null&&l(e,["parameters","seed"],f);const d=a(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&l(e,["parameters","safetySetting"],d);const h=a(n,["personGeneration"]);e!==void 0&&h!=null&&l(e,["parameters","personGeneration"],h);const m=a(n,["includeSafetyAttributes"]);e!==void 0&&m!=null&&l(e,["parameters","includeSafetyAttributes"],m);const g=a(n,["includeRaiReason"]);e!==void 0&&g!=null&&l(e,["parameters","includeRaiReason"],g);const T=a(n,["language"]);e!==void 0&&T!=null&&l(e,["parameters","language"],T);const P=a(n,["outputMimeType"]);e!==void 0&&P!=null&&l(e,["parameters","outputOptions","mimeType"],P);const M=a(n,["outputCompressionQuality"]);e!==void 0&&M!=null&&l(e,["parameters","outputOptions","compressionQuality"],M);const N=a(n,["addWatermark"]);e!==void 0&&N!=null&&l(e,["parameters","addWatermark"],N);const V=a(n,["labels"]);e!==void 0&&V!=null&&l(e,["labels"],V);const L=a(n,["editMode"]);e!==void 0&&L!=null&&l(e,["parameters","editMode"],L);const b=a(n,["baseSteps"]);return e!==void 0&&b!=null&&l(e,["parameters","editConfig","baseSteps"],b),t}function wI(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["prompt"]);o!=null&&l(t,["instances[0]","prompt"],o);const s=a(e,["referenceImages"]);if(s!=null){let c=s;Array.isArray(c)&&(c=c.map(f=>Pv(f))),l(t,["instances[0]","referenceImages"],c)}const r=a(e,["config"]);return r!=null&&SI(r,t),t}function RI(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>Po(s))),l(e,["generatedImages"],o)}return e}function PI(n,e){const t={},i=a(n,["taskType"]);e!==void 0&&i!=null&&l(e,["requests[]","taskType"],i);const o=a(n,["title"]);e!==void 0&&o!=null&&l(e,["requests[]","title"],o);const s=a(n,["outputDimensionality"]);if(e!==void 0&&s!=null&&l(e,["requests[]","outputDimensionality"],s),a(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function NI(n,e){const t={},i=a(n,["taskType"]);e!==void 0&&i!=null&&l(e,["instances[]","task_type"],i);const o=a(n,["title"]);e!==void 0&&o!=null&&l(e,["instances[]","title"],o);const s=a(n,["outputDimensionality"]);e!==void 0&&s!=null&&l(e,["parameters","outputDimensionality"],s);const r=a(n,["mimeType"]);e!==void 0&&r!=null&&l(e,["instances[]","mimeType"],r);const c=a(n,["autoTruncate"]);return e!==void 0&&c!=null&&l(e,["parameters","autoTruncate"],c),t}function MI(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["contents"]);if(o!=null){let c=Vr(n,o);Array.isArray(c)&&(c=c.map(f=>f)),l(t,["requests[]","content"],c)}const s=a(e,["config"]);s!=null&&PI(s,t);const r=a(e,["model"]);return r!==void 0&&l(t,["requests[]","model"],te(n,r)),t}function DI(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["contents"]);if(o!=null){let r=Vr(n,o);Array.isArray(r)&&(r=r.map(c=>c)),l(t,["instances[]","content"],r)}const s=a(e,["config"]);return s!=null&&NI(s,t),t}function VI(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["embeddings"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>r)),l(e,["embeddings"],s)}const o=a(n,["metadata"]);return o!=null&&l(e,["metadata"],o),e}function xI(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["predictions[]","embeddings"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>fI(r))),l(e,["embeddings"],s)}const o=a(n,["metadata"]);return o!=null&&l(e,["metadata"],o),e}function kI(n){const e={},t=a(n,["endpoint"]);t!=null&&l(e,["name"],t);const i=a(n,["deployedModelId"]);return i!=null&&l(e,["deployedModelId"],i),e}function bI(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function LI(n){const e={},t=a(n,["id"]);t!=null&&l(e,["id"],t);const i=a(n,["args"]);i!=null&&l(e,["args"],i);const o=a(n,["name"]);if(o!=null&&l(e,["name"],o),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function FI(n){const e={},t=a(n,["mode"]);t!=null&&l(e,["mode"],t);const i=a(n,["allowedFunctionNames"]);if(i!=null&&l(e,["allowedFunctionNames"],i),a(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function UI(n){const e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=a(n,["description"]);t!=null&&l(e,["description"],t);const i=a(n,["name"]);i!=null&&l(e,["name"],i);const o=a(n,["parameters"]);o!=null&&l(e,["parameters"],o);const s=a(n,["parametersJsonSchema"]);s!=null&&l(e,["parametersJsonSchema"],s);const r=a(n,["response"]);r!=null&&l(e,["response"],r);const c=a(n,["responseJsonSchema"]);return c!=null&&l(e,["responseJsonSchema"],c),e}function qI(n,e,t){const i={},o=a(e,["systemInstruction"]);t!==void 0&&o!=null&&l(t,["systemInstruction"],Ro(Ne(o)));const s=a(e,["temperature"]);s!=null&&l(i,["temperature"],s);const r=a(e,["topP"]);r!=null&&l(i,["topP"],r);const c=a(e,["topK"]);c!=null&&l(i,["topK"],c);const f=a(e,["candidateCount"]);f!=null&&l(i,["candidateCount"],f);const d=a(e,["maxOutputTokens"]);d!=null&&l(i,["maxOutputTokens"],d);const h=a(e,["stopSequences"]);h!=null&&l(i,["stopSequences"],h);const m=a(e,["responseLogprobs"]);m!=null&&l(i,["responseLogprobs"],m);const g=a(e,["logprobs"]);g!=null&&l(i,["logprobs"],g);const T=a(e,["presencePenalty"]);T!=null&&l(i,["presencePenalty"],T);const P=a(e,["frequencyPenalty"]);P!=null&&l(i,["frequencyPenalty"],P);const M=a(e,["seed"]);M!=null&&l(i,["seed"],M);const N=a(e,["responseMimeType"]);N!=null&&l(i,["responseMimeType"],N);const V=a(e,["responseSchema"]);V!=null&&l(i,["responseSchema"],xr(V));const L=a(e,["responseJsonSchema"]);if(L!=null&&l(i,["responseJsonSchema"],L),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const b=a(e,["safetySettings"]);if(t!==void 0&&b!=null){let v=b;Array.isArray(v)&&(v=v.map(re=>Nv(re))),l(t,["safetySettings"],v)}const H=a(e,["tools"]);if(t!==void 0&&H!=null){let v=yn(H);Array.isArray(v)&&(v=v.map(re=>Lv(gn(re)))),l(t,["tools"],v)}const z=a(e,["toolConfig"]);if(t!==void 0&&z!=null&&l(t,["toolConfig"],bv(z)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const $=a(e,["cachedContent"]);t!==void 0&&$!=null&&l(t,["cachedContent"],st(n,$));const A=a(e,["responseModalities"]);A!=null&&l(i,["responseModalities"],A);const I=a(e,["mediaResolution"]);I!=null&&l(i,["mediaResolution"],I);const E=a(e,["speechConfig"]);if(E!=null&&l(i,["speechConfig"],kr(E)),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const C=a(e,["thinkingConfig"]);C!=null&&l(i,["thinkingConfig"],C);const S=a(e,["imageConfig"]);S!=null&&l(i,["imageConfig"],fv(S));const w=a(e,["enableEnhancedCivicAnswers"]);return w!=null&&l(i,["enableEnhancedCivicAnswers"],w),i}function BI(n,e,t){const i={},o=a(e,["systemInstruction"]);t!==void 0&&o!=null&&l(t,["systemInstruction"],Ne(o));const s=a(e,["temperature"]);s!=null&&l(i,["temperature"],s);const r=a(e,["topP"]);r!=null&&l(i,["topP"],r);const c=a(e,["topK"]);c!=null&&l(i,["topK"],c);const f=a(e,["candidateCount"]);f!=null&&l(i,["candidateCount"],f);const d=a(e,["maxOutputTokens"]);d!=null&&l(i,["maxOutputTokens"],d);const h=a(e,["stopSequences"]);h!=null&&l(i,["stopSequences"],h);const m=a(e,["responseLogprobs"]);m!=null&&l(i,["responseLogprobs"],m);const g=a(e,["logprobs"]);g!=null&&l(i,["logprobs"],g);const T=a(e,["presencePenalty"]);T!=null&&l(i,["presencePenalty"],T);const P=a(e,["frequencyPenalty"]);P!=null&&l(i,["frequencyPenalty"],P);const M=a(e,["seed"]);M!=null&&l(i,["seed"],M);const N=a(e,["responseMimeType"]);N!=null&&l(i,["responseMimeType"],N);const V=a(e,["responseSchema"]);V!=null&&l(i,["responseSchema"],xr(V));const L=a(e,["responseJsonSchema"]);L!=null&&l(i,["responseJsonSchema"],L);const b=a(e,["routingConfig"]);b!=null&&l(i,["routingConfig"],b);const H=a(e,["modelSelectionConfig"]);H!=null&&l(i,["modelConfig"],H);const z=a(e,["safetySettings"]);if(t!==void 0&&z!=null){let Ge=z;Array.isArray(Ge)&&(Ge=Ge.map(Tn=>Tn)),l(t,["safetySettings"],Ge)}const $=a(e,["tools"]);if(t!==void 0&&$!=null){let Ge=yn($);Array.isArray(Ge)&&(Ge=Ge.map(Tn=>bf(gn(Tn)))),l(t,["tools"],Ge)}const A=a(e,["toolConfig"]);t!==void 0&&A!=null&&l(t,["toolConfig"],A);const I=a(e,["labels"]);t!==void 0&&I!=null&&l(t,["labels"],I);const E=a(e,["cachedContent"]);t!==void 0&&E!=null&&l(t,["cachedContent"],st(n,E));const C=a(e,["responseModalities"]);C!=null&&l(i,["responseModalities"],C);const S=a(e,["mediaResolution"]);S!=null&&l(i,["mediaResolution"],S);const w=a(e,["speechConfig"]);w!=null&&l(i,["speechConfig"],kf(kr(w)));const v=a(e,["audioTimestamp"]);v!=null&&l(i,["audioTimestamp"],v);const re=a(e,["thinkingConfig"]);re!=null&&l(i,["thinkingConfig"],re);const $e=a(e,["imageConfig"]);if($e!=null&&l(i,["imageConfig"],hv($e)),a(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return i}function fc(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["contents"]);if(o!=null){let r=qe(o);Array.isArray(r)&&(r=r.map(c=>Ro(c))),l(t,["contents"],r)}const s=a(e,["config"]);return s!=null&&l(t,["generationConfig"],qI(n,s,t)),t}function hc(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["contents"]);if(o!=null){let r=qe(o);Array.isArray(r)&&(r=r.map(c=>c)),l(t,["contents"],r)}const s=a(e,["config"]);return s!=null&&l(t,["generationConfig"],BI(n,s,t)),t}function pc(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["candidates"]);if(i!=null){let f=i;Array.isArray(f)&&(f=f.map(d=>lI(d))),l(e,["candidates"],f)}const o=a(n,["modelVersion"]);o!=null&&l(e,["modelVersion"],o);const s=a(n,["promptFeedback"]);s!=null&&l(e,["promptFeedback"],s);const r=a(n,["responseId"]);r!=null&&l(e,["responseId"],r);const c=a(n,["usageMetadata"]);return c!=null&&l(e,["usageMetadata"],c),e}function mc(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["candidates"]);if(i!=null){let d=i;Array.isArray(d)&&(d=d.map(h=>h)),l(e,["candidates"],d)}const o=a(n,["createTime"]);o!=null&&l(e,["createTime"],o);const s=a(n,["modelVersion"]);s!=null&&l(e,["modelVersion"],s);const r=a(n,["promptFeedback"]);r!=null&&l(e,["promptFeedback"],r);const c=a(n,["responseId"]);c!=null&&l(e,["responseId"],c);const f=a(n,["usageMetadata"]);return f!=null&&l(e,["usageMetadata"],f),e}function GI(n,e){const t={};if(a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=a(n,["numberOfImages"]);e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i);const o=a(n,["aspectRatio"]);e!==void 0&&o!=null&&l(e,["parameters","aspectRatio"],o);const s=a(n,["guidanceScale"]);if(e!==void 0&&s!=null&&l(e,["parameters","guidanceScale"],s),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const r=a(n,["safetyFilterLevel"]);e!==void 0&&r!=null&&l(e,["parameters","safetySetting"],r);const c=a(n,["personGeneration"]);e!==void 0&&c!=null&&l(e,["parameters","personGeneration"],c);const f=a(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&l(e,["parameters","includeSafetyAttributes"],f);const d=a(n,["includeRaiReason"]);e!==void 0&&d!=null&&l(e,["parameters","includeRaiReason"],d);const h=a(n,["language"]);e!==void 0&&h!=null&&l(e,["parameters","language"],h);const m=a(n,["outputMimeType"]);e!==void 0&&m!=null&&l(e,["parameters","outputOptions","mimeType"],m);const g=a(n,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&l(e,["parameters","outputOptions","compressionQuality"],g),a(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(a(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const T=a(n,["imageSize"]);if(e!==void 0&&T!=null&&l(e,["parameters","sampleImageSize"],T),a(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function OI(n,e){const t={},i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);const o=a(n,["negativePrompt"]);e!==void 0&&o!=null&&l(e,["parameters","negativePrompt"],o);const s=a(n,["numberOfImages"]);e!==void 0&&s!=null&&l(e,["parameters","sampleCount"],s);const r=a(n,["aspectRatio"]);e!==void 0&&r!=null&&l(e,["parameters","aspectRatio"],r);const c=a(n,["guidanceScale"]);e!==void 0&&c!=null&&l(e,["parameters","guidanceScale"],c);const f=a(n,["seed"]);e!==void 0&&f!=null&&l(e,["parameters","seed"],f);const d=a(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&l(e,["parameters","safetySetting"],d);const h=a(n,["personGeneration"]);e!==void 0&&h!=null&&l(e,["parameters","personGeneration"],h);const m=a(n,["includeSafetyAttributes"]);e!==void 0&&m!=null&&l(e,["parameters","includeSafetyAttributes"],m);const g=a(n,["includeRaiReason"]);e!==void 0&&g!=null&&l(e,["parameters","includeRaiReason"],g);const T=a(n,["language"]);e!==void 0&&T!=null&&l(e,["parameters","language"],T);const P=a(n,["outputMimeType"]);e!==void 0&&P!=null&&l(e,["parameters","outputOptions","mimeType"],P);const M=a(n,["outputCompressionQuality"]);e!==void 0&&M!=null&&l(e,["parameters","outputOptions","compressionQuality"],M);const N=a(n,["addWatermark"]);e!==void 0&&N!=null&&l(e,["parameters","addWatermark"],N);const V=a(n,["labels"]);e!==void 0&&V!=null&&l(e,["labels"],V);const L=a(n,["imageSize"]);e!==void 0&&L!=null&&l(e,["parameters","sampleImageSize"],L);const b=a(n,["enhancePrompt"]);return e!==void 0&&b!=null&&l(e,["parameters","enhancePrompt"],b),t}function HI(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["prompt"]);o!=null&&l(t,["instances[0]","prompt"],o);const s=a(e,["config"]);return s!=null&&GI(s,t),t}function $I(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["prompt"]);o!=null&&l(t,["instances[0]","prompt"],o);const s=a(e,["config"]);return s!=null&&OI(s,t),t}function JI(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["predictions"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>iv(r))),l(e,["generatedImages"],s)}const o=a(n,["positivePromptSafetyAttributes"]);return o!=null&&l(e,["positivePromptSafetyAttributes"],Vf(o)),e}function zI(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["predictions"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>Po(r))),l(e,["generatedImages"],s)}const o=a(n,["positivePromptSafetyAttributes"]);return o!=null&&l(e,["positivePromptSafetyAttributes"],xf(o)),e}function KI(n,e){const t={},i=a(n,["numberOfVideos"]);if(e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i),a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const o=a(n,["durationSeconds"]);if(e!==void 0&&o!=null&&l(e,["parameters","durationSeconds"],o),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=a(n,["aspectRatio"]);e!==void 0&&s!=null&&l(e,["parameters","aspectRatio"],s);const r=a(n,["resolution"]);e!==void 0&&r!=null&&l(e,["parameters","resolution"],r);const c=a(n,["personGeneration"]);if(e!==void 0&&c!=null&&l(e,["parameters","personGeneration"],c),a(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const f=a(n,["negativePrompt"]);e!==void 0&&f!=null&&l(e,["parameters","negativePrompt"],f);const d=a(n,["enhancePrompt"]);if(e!==void 0&&d!=null&&l(e,["parameters","enhancePrompt"],d),a(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const h=a(n,["lastFrame"]);e!==void 0&&h!=null&&l(e,["instances[0]","lastFrame"],No(h));const m=a(n,["referenceImages"]);if(e!==void 0&&m!=null){let g=m;Array.isArray(g)&&(g=g.map(T=>Yv(T))),l(e,["instances[0]","referenceImages"],g)}if(a(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(a(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function WI(n,e){const t={},i=a(n,["numberOfVideos"]);e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i);const o=a(n,["outputGcsUri"]);e!==void 0&&o!=null&&l(e,["parameters","storageUri"],o);const s=a(n,["fps"]);e!==void 0&&s!=null&&l(e,["parameters","fps"],s);const r=a(n,["durationSeconds"]);e!==void 0&&r!=null&&l(e,["parameters","durationSeconds"],r);const c=a(n,["seed"]);e!==void 0&&c!=null&&l(e,["parameters","seed"],c);const f=a(n,["aspectRatio"]);e!==void 0&&f!=null&&l(e,["parameters","aspectRatio"],f);const d=a(n,["resolution"]);e!==void 0&&d!=null&&l(e,["parameters","resolution"],d);const h=a(n,["personGeneration"]);e!==void 0&&h!=null&&l(e,["parameters","personGeneration"],h);const m=a(n,["pubsubTopic"]);e!==void 0&&m!=null&&l(e,["parameters","pubsubTopic"],m);const g=a(n,["negativePrompt"]);e!==void 0&&g!=null&&l(e,["parameters","negativePrompt"],g);const T=a(n,["enhancePrompt"]);e!==void 0&&T!=null&&l(e,["parameters","enhancePrompt"],T);const P=a(n,["generateAudio"]);e!==void 0&&P!=null&&l(e,["parameters","generateAudio"],P);const M=a(n,["lastFrame"]);e!==void 0&&M!=null&&l(e,["instances[0]","lastFrame"],He(M));const N=a(n,["referenceImages"]);if(e!==void 0&&N!=null){let b=N;Array.isArray(b)&&(b=b.map(H=>Qv(H))),l(e,["instances[0]","referenceImages"],b)}const V=a(n,["mask"]);e!==void 0&&V!=null&&l(e,["instances[0]","mask"],Wv(V));const L=a(n,["compressionQuality"]);return e!==void 0&&L!=null&&l(e,["parameters","compressionQuality"],L),t}function YI(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata"]);i!=null&&l(e,["metadata"],i);const o=a(n,["done"]);o!=null&&l(e,["done"],o);const s=a(n,["error"]);s!=null&&l(e,["error"],s);const r=a(n,["response","generateVideoResponse"]);return r!=null&&l(e,["response"],jI(r)),e}function QI(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata"]);i!=null&&l(e,["metadata"],i);const o=a(n,["done"]);o!=null&&l(e,["done"],o);const s=a(n,["error"]);s!=null&&l(e,["error"],s);const r=a(n,["response"]);return r!=null&&l(e,["response"],ev(r)),e}function XI(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["prompt"]);o!=null&&l(t,["instances[0]","prompt"],o);const s=a(e,["image"]);s!=null&&l(t,["instances[0]","image"],No(s));const r=a(e,["video"]);r!=null&&l(t,["instances[0]","video"],Lf(r));const c=a(e,["source"]);c!=null&&tv(c,t);const f=a(e,["config"]);return f!=null&&KI(f,t),t}function ZI(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["prompt"]);o!=null&&l(t,["instances[0]","prompt"],o);const s=a(e,["image"]);s!=null&&l(t,["instances[0]","image"],He(s));const r=a(e,["video"]);r!=null&&l(t,["instances[0]","video"],Ff(r));const c=a(e,["source"]);c!=null&&nv(c,t);const f=a(e,["config"]);return f!=null&&WI(f,t),t}function jI(n){const e={},t=a(n,["generatedSamples"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>sv(r))),l(e,["generatedVideos"],s)}const i=a(n,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);const o=a(n,["raiMediaFilteredReasons"]);return o!=null&&l(e,["raiMediaFilteredReasons"],o),e}function ev(n){const e={},t=a(n,["videos"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>rv(r))),l(e,["generatedVideos"],s)}const i=a(n,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);const o=a(n,["raiMediaFilteredReasons"]);return o!=null&&l(e,["raiMediaFilteredReasons"],o),e}function tv(n,e){const t={},i=a(n,["prompt"]);e!==void 0&&i!=null&&l(e,["instances[0]","prompt"],i);const o=a(n,["image"]);e!==void 0&&o!=null&&l(e,["instances[0]","image"],No(o));const s=a(n,["video"]);return e!==void 0&&s!=null&&l(e,["instances[0]","video"],Lf(s)),t}function nv(n,e){const t={},i=a(n,["prompt"]);e!==void 0&&i!=null&&l(e,["instances[0]","prompt"],i);const o=a(n,["image"]);e!==void 0&&o!=null&&l(e,["instances[0]","image"],He(o));const s=a(n,["video"]);return e!==void 0&&s!=null&&l(e,["instances[0]","video"],Ff(s)),t}function iv(n){const e={},t=a(n,["_self"]);t!=null&&l(e,["image"],pv(t));const i=a(n,["raiFilteredReason"]);i!=null&&l(e,["raiFilteredReason"],i);const o=a(n,["_self"]);return o!=null&&l(e,["safetyAttributes"],Vf(o)),e}function Po(n){const e={},t=a(n,["_self"]);t!=null&&l(e,["image"],Df(t));const i=a(n,["raiFilteredReason"]);i!=null&&l(e,["raiFilteredReason"],i);const o=a(n,["_self"]);o!=null&&l(e,["safetyAttributes"],xf(o));const s=a(n,["prompt"]);return s!=null&&l(e,["enhancedPrompt"],s),e}function ov(n){const e={},t=a(n,["_self"]);t!=null&&l(e,["mask"],Df(t));const i=a(n,["labels"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),l(e,["labels"],o)}return e}function sv(n){const e={},t=a(n,["video"]);return t!=null&&l(e,["video"],zv(t)),e}function rv(n){const e={},t=a(n,["_self"]);return t!=null&&l(e,["video"],Kv(t)),e}function av(n){const e={},t=a(n,["modelSelectionConfig"]);t!=null&&l(e,["modelConfig"],t);const i=a(n,["responseJsonSchema"]);i!=null&&l(e,["responseJsonSchema"],i);const o=a(n,["audioTimestamp"]);o!=null&&l(e,["audioTimestamp"],o);const s=a(n,["candidateCount"]);s!=null&&l(e,["candidateCount"],s);const r=a(n,["enableAffectiveDialog"]);r!=null&&l(e,["enableAffectiveDialog"],r);const c=a(n,["frequencyPenalty"]);c!=null&&l(e,["frequencyPenalty"],c);const f=a(n,["logprobs"]);f!=null&&l(e,["logprobs"],f);const d=a(n,["maxOutputTokens"]);d!=null&&l(e,["maxOutputTokens"],d);const h=a(n,["mediaResolution"]);h!=null&&l(e,["mediaResolution"],h);const m=a(n,["presencePenalty"]);m!=null&&l(e,["presencePenalty"],m);const g=a(n,["responseLogprobs"]);g!=null&&l(e,["responseLogprobs"],g);const T=a(n,["responseMimeType"]);T!=null&&l(e,["responseMimeType"],T);const P=a(n,["responseModalities"]);P!=null&&l(e,["responseModalities"],P);const M=a(n,["responseSchema"]);M!=null&&l(e,["responseSchema"],M);const N=a(n,["routingConfig"]);N!=null&&l(e,["routingConfig"],N);const V=a(n,["seed"]);V!=null&&l(e,["seed"],V);const L=a(n,["speechConfig"]);L!=null&&l(e,["speechConfig"],kf(L));const b=a(n,["stopSequences"]);b!=null&&l(e,["stopSequences"],b);const H=a(n,["temperature"]);H!=null&&l(e,["temperature"],H);const z=a(n,["thinkingConfig"]);z!=null&&l(e,["thinkingConfig"],z);const $=a(n,["topK"]);$!=null&&l(e,["topK"],$);const A=a(n,["topP"]);if(A!=null&&l(e,["topP"],A),a(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function lv(n,e){const t={},i=a(e,["model"]);return i!=null&&l(t,["_url","name"],te(n,i)),t}function uv(n,e){const t={},i=a(e,["model"]);return i!=null&&l(t,["_url","name"],te(n,i)),t}function cv(n){const e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=a(n,["enableWidget"]);return t!=null&&l(e,["enableWidget"],t),e}function dv(n){const e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],t),e}function fv(n){const e={},t=a(n,["aspectRatio"]);t!=null&&l(e,["aspectRatio"],t);const i=a(n,["imageSize"]);if(i!=null&&l(e,["imageSize"],i),a(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(a(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function hv(n){const e={},t=a(n,["aspectRatio"]);t!=null&&l(e,["aspectRatio"],t);const i=a(n,["imageSize"]);i!=null&&l(e,["imageSize"],i);const o=a(n,["outputMimeType"]);o!=null&&l(e,["imageOutputOptions","mimeType"],o);const s=a(n,["outputCompressionQuality"]);return s!=null&&l(e,["imageOutputOptions","compressionQuality"],s),e}function pv(n){const e={},t=a(n,["bytesBase64Encoded"]);t!=null&&l(e,["imageBytes"],Pt(t));const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Df(n){const e={},t=a(n,["gcsUri"]);t!=null&&l(e,["gcsUri"],t);const i=a(n,["bytesBase64Encoded"]);i!=null&&l(e,["imageBytes"],Pt(i));const o=a(n,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function No(n){const e={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=a(n,["imageBytes"]);t!=null&&l(e,["bytesBase64Encoded"],Pt(t));const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function He(n){const e={},t=a(n,["gcsUri"]);t!=null&&l(e,["gcsUri"],t);const i=a(n,["imageBytes"]);i!=null&&l(e,["bytesBase64Encoded"],Pt(i));const o=a(n,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function mv(n,e,t){const i={},o=a(e,["pageSize"]);t!==void 0&&o!=null&&l(t,["_query","pageSize"],o);const s=a(e,["pageToken"]);t!==void 0&&s!=null&&l(t,["_query","pageToken"],s);const r=a(e,["filter"]);t!==void 0&&r!=null&&l(t,["_query","filter"],r);const c=a(e,["queryBase"]);return t!==void 0&&c!=null&&l(t,["_url","models_url"],Af(n,c)),i}function gv(n,e,t){const i={},o=a(e,["pageSize"]);t!==void 0&&o!=null&&l(t,["_query","pageSize"],o);const s=a(e,["pageToken"]);t!==void 0&&s!=null&&l(t,["_query","pageToken"],s);const r=a(e,["filter"]);t!==void 0&&r!=null&&l(t,["_query","filter"],r);const c=a(e,["queryBase"]);return t!==void 0&&c!=null&&l(t,["_url","models_url"],Af(n,c)),i}function yv(n,e){const t={},i=a(e,["config"]);return i!=null&&mv(n,i,t),t}function _v(n,e){const t={},i=a(e,["config"]);return i!=null&&gv(n,i,t),t}function Tv(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&l(e,["nextPageToken"],i);const o=a(n,["_self"]);if(o!=null){let s=Cf(o);Array.isArray(s)&&(s=s.map(r=>qs(r))),l(e,["models"],s)}return e}function Ev(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&l(e,["nextPageToken"],i);const o=a(n,["_self"]);if(o!=null){let s=Cf(o);Array.isArray(s)&&(s=s.map(r=>Bs(r))),l(e,["models"],s)}return e}function Iv(n){const e={},t=a(n,["maskMode"]);t!=null&&l(e,["maskMode"],t);const i=a(n,["segmentationClasses"]);i!=null&&l(e,["maskClasses"],i);const o=a(n,["maskDilation"]);return o!=null&&l(e,["dilation"],o),e}function qs(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["displayName"]);i!=null&&l(e,["displayName"],i);const o=a(n,["description"]);o!=null&&l(e,["description"],o);const s=a(n,["version"]);s!=null&&l(e,["version"],s);const r=a(n,["_self"]);r!=null&&l(e,["tunedModelInfo"],Fv(r));const c=a(n,["inputTokenLimit"]);c!=null&&l(e,["inputTokenLimit"],c);const f=a(n,["outputTokenLimit"]);f!=null&&l(e,["outputTokenLimit"],f);const d=a(n,["supportedGenerationMethods"]);d!=null&&l(e,["supportedActions"],d);const h=a(n,["temperature"]);h!=null&&l(e,["temperature"],h);const m=a(n,["maxTemperature"]);m!=null&&l(e,["maxTemperature"],m);const g=a(n,["topP"]);g!=null&&l(e,["topP"],g);const T=a(n,["topK"]);T!=null&&l(e,["topK"],T);const P=a(n,["thinking"]);return P!=null&&l(e,["thinking"],P),e}function Bs(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["displayName"]);i!=null&&l(e,["displayName"],i);const o=a(n,["description"]);o!=null&&l(e,["description"],o);const s=a(n,["versionId"]);s!=null&&l(e,["version"],s);const r=a(n,["deployedModels"]);if(r!=null){let m=r;Array.isArray(m)&&(m=m.map(g=>kI(g))),l(e,["endpoints"],m)}const c=a(n,["labels"]);c!=null&&l(e,["labels"],c);const f=a(n,["_self"]);f!=null&&l(e,["tunedModelInfo"],Uv(f));const d=a(n,["defaultCheckpointId"]);d!=null&&l(e,["defaultCheckpointId"],d);const h=a(n,["checkpoints"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(g=>g)),l(e,["checkpoints"],m)}return e}function vv(n){const e={},t=a(n,["mediaResolution"]);t!=null&&l(e,["mediaResolution"],t);const i=a(n,["codeExecutionResult"]);i!=null&&l(e,["codeExecutionResult"],i);const o=a(n,["executableCode"]);o!=null&&l(e,["executableCode"],o);const s=a(n,["fileData"]);s!=null&&l(e,["fileData"],bI(s));const r=a(n,["functionCall"]);r!=null&&l(e,["functionCall"],LI(r));const c=a(n,["functionResponse"]);c!=null&&l(e,["functionResponse"],c);const f=a(n,["inlineData"]);f!=null&&l(e,["inlineData"],aI(f));const d=a(n,["text"]);d!=null&&l(e,["text"],d);const h=a(n,["thought"]);h!=null&&l(e,["thought"],h);const m=a(n,["thoughtSignature"]);m!=null&&l(e,["thoughtSignature"],m);const g=a(n,["videoMetadata"]);return g!=null&&l(e,["videoMetadata"],g),e}function Av(n){const e={},t=a(n,["productImage"]);return t!=null&&l(e,["image"],He(t)),e}function Cv(n,e){const t={},i=a(n,["numberOfImages"]);e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i);const o=a(n,["baseSteps"]);e!==void 0&&o!=null&&l(e,["parameters","baseSteps"],o);const s=a(n,["outputGcsUri"]);e!==void 0&&s!=null&&l(e,["parameters","storageUri"],s);const r=a(n,["seed"]);e!==void 0&&r!=null&&l(e,["parameters","seed"],r);const c=a(n,["safetyFilterLevel"]);e!==void 0&&c!=null&&l(e,["parameters","safetySetting"],c);const f=a(n,["personGeneration"]);e!==void 0&&f!=null&&l(e,["parameters","personGeneration"],f);const d=a(n,["addWatermark"]);e!==void 0&&d!=null&&l(e,["parameters","addWatermark"],d);const h=a(n,["outputMimeType"]);e!==void 0&&h!=null&&l(e,["parameters","outputOptions","mimeType"],h);const m=a(n,["outputCompressionQuality"]);e!==void 0&&m!=null&&l(e,["parameters","outputOptions","compressionQuality"],m);const g=a(n,["enhancePrompt"]);e!==void 0&&g!=null&&l(e,["parameters","enhancePrompt"],g);const T=a(n,["labels"]);return e!==void 0&&T!=null&&l(e,["labels"],T),t}function Sv(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["source"]);o!=null&&Rv(o,t);const s=a(e,["config"]);return s!=null&&Cv(s,t),t}function wv(n){const e={},t=a(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Po(o))),l(e,["generatedImages"],i)}return e}function Rv(n,e){const t={},i=a(n,["prompt"]);e!==void 0&&i!=null&&l(e,["instances[0]","prompt"],i);const o=a(n,["personImage"]);e!==void 0&&o!=null&&l(e,["instances[0]","personImage","image"],He(o));const s=a(n,["productImages"]);if(e!==void 0&&s!=null){let r=s;Array.isArray(r)&&(r=r.map(c=>Av(c))),l(e,["instances[0]","productImages"],r)}return t}function Pv(n){const e={},t=a(n,["referenceImage"]);t!=null&&l(e,["referenceImage"],He(t));const i=a(n,["referenceId"]);i!=null&&l(e,["referenceId"],i);const o=a(n,["referenceType"]);o!=null&&l(e,["referenceType"],o);const s=a(n,["maskImageConfig"]);s!=null&&l(e,["maskImageConfig"],Iv(s));const r=a(n,["controlImageConfig"]);r!=null&&l(e,["controlImageConfig"],pI(r));const c=a(n,["styleImageConfig"]);c!=null&&l(e,["styleImageConfig"],c);const f=a(n,["subjectImageConfig"]);return f!=null&&l(e,["subjectImageConfig"],f),e}function Vf(n){const e={},t=a(n,["safetyAttributes","categories"]);t!=null&&l(e,["categories"],t);const i=a(n,["safetyAttributes","scores"]);i!=null&&l(e,["scores"],i);const o=a(n,["contentType"]);return o!=null&&l(e,["contentType"],o),e}function xf(n){const e={},t=a(n,["safetyAttributes","categories"]);t!=null&&l(e,["categories"],t);const i=a(n,["safetyAttributes","scores"]);i!=null&&l(e,["scores"],i);const o=a(n,["contentType"]);return o!=null&&l(e,["contentType"],o),e}function Nv(n){const e={},t=a(n,["category"]);if(t!=null&&l(e,["category"],t),a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const i=a(n,["threshold"]);return i!=null&&l(e,["threshold"],i),e}function Mv(n){const e={},t=a(n,["image"]);return t!=null&&l(e,["image"],He(t)),e}function Dv(n,e){const t={},i=a(n,["mode"]);e!==void 0&&i!=null&&l(e,["parameters","mode"],i);const o=a(n,["maxPredictions"]);e!==void 0&&o!=null&&l(e,["parameters","maxPredictions"],o);const s=a(n,["confidenceThreshold"]);e!==void 0&&s!=null&&l(e,["parameters","confidenceThreshold"],s);const r=a(n,["maskDilation"]);e!==void 0&&r!=null&&l(e,["parameters","maskDilation"],r);const c=a(n,["binaryColorThreshold"]);e!==void 0&&c!=null&&l(e,["parameters","binaryColorThreshold"],c);const f=a(n,["labels"]);return e!==void 0&&f!=null&&l(e,["labels"],f),t}function Vv(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["source"]);o!=null&&kv(o,t);const s=a(e,["config"]);return s!=null&&Dv(s,t),t}function xv(n){const e={},t=a(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>ov(o))),l(e,["generatedMasks"],i)}return e}function kv(n,e){const t={},i=a(n,["prompt"]);e!==void 0&&i!=null&&l(e,["instances[0]","prompt"],i);const o=a(n,["image"]);e!==void 0&&o!=null&&l(e,["instances[0]","image"],He(o));const s=a(n,["scribbleImage"]);return e!==void 0&&s!=null&&l(e,["instances[0]","scribble"],Mv(s)),t}function kf(n){const e={},t=a(n,["voiceConfig"]);t!=null&&l(e,["voiceConfig"],t);const i=a(n,["languageCode"]);if(i!=null&&l(e,["languageCode"],i),a(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function bv(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&l(e,["functionCallingConfig"],FI(t));const i=a(n,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],i),e}function Lv(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);const o=a(n,["computerUse"]);o!=null&&l(e,["computerUse"],o);const s=a(n,["fileSearch"]);s!=null&&l(e,["fileSearch"],s);const r=a(n,["codeExecution"]);if(r!=null&&l(e,["codeExecution"],r),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const c=a(n,["googleMaps"]);c!=null&&l(e,["googleMaps"],cv(c));const f=a(n,["googleSearch"]);f!=null&&l(e,["googleSearch"],dv(f));const d=a(n,["urlContext"]);return d!=null&&l(e,["urlContext"],d),e}function bf(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(g=>UI(g))),l(e,["functionDeclarations"],m)}const i=a(n,["retrieval"]);i!=null&&l(e,["retrieval"],i);const o=a(n,["googleSearchRetrieval"]);o!=null&&l(e,["googleSearchRetrieval"],o);const s=a(n,["computerUse"]);if(s!=null&&l(e,["computerUse"],s),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const r=a(n,["codeExecution"]);r!=null&&l(e,["codeExecution"],r);const c=a(n,["enterpriseWebSearch"]);c!=null&&l(e,["enterpriseWebSearch"],c);const f=a(n,["googleMaps"]);f!=null&&l(e,["googleMaps"],f);const d=a(n,["googleSearch"]);d!=null&&l(e,["googleSearch"],d);const h=a(n,["urlContext"]);return h!=null&&l(e,["urlContext"],h),e}function Fv(n){const e={},t=a(n,["baseModel"]);t!=null&&l(e,["baseModel"],t);const i=a(n,["createTime"]);i!=null&&l(e,["createTime"],i);const o=a(n,["updateTime"]);return o!=null&&l(e,["updateTime"],o),e}function Uv(n){const e={},t=a(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&l(e,["baseModel"],t);const i=a(n,["createTime"]);i!=null&&l(e,["createTime"],i);const o=a(n,["updateTime"]);return o!=null&&l(e,["updateTime"],o),e}function qv(n,e){const t={},i=a(n,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);const o=a(n,["description"]);e!==void 0&&o!=null&&l(e,["description"],o);const s=a(n,["defaultCheckpointId"]);return e!==void 0&&s!=null&&l(e,["defaultCheckpointId"],s),t}function Bv(n,e){const t={},i=a(n,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);const o=a(n,["description"]);e!==void 0&&o!=null&&l(e,["description"],o);const s=a(n,["defaultCheckpointId"]);return e!==void 0&&s!=null&&l(e,["defaultCheckpointId"],s),t}function Gv(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","name"],te(n,i));const o=a(e,["config"]);return o!=null&&qv(o,t),t}function Ov(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["config"]);return o!=null&&Bv(o,t),t}function Hv(n,e){const t={},i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);const o=a(n,["safetyFilterLevel"]);e!==void 0&&o!=null&&l(e,["parameters","safetySetting"],o);const s=a(n,["personGeneration"]);e!==void 0&&s!=null&&l(e,["parameters","personGeneration"],s);const r=a(n,["includeRaiReason"]);e!==void 0&&r!=null&&l(e,["parameters","includeRaiReason"],r);const c=a(n,["outputMimeType"]);e!==void 0&&c!=null&&l(e,["parameters","outputOptions","mimeType"],c);const f=a(n,["outputCompressionQuality"]);e!==void 0&&f!=null&&l(e,["parameters","outputOptions","compressionQuality"],f);const d=a(n,["enhanceInputImage"]);e!==void 0&&d!=null&&l(e,["parameters","upscaleConfig","enhanceInputImage"],d);const h=a(n,["imagePreservationFactor"]);e!==void 0&&h!=null&&l(e,["parameters","upscaleConfig","imagePreservationFactor"],h);const m=a(n,["labels"]);e!==void 0&&m!=null&&l(e,["labels"],m);const g=a(n,["numberOfImages"]);e!==void 0&&g!=null&&l(e,["parameters","sampleCount"],g);const T=a(n,["mode"]);return e!==void 0&&T!=null&&l(e,["parameters","mode"],T),t}function $v(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["_url","model"],te(n,i));const o=a(e,["image"]);o!=null&&l(t,["instances[0]","image"],He(o));const s=a(e,["upscaleFactor"]);s!=null&&l(t,["parameters","upscaleConfig","upscaleFactor"],s);const r=a(e,["config"]);return r!=null&&Hv(r,t),t}function Jv(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>Po(s))),l(e,["generatedImages"],o)}return e}function zv(n){const e={},t=a(n,["uri"]);t!=null&&l(e,["uri"],t);const i=a(n,["encodedVideo"]);i!=null&&l(e,["videoBytes"],Pt(i));const o=a(n,["encoding"]);return o!=null&&l(e,["mimeType"],o),e}function Kv(n){const e={},t=a(n,["gcsUri"]);t!=null&&l(e,["uri"],t);const i=a(n,["bytesBase64Encoded"]);i!=null&&l(e,["videoBytes"],Pt(i));const o=a(n,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function Wv(n){const e={},t=a(n,["image"]);t!=null&&l(e,["_self"],He(t));const i=a(n,["maskMode"]);return i!=null&&l(e,["maskMode"],i),e}function Yv(n){const e={},t=a(n,["image"]);t!=null&&l(e,["image"],No(t));const i=a(n,["referenceType"]);return i!=null&&l(e,["referenceType"],i),e}function Qv(n){const e={},t=a(n,["image"]);t!=null&&l(e,["image"],He(t));const i=a(n,["referenceType"]);return i!=null&&l(e,["referenceType"],i),e}function Lf(n){const e={},t=a(n,["uri"]);t!=null&&l(e,["uri"],t);const i=a(n,["videoBytes"]);i!=null&&l(e,["encodedVideo"],Pt(i));const o=a(n,["mimeType"]);return o!=null&&l(e,["encoding"],o),e}function Ff(n){const e={},t=a(n,["uri"]);t!=null&&l(e,["gcsUri"],t);const i=a(n,["videoBytes"]);i!=null&&l(e,["bytesBase64Encoded"],Pt(i));const o=a(n,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Xv(n,e){const t={},i=a(n,["displayName"]);return e!==void 0&&i!=null&&l(e,["displayName"],i),t}function Zv(n){const e={},t=a(n,["config"]);return t!=null&&Xv(t,e),e}function jv(n,e){const t={},i=a(n,["force"]);return e!==void 0&&i!=null&&l(e,["_query","force"],i),t}function eA(n){const e={},t=a(n,["name"]);t!=null&&l(e,["_url","name"],t);const i=a(n,["config"]);return i!=null&&jv(i,e),e}function tA(n){const e={},t=a(n,["name"]);return t!=null&&l(e,["_url","name"],t),e}function nA(n,e){const t={},i=a(n,["customMetadata"]);if(e!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>r)),l(e,["customMetadata"],s)}const o=a(n,["chunkingConfig"]);return e!==void 0&&o!=null&&l(e,["chunkingConfig"],o),t}function iA(n){const e={},t=a(n,["name"]);t!=null&&l(e,["name"],t);const i=a(n,["metadata"]);i!=null&&l(e,["metadata"],i);const o=a(n,["done"]);o!=null&&l(e,["done"],o);const s=a(n,["error"]);s!=null&&l(e,["error"],s);const r=a(n,["response"]);return r!=null&&l(e,["response"],sA(r)),e}function oA(n){const e={},t=a(n,["fileSearchStoreName"]);t!=null&&l(e,["_url","file_search_store_name"],t);const i=a(n,["fileName"]);i!=null&&l(e,["fileName"],i);const o=a(n,["config"]);return o!=null&&nA(o,e),e}function sA(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["parent"]);i!=null&&l(e,["parent"],i);const o=a(n,["documentName"]);return o!=null&&l(e,["documentName"],o),e}function rA(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);return e!==void 0&&o!=null&&l(e,["_query","pageToken"],o),t}function aA(n){const e={},t=a(n,["config"]);return t!=null&&rA(t,e),e}function lA(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&l(e,["nextPageToken"],i);const o=a(n,["fileSearchStores"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>r)),l(e,["fileSearchStores"],s)}return e}function Uf(n,e){const t={},i=a(n,["mimeType"]);e!==void 0&&i!=null&&l(e,["mimeType"],i);const o=a(n,["displayName"]);e!==void 0&&o!=null&&l(e,["displayName"],o);const s=a(n,["customMetadata"]);if(e!==void 0&&s!=null){let c=s;Array.isArray(c)&&(c=c.map(f=>f)),l(e,["customMetadata"],c)}const r=a(n,["chunkingConfig"]);return e!==void 0&&r!=null&&l(e,["chunkingConfig"],r),t}function uA(n){const e={},t=a(n,["fileSearchStoreName"]);t!=null&&l(e,["_url","file_search_store_name"],t);const i=a(n,["config"]);return i!=null&&Uf(i,e),e}function cA(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&l(e,["sdkHttpResponse"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const dA="Content-Type",fA="X-Server-Timeout",hA="User-Agent",Gs="x-goog-api-client",pA="1.32.0",mA=`google-genai-sdk/${pA}`,gA="v1beta1",yA="v1beta";class _A{constructor(e){var t,i;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const o={};this.clientOptions.vertexai?(o.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:gA,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:yA,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,i){const o=[this.getRequestUrlInternal(t)];return i&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,i);if(e.queryParams)for(const[r,c]of Object.entries(e.queryParams))o.searchParams.append(r,String(c));let s={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else s.body=e.body;return s=await this.includeExtraHttpOptionsToRequestInit(s,t,o.toString(),e.abortSignal),this.unaryApiCall(o,s,e.httpMethod)}patchHttpOptions(e,t){const i=JSON.parse(JSON.stringify(e));for(const[o,s]of Object.entries(t))typeof s=="object"?i[o]=Object.assign(Object.assign({},i[o]),s):s!==void 0&&(i[o]=s);return i}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,i);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let s={};return s.body=e.body,s=await this.includeExtraHttpOptionsToRequestInit(s,t,o.toString(),e.abortSignal),this.streamApiCall(o,s,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,i,o){if(t&&t.timeout||o){const s=new AbortController,r=s.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){const c=setTimeout(()=>s.abort(),t.timeout);c&&typeof c.unref=="function"&&c.unref()}o&&o.addEventListener("abort",()=>{s.abort()}),e.signal=r}return t&&t.extraBody!==null&&TA(e,t.extraBody),e.headers=await this.getHeadersInternal(t,i),e}async unaryApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async o=>(await gc(o),new Ls(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async o=>(await gc(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){return tn(this,arguments,function*(){var i;const o=(i=e==null?void 0:e.body)===null||i===void 0?void 0:i.getReader(),s=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let r="";const c="data:",f=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:d,value:h}=yield le(o.read());if(d){if(r.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const m=s.decode(h,{stream:!0});try{const P=JSON.parse(m);if("error"in P){const M=JSON.parse(JSON.stringify(P.error)),N=M.status,V=M.code,L=`got status: ${N}. ${JSON.stringify(P)}`;if(V>=400&&V<600)throw new wo({message:L,status:V})}}catch(P){if(P.name==="ApiError")throw P}r+=m;let g=-1,T=0;for(;;){g=-1,T=0;for(const N of f){const V=r.indexOf(N);V!==-1&&(g===-1||V<g)&&(g=V,T=N.length)}if(g===-1)break;const P=r.substring(0,g);r=r.substring(g+T);const M=P.trim();if(M.startsWith(c)){const N=M.substring(c.length).trim();try{const V=new Response(N,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield le(new Ls(V))}catch(V){throw new Error(`exception parsing stream chunk ${N}. ${V}`)}}}}}finally{o.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){const e={},t=mA+" "+this.clientOptions.userAgentExtra;return e[hA]=t,e[Gs]=t,e[dA]="application/json",e}async getHeadersInternal(e,t){const i=new Headers;if(e&&e.headers){for(const[o,s]of Object.entries(e.headers))i.append(o,s);e.timeout&&e.timeout>0&&i.append(fA,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(i,t),i}getFileName(e){var t;let i="";return typeof e=="string"&&(i=e.replace(/[/\\]+$/,""),i=(t=i.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),i}async uploadFile(e,t){var i;const o={};t!=null&&(o.mimeType=t.mimeType,o.name=t.name,o.displayName=t.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);const s=this.clientOptions.uploader,r=await s.stat(e);o.sizeBytes=String(r.size);const c=(i=t==null?void 0:t.mimeType)!==null&&i!==void 0?i:r.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=c;const f={file:o},d=this.getFileName(e),h=G("upload/v1beta/files",f._url),m=await this.fetchUploadUrl(h,o.sizeBytes,o.mimeType,d,f,t==null?void 0:t.httpOptions);return s.upload(e,m,this)}async uploadFileToFileSearchStore(e,t,i){var o;const s=this.clientOptions.uploader,r=await s.stat(t),c=String(r.size),f=(o=i==null?void 0:i.mimeType)!==null&&o!==void 0?o:r.type;if(f===void 0||f==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const d=`upload/v1beta/${e}:uploadToFileSearchStore`,h=this.getFileName(t),m={};i!=null&&Uf(i,m);const g=await this.fetchUploadUrl(d,c,f,h,m,i==null?void 0:i.httpOptions);return s.uploadToFileSearchStore(t,g,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,i,o,s,r){var c;let f={};r?f=r:f={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${i}`},o?{"X-Goog-Upload-File-Name":o}:{})};const d=await this.request({path:e,body:JSON.stringify(s),httpMethod:"POST",httpOptions:f});if(!d||!(d!=null&&d.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const h=(c=d==null?void 0:d.headers)===null||c===void 0?void 0:c["x-goog-upload-url"];if(h===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return h}}async function gc(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let i;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await n.json():i={error:{message:await n.text(),code:n.status,status:n.statusText}};const o=JSON.stringify(i);throw t>=400&&t<600?new wo({message:o,status:t}):new Error(o)}}function TA(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const s=JSON.parse(n.body);if(typeof s=="object"&&s!==null&&!Array.isArray(s))t=s;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function i(s,r){const c=Object.assign({},s);for(const f in r)if(Object.prototype.hasOwnProperty.call(r,f)){const d=r[f],h=c[f];d&&typeof d=="object"&&!Array.isArray(d)&&h&&typeof h=="object"&&!Array.isArray(h)?c[f]=i(h,d):(h&&d&&typeof h!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${f}". Original type: ${typeof h}, New type: ${typeof d}. Overwriting.`),c[f]=d)}return c}const o=i(t,e);n.body=JSON.stringify(o)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const EA="mcp_used/unknown";let IA=!1;function qf(n){for(const e of n)if(vA(e)||typeof e=="object"&&"inputSchema"in e)return!0;return IA}function Bf(n){var e;const t=(e=n[Gs])!==null&&e!==void 0?e:"";n[Gs]=(t+` ${EA}`).trimStart()}function vA(n){return n!==null&&typeof n=="object"&&n instanceof Lr}function AA(n){return tn(this,arguments,function*(t,i=100){let o,s=0;for(;s<i;){const r=yield le(t.listTools({cursor:o}));for(const c of r.tools)yield yield le(c),s++;if(!r.nextCursor)break;o=r.nextCursor}})}class Lr{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new Lr(e,t)}async initialize(){var e,t,i,o;if(this.mcpTools.length>0)return;const s={},r=[];for(const h of this.mcpClients)try{for(var c=!0,f=(t=void 0,Kn(AA(h))),d;d=await f.next(),e=d.done,!e;c=!0){o=d.value,c=!1;const m=o;r.push(m);const g=m.name;if(s[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);s[g]=h}}catch(m){t={error:m}}finally{try{!c&&!e&&(i=f.return)&&await i.call(f)}finally{if(t)throw t.error}}this.mcpTools=r,this.functionNameToMcpClient=s}async tool(){return await this.initialize(),tT(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const i of e)if(i.name in this.functionNameToMcpClient){const o=this.functionNameToMcpClient[i.name];let s;this.config.timeout&&(s={timeout:this.config.timeout});const r=await o.callTool({name:i.name,arguments:i.args},void 0,s);t.push({functionResponse:{name:i.name,response:r.isError?{error:r}:r}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function CA(n,e,t){const i=new K_;let o;t.data instanceof Blob?o=JSON.parse(await t.data.text()):o=JSON.parse(t.data),Object.assign(i,o),e(i)}class SA{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i}async connect(e){var t,i;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const o=this.apiClient.getWebsocketBaseUrl(),s=this.apiClient.getApiVersion(),r=PA(this.apiClient.getDefaultHeaders()),c=this.apiClient.getApiKey(),f=`${o}/ws/google.ai.generativelanguage.${s}.GenerativeService.BidiGenerateMusic?key=${c}`;let d=()=>{};const h=new Promise(b=>{d=b}),m=e.callbacks,g=function(){d({})},T=this.apiClient,P={onopen:g,onmessage:b=>{CA(T,m.onmessage,b)},onerror:(t=m==null?void 0:m.onerror)!==null&&t!==void 0?t:function(b){},onclose:(i=m==null?void 0:m.onclose)!==null&&i!==void 0?i:function(b){}},M=this.webSocketFactory.create(f,RA(r),P);M.connect(),await h;const L={setup:{model:te(this.apiClient,e.model)}};return M.send(JSON.stringify(L)),new wA(M,this.apiClient)}}class wA{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=ZE(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=XE(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Xt.PLAY)}pause(){this.sendPlaybackControl(Xt.PAUSE)}stop(){this.sendPlaybackControl(Xt.STOP)}resetContext(){this.sendPlaybackControl(Xt.RESET_CONTEXT)}close(){this.conn.close()}}function RA(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function PA(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const NA="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function MA(n,e,t){const i=new z_;let o;t.data instanceof Blob?o=await t.data.text():t.data instanceof ArrayBuffer?o=new TextDecoder().decode(t.data):o=t.data;const s=JSON.parse(o);if(n.isVertexAI()){const r=tI(s);Object.assign(i,r)}else Object.assign(i,s);e(i)}class DA{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i,this.music=new SA(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,i,o,s,r,c;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const f=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let h;const m=this.apiClient.getHeaders();e.config&&e.config.tools&&qf(e.config.tools)&&Bf(m);const g=bA(m);if(this.apiClient.isVertexAI())h=`${f}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g,h);else{const E=this.apiClient.getApiKey();let C="BidiGenerateContent",S="key";E!=null&&E.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),C="BidiGenerateContentConstrained",S="access_token"),h=`${f}/ws/google.ai.generativelanguage.${d}.GenerativeService.${C}?${S}=${E}`}let T=()=>{};const P=new Promise(E=>{T=E}),M=e.callbacks,N=function(){var E;(E=M==null?void 0:M.onopen)===null||E===void 0||E.call(M),T({})},V=this.apiClient,L={onopen:N,onmessage:E=>{MA(V,M.onmessage,E)},onerror:(t=M==null?void 0:M.onerror)!==null&&t!==void 0?t:function(E){},onclose:(i=M==null?void 0:M.onclose)!==null&&i!==void 0?i:function(E){}},b=this.webSocketFactory.create(h,kA(g),L);b.connect(),await P;let H=te(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&H.startsWith("publishers/")){const E=this.apiClient.getProject(),C=this.apiClient.getLocation();H=`projects/${E}/locations/${C}/`+H}let z={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[no.AUDIO]}:e.config.responseModalities=[no.AUDIO]),!((s=e.config)===null||s===void 0)&&s.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const $=(c=(r=e.config)===null||r===void 0?void 0:r.tools)!==null&&c!==void 0?c:[],A=[];for(const E of $)if(this.isCallableTool(E)){const C=E;A.push(await C.tool())}else A.push(E);A.length>0&&(e.config.tools=A);const I={model:H,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?z=QE(this.apiClient,I):z=YE(this.apiClient,I),delete z.config,b.send(JSON.stringify(z)),new xA(b,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const VA={turnComplete:!0};class xA{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let i=[];try{i=qe(t.turns),e.isVertexAI()||(i=i.map(o=>Ro(o)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:i,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let i=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?i=t.functionResponses:i=[t.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(const s of i){if(typeof s!="object"||s===null||!("name"in s)||!("response"in s))throw new Error(`Could not parse function response, type '${typeof s}'.`);if(!e.isVertexAI()&&!("id"in s))throw new Error(NA)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},VA),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:eI(e)}:t={realtimeInput:jE(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function kA(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function bA(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const yc=10;function _c(n){var e,t,i;if(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(const r of(t=n==null?void 0:n.tools)!==null&&t!==void 0?t:[])if(nn(r)){o=!0;break}if(!o)return!0;const s=(i=n==null?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls;return s&&(s<0||!Number.isInteger(s))||s==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",s),!0):!1}function nn(n){return"callTool"in n&&typeof n.callTool=="function"}function LA(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(o=>nn(o)))!==null&&i!==void 0?i:!1}function Tc(n){var e;const t=[];return!((e=n==null?void 0:n.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((i,o)=>{if(nn(i))return;const s=i;s.functionDeclarations&&s.functionDeclarations.length>0&&t.push(o)}),t}function Ec(n){var e;return!(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class FA extends ot{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var i,o,s,r,c;const f=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!LA(t)||_c(t.config))return await this.generateContentInternal(f);const d=Tc(t);if(d.length>0){const M=d.map(N=>`tools[${N}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${M}.`)}let h,m;const g=qe(f.contents),T=(s=(o=(i=f.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&s!==void 0?s:yc;let P=0;for(;P<T&&(h=await this.generateContentInternal(f),!(!h.functionCalls||h.functionCalls.length===0));){const M=h.candidates[0].content,N=[];for(const V of(c=(r=t.config)===null||r===void 0?void 0:r.tools)!==null&&c!==void 0?c:[])if(nn(V)){const b=await V.callTool(h.functionCalls);N.push(...b)}P++,m={role:"user",parts:N},f.contents=qe(f.contents),f.contents.push(M),f.contents.push(m),Ec(f.config)&&(g.push(M),g.push(m))}return Ec(f.config)&&(h.automaticFunctionCallingHistory=g),h},this.generateContentStream=async t=>{var i,o,s,r,c;if(this.maybeMoveToResponseJsonSchem(t),_c(t.config)){const m=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(m)}const f=Tc(t);if(f.length>0){const m=f.map(g=>`tools[${g}]`).join(", ");throw new Error(`Incompatible tools found at ${m}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const d=(s=(o=(i=t==null?void 0:t.config)===null||i===void 0?void 0:i.toolConfig)===null||o===void 0?void 0:o.functionCallingConfig)===null||s===void 0?void 0:s.streamFunctionCallArguments,h=(c=(r=t==null?void 0:t.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||c===void 0?void 0:c.disable;if(d&&!h)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(i=>{var o;let s;const r=[];if(i!=null&&i.generatedImages)for(const f of i.generatedImages)f&&(f!=null&&f.safetyAttributes)&&((o=f==null?void 0:f.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?s=f==null?void 0:f.safetyAttributes:r.push(f);let c;return s?c={generatedImages:r,positivePromptSafetyAttributes:s,sdkHttpResponse:i.sdkHttpResponse}:c={generatedImages:r,sdkHttpResponse:i.sdkHttpResponse},c}),this.list=async t=>{var i;const r={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!r.config.queryBase){if(!((i=r.config)===null||i===void 0)&&i.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");r.config.filter="labels.tune-type:*"}return new Ot(nt.PAGED_ITEM_MODELS,c=>this.listInternal(c),await this.listInternal(r),r)},this.editImage=async t=>{const i={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(i.referenceImages=t.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(i)},this.upscaleImage=async t=>{let i={numberOfImages:1,mode:"upscale"};t.config&&(i=Object.assign(Object.assign({},i),t.config));const o={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:i};return await this.upscaleImageInternal(o)},this.generateVideos=async t=>{var i,o,s,r,c,f;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((i=t.video)===null||i===void 0)&&i.uri&&(!((o=t.video)===null||o===void 0)&&o.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((r=(s=t.source)===null||s===void 0?void 0:s.video)===null||r===void 0)&&r.uri&&(!((f=(c=t.source)===null||c===void 0?void 0:c.video)===null||f===void 0)&&f.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,i,o;const s=(t=e.config)===null||t===void 0?void 0:t.tools;if(!s)return e;const r=await Promise.all(s.map(async f=>nn(f)?await f.tool():f)),c={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:r})};if(c.config.tools=r,e.config&&e.config.tools&&qf(e.config.tools)){const f=(o=(i=e.config.httpOptions)===null||i===void 0?void 0:i.headers)!==null&&o!==void 0?o:{};let d=Object.assign({},f);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),Bf(d),c.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return c}async initAfcToolsMap(e){var t,i,o;const s=new Map;for(const r of(i=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&i!==void 0?i:[])if(nn(r)){const c=r,f=await c.tool();for(const d of(o=f.functionDeclarations)!==null&&o!==void 0?o:[]){if(!d.name)throw new Error("Function declaration name is required.");if(s.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);s.set(d.name,c)}}return s}async processAfcStream(e){var t,i,o;const s=(o=(i=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:yc;let r=!1,c=0;const f=await this.initAfcToolsMap(e);return(function(d,h,m){return tn(this,arguments,function*(){for(var g,T,P,M,N,V;c<s;){r&&(c++,r=!1);const z=yield le(d.processParamsMaybeAddMcpUsage(m)),$=yield le(d.generateContentStreamInternal(z)),A=[],I=[];try{for(var L=!0,b=(T=void 0,Kn($)),H;H=yield le(b.next()),g=H.done,!g;L=!0){M=H.value,L=!1;const E=M;if(yield yield le(E),E.candidates&&(!((N=E.candidates[0])===null||N===void 0)&&N.content)){I.push(E.candidates[0].content);for(const C of(V=E.candidates[0].content.parts)!==null&&V!==void 0?V:[])if(c<s&&C.functionCall){if(!C.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(C.functionCall.name)){const S=yield le(h.get(C.functionCall.name).callTool([C.functionCall]));A.push(...S)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${C.functionCall.name}`)}}}}catch(E){T={error:E}}finally{try{!L&&!g&&(P=b.return)&&(yield le(P.call(b)))}finally{if(T)throw T.error}}if(A.length>0){r=!0;const E=new Fn;E.candidates=[{content:{role:"user",parts:A}}],yield yield le(E);const C=[];C.push(...I),C.push({role:"user",parts:A});const S=qe(m.contents).concat(C);m.contents=S}else break}})})(this,f,e)}async generateContentInternal(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=hc(this.apiClient,e);return c=G("{model}:generateContent",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=mc(h),g=new Fn;return Object.assign(g,m),g})}else{const d=fc(this.apiClient,e);return c=G("{model}:generateContent",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=pc(h),g=new Fn;return Object.assign(g,m),g})}}async generateContentStreamInternal(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=hc(this.apiClient,e);return c=G("{model}:streamGenerateContent?alt=sse",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.requestStream({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),r.then(function(m){return tn(this,arguments,function*(){var g,T,P,M;try{for(var N=!0,V=Kn(m),L;L=yield le(V.next()),g=L.done,!g;N=!0){M=L.value,N=!1;const b=M,H=mc(yield le(b.json()));H.sdkHttpResponse={headers:b.headers};const z=new Fn;Object.assign(z,H),yield yield le(z)}}catch(b){T={error:b}}finally{try{!N&&!g&&(P=V.return)&&(yield le(P.call(V)))}finally{if(T)throw T.error}}})})}else{const d=fc(this.apiClient,e);return c=G("{model}:streamGenerateContent?alt=sse",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.requestStream({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),r.then(function(m){return tn(this,arguments,function*(){var g,T,P,M;try{for(var N=!0,V=Kn(m),L;L=yield le(V.next()),g=L.done,!g;N=!0){M=L.value,N=!1;const b=M,H=pc(yield le(b.json()));H.sdkHttpResponse={headers:b.headers};const z=new Fn;Object.assign(z,H),yield yield le(z)}}catch(b){T={error:b}}finally{try{!N&&!g&&(P=V.return)&&(yield le(P.call(V)))}finally{if(T)throw T.error}}})})}}async embedContent(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=DI(this.apiClient,e);return c=G("{model}:predict",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=xI(h),g=new Yu;return Object.assign(g,m),g})}else{const d=MI(this.apiClient,e);return c=G("{model}:batchEmbedContents",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=VI(h),g=new Yu;return Object.assign(g,m),g})}}async generateImagesInternal(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=$I(this.apiClient,e);return c=G("{model}:predict",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=zI(h),g=new Qu;return Object.assign(g,m),g})}else{const d=HI(this.apiClient,e);return c=G("{model}:predict",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=JI(h),g=new Qu;return Object.assign(g,m),g})}}async editImageInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){const c=wI(this.apiClient,e);return s=G("{model}:predict",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const d=RI(f),h=new b_;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){const c=$v(this.apiClient,e);return s=G("{model}:predict",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const d=Jv(f),h=new L_;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){const c=Sv(this.apiClient,e);return s=G("{model}:predict",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{const d=wv(f),h=new F_;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){const c=Vv(this.apiClient,e);return s=G("{model}:predict",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{const d=xv(f),h=new U_;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=uv(this.apiClient,e);return c=G("{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),r.then(h=>Bs(h))}else{const d=lv(this.apiClient,e);return c=G("{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),r.then(h=>qs(h))}}async listInternal(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=_v(this.apiClient,e);return c=G("{models_url}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=Ev(h),g=new Xu;return Object.assign(g,m),g})}else{const d=yv(this.apiClient,e);return c=G("{models_url}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=Tv(h),g=new Xu;return Object.assign(g,m),g})}}async update(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=Ov(this.apiClient,e);return c=G("{model}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),r.then(h=>Bs(h))}else{const d=Gv(this.apiClient,e);return c=G("{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),r.then(h=>qs(h))}}async delete(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=vI(this.apiClient,e);return c=G("{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=CI(h),g=new Zu;return Object.assign(g,m),g})}else{const d=II(this.apiClient,e);return c=G("{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=AI(h),g=new Zu;return Object.assign(g,m),g})}}async countTokens(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=_I(this.apiClient,e);return c=G("{model}:countTokens",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=EI(h),g=new ju;return Object.assign(g,m),g})}else{const d=yI(this.apiClient,e);return c=G("{model}:countTokens",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=TI(h),g=new ju;return Object.assign(g,m),g})}}async computeTokens(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){const c=cI(this.apiClient,e);return s=G("{model}:computeTokens",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const d=dI(f),h=new q_;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=ZI(this.apiClient,e);return c=G("{model}:predictLongRunning",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),r.then(h=>{const m=QI(h),g=new io;return Object.assign(g,m),g})}else{const d=XI(this.apiClient,e);return c=G("{model}:predictLongRunning",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),r.then(h=>{const m=YI(h),g=new io;return Object.assign(g,m),g})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class UA extends ot{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=t.name.split("/operations/")[0];let s;i&&"httpOptions"in i&&(s=i.httpOptions);const r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:s}});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async get(e){const t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=t.name.split("/operations/")[0];let s;i&&"httpOptions"in i&&(s=i.httpOptions);const r=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:s}});return t._fromAPIResponse({apiResponse:r,_isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=N_(e);return c=G("{operationName}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json()),r}else{const d=P_(e);return c=G("{operationName}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json()),r}}async fetchPredictVideosOperationInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){const c=I_(e);return s=G("{resourceName}:fetchPredictOperation",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function qA(n){const e={},t=a(n,["data"]);if(t!=null&&l(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function BA(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>YA(s))),l(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&l(e,["role"],i),e}function GA(n,e,t){const i={},o=a(e,["expireTime"]);t!==void 0&&o!=null&&l(t,["expireTime"],o);const s=a(e,["newSessionExpireTime"]);t!==void 0&&s!=null&&l(t,["newSessionExpireTime"],s);const r=a(e,["uses"]);t!==void 0&&r!=null&&l(t,["uses"],r);const c=a(e,["liveConnectConstraints"]);t!==void 0&&c!=null&&l(t,["bidiGenerateContentSetup"],WA(n,c));const f=a(e,["lockAdditionalFields"]);return t!==void 0&&f!=null&&l(t,["fieldMask"],f),i}function OA(n,e){const t={},i=a(e,["config"]);return i!=null&&l(t,["config"],GA(n,i,t)),t}function HA(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&l(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function $A(n){const e={},t=a(n,["id"]);t!=null&&l(e,["id"],t);const i=a(n,["args"]);i!=null&&l(e,["args"],i);const o=a(n,["name"]);if(o!=null&&l(e,["name"],o),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function JA(n){const e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=a(n,["enableWidget"]);return t!=null&&l(e,["enableWidget"],t),e}function zA(n){const e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=a(n,["timeRangeFilter"]);return t!=null&&l(e,["timeRangeFilter"],t),e}function KA(n,e){const t={},i=a(n,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],i);const o=a(n,["responseModalities"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","responseModalities"],o);const s=a(n,["temperature"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","temperature"],s);const r=a(n,["topP"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","topP"],r);const c=a(n,["topK"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","topK"],c);const f=a(n,["maxOutputTokens"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","maxOutputTokens"],f);const d=a(n,["mediaResolution"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","mediaResolution"],d);const h=a(n,["seed"]);e!==void 0&&h!=null&&l(e,["setup","generationConfig","seed"],h);const m=a(n,["speechConfig"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","speechConfig"],br(m));const g=a(n,["thinkingConfig"]);e!==void 0&&g!=null&&l(e,["setup","generationConfig","thinkingConfig"],g);const T=a(n,["enableAffectiveDialog"]);e!==void 0&&T!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],T);const P=a(n,["systemInstruction"]);e!==void 0&&P!=null&&l(e,["setup","systemInstruction"],BA(Ne(P)));const M=a(n,["tools"]);if(e!==void 0&&M!=null){let $=yn(M);Array.isArray($)&&($=$.map(A=>XA(gn(A)))),l(e,["setup","tools"],$)}const N=a(n,["sessionResumption"]);e!==void 0&&N!=null&&l(e,["setup","sessionResumption"],QA(N));const V=a(n,["inputAudioTranscription"]);e!==void 0&&V!=null&&l(e,["setup","inputAudioTranscription"],V);const L=a(n,["outputAudioTranscription"]);e!==void 0&&L!=null&&l(e,["setup","outputAudioTranscription"],L);const b=a(n,["realtimeInputConfig"]);e!==void 0&&b!=null&&l(e,["setup","realtimeInputConfig"],b);const H=a(n,["contextWindowCompression"]);e!==void 0&&H!=null&&l(e,["setup","contextWindowCompression"],H);const z=a(n,["proactivity"]);return e!==void 0&&z!=null&&l(e,["setup","proactivity"],z),t}function WA(n,e){const t={},i=a(e,["model"]);i!=null&&l(t,["setup","model"],te(n,i));const o=a(e,["config"]);return o!=null&&l(t,["config"],KA(o,t)),t}function YA(n){const e={},t=a(n,["mediaResolution"]);t!=null&&l(e,["mediaResolution"],t);const i=a(n,["codeExecutionResult"]);i!=null&&l(e,["codeExecutionResult"],i);const o=a(n,["executableCode"]);o!=null&&l(e,["executableCode"],o);const s=a(n,["fileData"]);s!=null&&l(e,["fileData"],HA(s));const r=a(n,["functionCall"]);r!=null&&l(e,["functionCall"],$A(r));const c=a(n,["functionResponse"]);c!=null&&l(e,["functionResponse"],c);const f=a(n,["inlineData"]);f!=null&&l(e,["inlineData"],qA(f));const d=a(n,["text"]);d!=null&&l(e,["text"],d);const h=a(n,["thought"]);h!=null&&l(e,["thought"],h);const m=a(n,["thoughtSignature"]);m!=null&&l(e,["thoughtSignature"],m);const g=a(n,["videoMetadata"]);return g!=null&&l(e,["videoMetadata"],g),e}function QA(n){const e={},t=a(n,["handle"]);if(t!=null&&l(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function XA(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),l(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearchRetrieval"]);i!=null&&l(e,["googleSearchRetrieval"],i);const o=a(n,["computerUse"]);o!=null&&l(e,["computerUse"],o);const s=a(n,["fileSearch"]);s!=null&&l(e,["fileSearch"],s);const r=a(n,["codeExecution"]);if(r!=null&&l(e,["codeExecution"],r),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const c=a(n,["googleMaps"]);c!=null&&l(e,["googleMaps"],JA(c));const f=a(n,["googleSearch"]);f!=null&&l(e,["googleSearch"],zA(f));const d=a(n,["urlContext"]);return d!=null&&l(e,["urlContext"],d),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ZA(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const i=n[t];if(typeof i=="object"&&i!=null&&Object.keys(i).length>0){const o=Object.keys(i).map(s=>`${t}.${s}`);e.push(...o)}else e.push(t)}return e.join(",")}function jA(n,e){let t=null;const i=n.bidiGenerateContentSetup;if(typeof i=="object"&&i!==null&&"setup"in i){const s=i.setup;typeof s=="object"&&s!==null?(n.bidiGenerateContentSetup=s,t=s):delete n.bidiGenerateContentSetup}else i!==void 0&&delete n.bidiGenerateContentSetup;const o=n.fieldMask;if(t){const s=ZA(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)s?n.fieldMask=s:delete n.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){const r=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let c=[];o.length>0&&(c=o.map(d=>r.includes(d)?`generationConfig.${d}`:d));const f=[];s&&f.push(s),c.length>0&&f.push(...c),f.length>0?n.fieldMask=f.join(","):delete n.fieldMask}else delete n.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?n.fieldMask=o.join(","):delete n.fieldMask;return n}class eC extends ot{constructor(e){super(),this.apiClient=e}async create(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const c=OA(this.apiClient,e);s=G("auth_tokens",c._url),r=c._query,delete c.config,delete c._url,delete c._query;const f=jA(c,e.config);return o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>d)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tC(n,e){const t={},i=a(n,["force"]);return e!==void 0&&i!=null&&l(e,["_query","force"],i),t}function nC(n){const e={},t=a(n,["name"]);t!=null&&l(e,["_url","name"],t);const i=a(n,["config"]);return i!=null&&tC(i,e),e}function iC(n){const e={},t=a(n,["name"]);return t!=null&&l(e,["_url","name"],t),e}function oC(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);return e!==void 0&&o!=null&&l(e,["_query","pageToken"],o),t}function sC(n){const e={},t=a(n,["parent"]);t!=null&&l(e,["_url","parent"],t);const i=a(n,["config"]);return i!=null&&oC(i,e),e}function rC(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&l(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&l(e,["nextPageToken"],i);const o=a(n,["documents"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(r=>r)),l(e,["documents"],s)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class aC extends ot{constructor(e){super(),this.apiClient=e,this.list=async t=>new Ot(nt.PAGED_ITEM_DOCUMENTS,i=>this.listInternal({parent:t.parent,config:i.config}),await this.listInternal(t),t)}async get(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=iC(e);return s=G("{name}",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async delete(e){var t,i;let o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const r=nC(e);o=G("{name}",r._url),s=r._query,delete r._url,delete r._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=sC(e);return s=G("{parent}/documents",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{const d=rC(f),h=new B_;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class lC extends ot{constructor(e,t=new aC(e)){super(),this.apiClient=e,this.documents=t,this.list=async(i={})=>new Ot(nt.PAGED_ITEM_FILE_SEARCH_STORES,o=>this.listInternal(o),await this.listInternal(i),i)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Zv(e);return s=G("fileSearchStores",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async get(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=tA(e);return s=G("{name}",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async delete(e){var t,i;let o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const r=eA(e);o=G("{name}",r._url),s=r._query,delete r._url,delete r._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=aA(e);return s=G("fileSearchStores",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{const d=lA(f),h=new G_;return Object.assign(h,d),h})}}async uploadToFileSearchStoreInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=uA(e);return s=G("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{const d=cA(f),h=new O_;return Object.assign(h,d),h})}}async importFile(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=oA(e);return s=G("{file_search_store_name}:importFile",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{const d=iA(f),h=new Mr;return Object.assign(h,d),h})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function uC(n,e){const t={},i=a(n,["name"]);return i!=null&&l(t,["_url","name"],i),t}function cC(n,e){const t={},i=a(n,["name"]);return i!=null&&l(t,["_url","name"],i),t}function dC(n,e){const t={},i=a(n,["sdkHttpResponse"]);return i!=null&&l(t,["sdkHttpResponse"],i),t}function fC(n,e){const t={},i=a(n,["sdkHttpResponse"]);return i!=null&&l(t,["sdkHttpResponse"],i),t}function hC(n,e,t){const i={};if(a(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const o=a(n,["tunedModelDisplayName"]);if(e!==void 0&&o!=null&&l(e,["displayName"],o),a(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const s=a(n,["epochCount"]);e!==void 0&&s!=null&&l(e,["tuningTask","hyperparameters","epochCount"],s);const r=a(n,["learningRateMultiplier"]);if(r!=null&&l(i,["tuningTask","hyperparameters","learningRateMultiplier"],r),a(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(a(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(a(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const c=a(n,["batchSize"]);e!==void 0&&c!=null&&l(e,["tuningTask","hyperparameters","batchSize"],c);const f=a(n,["learningRate"]);if(e!==void 0&&f!=null&&l(e,["tuningTask","hyperparameters","learningRate"],f),a(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(a(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return i}function pC(n,e,t){const i={};let o=a(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const T=a(n,["validationDataset"]);e!==void 0&&T!=null&&l(e,["supervisedTuningSpec"],Ic(T))}else if(o==="PREFERENCE_TUNING"){const T=a(n,["validationDataset"]);e!==void 0&&T!=null&&l(e,["preferenceOptimizationSpec"],Ic(T))}const s=a(n,["tunedModelDisplayName"]);e!==void 0&&s!=null&&l(e,["tunedModelDisplayName"],s);const r=a(n,["description"]);e!==void 0&&r!=null&&l(e,["description"],r);let c=a(t,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const T=a(n,["epochCount"]);e!==void 0&&T!=null&&l(e,["supervisedTuningSpec","hyperParameters","epochCount"],T)}else if(c==="PREFERENCE_TUNING"){const T=a(n,["epochCount"]);e!==void 0&&T!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],T)}let f=a(t,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const T=a(n,["learningRateMultiplier"]);e!==void 0&&T!=null&&l(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],T)}else if(f==="PREFERENCE_TUNING"){const T=a(n,["learningRateMultiplier"]);e!==void 0&&T!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],T)}let d=a(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const T=a(n,["exportLastCheckpointOnly"]);e!==void 0&&T!=null&&l(e,["supervisedTuningSpec","exportLastCheckpointOnly"],T)}else if(d==="PREFERENCE_TUNING"){const T=a(n,["exportLastCheckpointOnly"]);e!==void 0&&T!=null&&l(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],T)}let h=a(t,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const T=a(n,["adapterSize"]);e!==void 0&&T!=null&&l(e,["supervisedTuningSpec","hyperParameters","adapterSize"],T)}else if(h==="PREFERENCE_TUNING"){const T=a(n,["adapterSize"]);e!==void 0&&T!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],T)}if(a(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(a(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const m=a(n,["labels"]);e!==void 0&&m!=null&&l(e,["labels"],m);const g=a(n,["beta"]);return e!==void 0&&g!=null&&l(e,["preferenceOptimizationSpec","hyperParameters","beta"],g),i}function mC(n,e){const t={},i=a(n,["baseModel"]);i!=null&&l(t,["baseModel"],i);const o=a(n,["preTunedModel"]);o!=null&&l(t,["preTunedModel"],o);const s=a(n,["trainingDataset"]);s!=null&&wC(s);const r=a(n,["config"]);return r!=null&&hC(r,t),t}function gC(n,e){const t={},i=a(n,["baseModel"]);i!=null&&l(t,["baseModel"],i);const o=a(n,["preTunedModel"]);o!=null&&l(t,["preTunedModel"],o);const s=a(n,["trainingDataset"]);s!=null&&RC(s,t,e);const r=a(n,["config"]);return r!=null&&pC(r,t,e),t}function yC(n,e){const t={},i=a(n,["name"]);return i!=null&&l(t,["_url","name"],i),t}function _C(n,e){const t={},i=a(n,["name"]);return i!=null&&l(t,["_url","name"],i),t}function TC(n,e,t){const i={},o=a(n,["pageSize"]);e!==void 0&&o!=null&&l(e,["_query","pageSize"],o);const s=a(n,["pageToken"]);e!==void 0&&s!=null&&l(e,["_query","pageToken"],s);const r=a(n,["filter"]);return e!==void 0&&r!=null&&l(e,["_query","filter"],r),i}function EC(n,e,t){const i={},o=a(n,["pageSize"]);e!==void 0&&o!=null&&l(e,["_query","pageSize"],o);const s=a(n,["pageToken"]);e!==void 0&&s!=null&&l(e,["_query","pageToken"],s);const r=a(n,["filter"]);return e!==void 0&&r!=null&&l(e,["_query","filter"],r),i}function IC(n,e){const t={},i=a(n,["config"]);return i!=null&&TC(i,t),t}function vC(n,e){const t={},i=a(n,["config"]);return i!=null&&EC(i,t),t}function AC(n,e){const t={},i=a(n,["sdkHttpResponse"]);i!=null&&l(t,["sdkHttpResponse"],i);const o=a(n,["nextPageToken"]);o!=null&&l(t,["nextPageToken"],o);const s=a(n,["tunedModels"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(c=>Gf(c))),l(t,["tuningJobs"],r)}return t}function CC(n,e){const t={},i=a(n,["sdkHttpResponse"]);i!=null&&l(t,["sdkHttpResponse"],i);const o=a(n,["nextPageToken"]);o!=null&&l(t,["nextPageToken"],o);const s=a(n,["tuningJobs"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(c=>Os(c))),l(t,["tuningJobs"],r)}return t}function SC(n,e){const t={},i=a(n,["name"]);i!=null&&l(t,["model"],i);const o=a(n,["name"]);return o!=null&&l(t,["endpoint"],o),t}function wC(n,e){const t={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const i=a(n,["examples"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),l(t,["examples","examples"],o)}return t}function RC(n,e,t){const i={};let o=a(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const r=a(n,["gcsUri"]);e!==void 0&&r!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],r)}else if(o==="PREFERENCE_TUNING"){const r=a(n,["gcsUri"]);e!==void 0&&r!=null&&l(e,["preferenceOptimizationSpec","trainingDatasetUri"],r)}let s=a(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const r=a(n,["vertexDatasetResource"]);e!==void 0&&r!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],r)}else if(s==="PREFERENCE_TUNING"){const r=a(n,["vertexDatasetResource"]);e!==void 0&&r!=null&&l(e,["preferenceOptimizationSpec","trainingDatasetUri"],r)}if(a(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return i}function Gf(n,e){const t={},i=a(n,["sdkHttpResponse"]);i!=null&&l(t,["sdkHttpResponse"],i);const o=a(n,["name"]);o!=null&&l(t,["name"],o);const s=a(n,["state"]);s!=null&&l(t,["state"],If(s));const r=a(n,["createTime"]);r!=null&&l(t,["createTime"],r);const c=a(n,["tuningTask","startTime"]);c!=null&&l(t,["startTime"],c);const f=a(n,["tuningTask","completeTime"]);f!=null&&l(t,["endTime"],f);const d=a(n,["updateTime"]);d!=null&&l(t,["updateTime"],d);const h=a(n,["description"]);h!=null&&l(t,["description"],h);const m=a(n,["baseModel"]);m!=null&&l(t,["baseModel"],m);const g=a(n,["_self"]);return g!=null&&l(t,["tunedModel"],SC(g)),t}function Os(n,e){const t={},i=a(n,["sdkHttpResponse"]);i!=null&&l(t,["sdkHttpResponse"],i);const o=a(n,["name"]);o!=null&&l(t,["name"],o);const s=a(n,["state"]);s!=null&&l(t,["state"],If(s));const r=a(n,["createTime"]);r!=null&&l(t,["createTime"],r);const c=a(n,["startTime"]);c!=null&&l(t,["startTime"],c);const f=a(n,["endTime"]);f!=null&&l(t,["endTime"],f);const d=a(n,["updateTime"]);d!=null&&l(t,["updateTime"],d);const h=a(n,["error"]);h!=null&&l(t,["error"],h);const m=a(n,["description"]);m!=null&&l(t,["description"],m);const g=a(n,["baseModel"]);g!=null&&l(t,["baseModel"],g);const T=a(n,["tunedModel"]);T!=null&&l(t,["tunedModel"],T);const P=a(n,["preTunedModel"]);P!=null&&l(t,["preTunedModel"],P);const M=a(n,["supervisedTuningSpec"]);M!=null&&l(t,["supervisedTuningSpec"],M);const N=a(n,["preferenceOptimizationSpec"]);N!=null&&l(t,["preferenceOptimizationSpec"],N);const V=a(n,["tuningDataStats"]);V!=null&&l(t,["tuningDataStats"],V);const L=a(n,["encryptionSpec"]);L!=null&&l(t,["encryptionSpec"],L);const b=a(n,["partnerModelTuningSpec"]);b!=null&&l(t,["partnerModelTuningSpec"],b);const H=a(n,["customBaseModel"]);H!=null&&l(t,["customBaseModel"],H);const z=a(n,["experiment"]);z!=null&&l(t,["experiment"],z);const $=a(n,["labels"]);$!=null&&l(t,["labels"],$);const A=a(n,["outputUri"]);A!=null&&l(t,["outputUri"],A);const I=a(n,["pipelineJob"]);I!=null&&l(t,["pipelineJob"],I);const E=a(n,["serviceAccount"]);E!=null&&l(t,["serviceAccount"],E);const C=a(n,["tunedModelDisplayName"]);C!=null&&l(t,["tunedModelDisplayName"],C);const S=a(n,["veoTuningSpec"]);return S!=null&&l(t,["veoTuningSpec"],S),t}function PC(n,e){const t={},i=a(n,["sdkHttpResponse"]);i!=null&&l(t,["sdkHttpResponse"],i);const o=a(n,["name"]);o!=null&&l(t,["name"],o);const s=a(n,["metadata"]);s!=null&&l(t,["metadata"],s);const r=a(n,["done"]);r!=null&&l(t,["done"],r);const c=a(n,["error"]);return c!=null&&l(t,["error"],c),t}function Ic(n,e){const t={},i=a(n,["gcsUri"]);i!=null&&l(t,["validationDatasetUri"],i);const o=a(n,["vertexDatasetResource"]);return o!=null&&l(t,["validationDatasetUri"],o),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class NC extends ot{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Ot(nt.PAGED_ITEM_TUNING_JOBS,i=>this.listInternal(i),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var i;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const o={tunedModelName:t.baseModel};!((i=t.config)===null||i===void 0)&&i.preTunedModelCheckpointId&&(o.checkpointId=t.config.preTunedModelCheckpointId);const s=Object.assign(Object.assign({},t),{preTunedModel:o});return s.baseModel=void 0,await this.tuneInternal(s)}else{const o=Object.assign({},t);return await this.tuneInternal(o)}else{const o=Object.assign({},t),s=await this.tuneMldevInternal(o);let r="";return s.metadata!==void 0&&s.metadata.tunedModel!==void 0?r=s.metadata.tunedModel:s.name!==void 0&&s.name.includes("/operations/")&&(r=s.name.split("/operations/")[0]),{name:r,state:bs.JOB_STATE_QUEUED}}}}async getInternal(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=_C(e);return c=G("{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>Os(h))}else{const d=yC(e);return c=G("{name}",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>Gf(h))}}async listInternal(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=vC(e);return c=G("tuningJobs",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=CC(h),g=new ec;return Object.assign(g,m),g})}else{const d=IC(e);return c=G("tunedModels",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=AC(h),g=new ec;return Object.assign(g,m),g})}}async cancel(e){var t,i,o,s;let r,c="",f={};if(this.apiClient.isVertexAI()){const d=cC(e);return c=G("{name}:cancel",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=fC(h),g=new tc;return Object.assign(g,m),g})}else{const d=uC(e);return c=G("{name}:cancel",d._url),f=d._query,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(h=>h.json().then(m=>{const g=m;return g.sdkHttpResponse={headers:h.headers},g})),r.then(h=>{const m=dC(h),g=new tc;return Object.assign(g,m),g})}}async tuneInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI()){const c=gC(e,e);return s=G("tuningJobs",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>Os(f))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,i;let o,s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=mC(e);return s=G("tunedModels",c._url),r=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json().then(d=>{const h=d;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>PC(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class MC{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const DC=1024*1024*8,VC=3,xC=1e3,kC=2,so="x-goog-upload-status";async function bC(n,e,t){var i;const o=await Of(n,e,t),s=await(o==null?void 0:o.json());if(((i=o==null?void 0:o.headers)===null||i===void 0?void 0:i[so])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return s.file}async function LC(n,e,t){var i;const o=await Of(n,e,t),s=await(o==null?void 0:o.json());if(((i=o==null?void 0:o.headers)===null||i===void 0?void 0:i[so])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const r=mf(s),c=new Dr;return Object.assign(c,r),c}async function Of(n,e,t){var i,o;let s=0,r=0,c=new Ls(new Response),f="upload";for(s=n.size;r<s;){const d=Math.min(DC,s-r),h=n.slice(r,r+d);r+d>=s&&(f+=", finalize");let m=0,g=xC;for(;m<VC&&(c=await t.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":String(r),"Content-Length":String(d)}}}),!(!((i=c==null?void 0:c.headers)===null||i===void 0)&&i[so]));)m++,await UC(g),g=g*kC;if(r+=d,((o=c==null?void 0:c.headers)===null||o===void 0?void 0:o[so])!=="active")break;if(s<=r)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return c}async function FC(n){return{size:n.size,type:n.type}}function UC(n){return new Promise(e=>setTimeout(e,n))}class qC{async upload(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await bC(e,t,i)}async uploadToFileSearchStore(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await LC(e,t,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await FC(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class BC{create(e,t,i){return new GC(e,t,i)}}class GC{constructor(e,t,i){this.url=e,this.headers=t,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vc="x-goog-api-key";class OC{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(vc)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(vc,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const HC="gl-node/";class $C{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const i=T_(e.httpOptions,e.vertexai,void 0,void 0);i&&(e.httpOptions?e.httpOptions.baseUrl=i:e.httpOptions={baseUrl:i}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const o=new OC(this.apiKey);this.apiClient=new _A({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:HC+"web",uploader:new qC,downloader:new MC}),this.models=new FA(this.apiClient),this.live=new DA(this.apiClient,o,new BC),this.batches=new WT(this.apiClient),this.chats=new NE(this.models,this.apiClient),this.caches=new wE(this.apiClient),this.files=new qE(this.apiClient),this.operations=new UA(this.apiClient),this.authTokens=new eC(this.apiClient),this.tunings=new NC(this.apiClient),this.fileSearchStores=new lC(this.apiClient)}}var JC={};const Hf={apiKey:"AIzaSyBfRH86rTPr5Po1bNhen0NxvGXClDGRG3M",authDomain:"kingqueenelection.firebaseapp.com",projectId:"kingqueenelection",storageBucket:"kingqueenelection.firebasestorage.app",messagingSenderId:"795478870002",appId:"1:795478870002:web:a1e1b9ecaa523e4ee5cd6b"},zC=Mc(Hf),oe=t_(zC),KC=()=>{try{if(typeof process<"u"&&JC)return"PLACEHOLDER_API_KEY"}catch{}return Hf.apiKey},WC=new $C({apiKey:KC()}),U={candidates:[],votes:[],settings:{isVotingActive:!0,showResultsToUser:!1,showWinnersToUser:!1,showTimerToUser:!0,timerDurationSeconds:3600,timerRemainingSeconds:3600,isTimerPaused:!0,adminEmail:"zzue8102002@gmail.com",lastResetTimestamp:0},nominations:[],userVotes:{KING:localStorage.getItem("vote_KING")==="true",QUEEN:localStorage.getItem("vote_QUEEN")==="true"},isAdmin:sessionStorage.getItem("admin_auth")==="true",adminOtp:null,selectedNominationId:null,lastTimerSync:0,pendingVote:null},F={init:()=>{try{F.setupListeners(),F.renderLucide(),window.addEventListener("hashchange",F.router),F.router(),setInterval(F.tickTimer,1e3),console.log("App Initialized Successfully")}catch(n){console.error("Initialization Failed:",n),document.body.innerHTML=`<div class="p-4 text-red-600">Failed to load application: ${n.message}</div>`}},router:()=>{const n=window.location.hash.slice(1)||"landing";document.querySelectorAll("section").forEach(e=>e.classList.add("hidden")),document.getElementById("main-nav").classList.add("hidden"),n==="landing"?document.getElementById("landing-page").classList.remove("hidden"):n==="vote"?(document.getElementById("voting-page").classList.remove("hidden"),document.getElementById("main-nav").classList.remove("hidden"),F.renderUserVoting()):n==="admin"&&(U.isAdmin?(document.getElementById("admin-panel").classList.remove("hidden"),F.renderAdminPanel()):document.getElementById("admin-login-page").classList.remove("hidden")),window.scrollTo(0,0)},navigate:n=>{window.location.hash=n},setupListeners:()=>{Vi(zt(oe,"candidates"),e=>{U.candidates=e.docs.map(t=>({id:t.id,...t.data()})),F.refreshUI()}),Vi(Ie(oe,"settings","config"),e=>{if(e.exists()){const t=e.data();U.settings={...U.settings,...t};const i=parseInt(localStorage.getItem("last_reset")||0);t.lastResetTimestamp>i&&(localStorage.removeItem("vote_KING"),localStorage.removeItem("vote_QUEEN"),localStorage.setItem("last_reset",t.lastResetTimestamp),U.userVotes={KING:!1,QUEEN:!1}),F.refreshUI()}else us(Ie(oe,"settings","config"),U.settings)});const n=Kl(zt(oe,"votes"),u_("timestamp","desc"),Wl(100));Vi(n,e=>{U.votes=e.docs.map(t=>t.data()),U.isAdmin&&F.currentTab==="history"&&F.switchAdminTab("history")}),Vi(zt(oe,"nominations"),e=>{U.nominations=e.docs.map(t=>({id:t.id,...t.data()})),F.renderNominations()})},refreshUI:()=>{const n=window.location.hash.slice(1);n==="vote"&&F.renderUserVoting(),n==="admin"&&U.isAdmin&&F.renderAdminPanel()},renderLucide:()=>{window.lucide&&window.lucide.createIcons()},renderUserVoting:()=>{const n=U.settings.isVotingActive,e=document.getElementById("user-page-title"),t=document.getElementById("user-page-subtitle");e&&t&&(n?(e.textContent="Cast Your Vote",t.textContent="Select your chosen King and Queen."):(e.textContent="Election Ended",t.textContent="Thank you for participating."));const i=document.getElementById("voting-timer-display"),o=document.getElementById("voting-timer-container");U.settings.showTimerToUser&&n?(o.classList.remove("hidden"),i.textContent=F.formatTime(U.settings.timerRemainingSeconds)):o.classList.add("hidden");const s=document.getElementById("winners-section"),r=document.getElementById("winners-grid");if(!n&&U.settings.showWinnersToUser&&U.candidates.length>0){const g=U.candidates.filter(V=>V.type==="KING").sort((V,L)=>(L.votes||0)-(V.votes||0)),T=U.candidates.filter(V=>V.type==="QUEEN").sort((V,L)=>(L.votes||0)-(V.votes||0)),P=g.length>0?g[0]:null,M=T.length>0?T[0]:null,N=(V,L)=>V?`
                <div class="bg-white rounded-2xl p-6 shadow-xl border-2 border-gold-400 relative overflow-hidden flex flex-col items-center animate-fadeIn">
                    <div class="absolute top-0 inset-x-0 h-2 bg-gold-500"></div>
                    <div class="w-32 h-32 rounded-full border-4 border-gold-400 p-1 mb-4 shadow-lg">
                        <img src="${V.imageUrl}" class="w-full h-full rounded-full object-cover">
                    </div>
                    <div class="mb-2">
                        <i data-lucide="crown" class="w-8 h-8 ${L==="King"?"text-blue-600":"text-pink-600"} fill-current inline-block"></i>
                    </div>
                    <h3 class="text-2xl font-serif font-bold text-gray-900 mb-1">${V.name}</h3>
                    <div class="text-sm font-bold uppercase tracking-widest text-gold-600 mb-4">${L}</div>
                    <div class="bg-gray-100 px-4 py-2 rounded-lg font-mono font-bold text-gray-700">
                        ${V.votes} Votes
                    </div>
                </div>
            `:"";r.innerHTML=`
                ${N(P,"King")}
                ${N(M,"Queen")}
            `,s.classList.remove("hidden"),e&&(e.textContent="Election Results")}else s.classList.add("hidden");const f=document.getElementById("king-section"),d=document.getElementById("queen-section"),h=document.querySelectorAll('button[onclick*="nomination-modal"]');if(!n)f.classList.add("hidden"),d.classList.add("hidden"),h.forEach(g=>g.classList.add("hidden"));else{f.classList.remove("hidden"),d.classList.remove("hidden"),h.forEach(T=>T.classList.remove("hidden"));const g=(T,P)=>{const M=document.getElementById(P),N=U.candidates.filter(b=>b.type===T),V=U.userVotes[T],L=document.getElementById(`${T.toLowerCase()}-voted-msg`);L&&L.classList.toggle("hidden",!V),M.innerHTML=N.map(b=>`
                    <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300 w-full max-w-sm border border-gray-100 group ${V?"opacity-75 grayscale":""}">
                        <div class="relative h-72 sm:h-80 overflow-hidden">
                            <img src="${b.imageUrl}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-4">
                                <button onclick='app.showBio(${JSON.stringify(b).replace(/'/g,"&#39;")})' class="text-white bg-white/20 backdrop-blur-md px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 hover:bg-white/30 cursor-pointer active:scale-95">
                                    <i data-lucide="info" class="w-4 h-4"></i> View Bio
                                </button>
                            </div>
                        </div>
                        <div class="p-5 text-center space-y-4">
                            <h3 class="text-xl font-bold text-gray-800 truncate">${b.name}</h3>
                            <button 
                                onclick="app.castVote('${b.id}', '${T}')"
                                ${!U.settings.isVotingActive||V?"disabled":""}
                                class="w-full py-3 rounded-lg font-bold text-white transition-all transform active:scale-95 touch-manipulation ${!U.settings.isVotingActive||V?"bg-gray-400 cursor-not-allowed":"bg-royal-900 hover:bg-royal-800 shadow-lg cursor-pointer"}"
                            >
                                ${V?"VOTE CAST":U.settings.isVotingActive?"VOTE":"CLOSED"}
                            </button>
                        </div>
                    </div>
                `).join("")};g("KING","king-grid"),g("QUEEN","queen-grid")}const m=document.getElementById("user-results-container");U.settings.showResultsToUser?(m.classList.remove("hidden"),F.renderCharts("user-results-chart")):m.classList.add("hidden"),F.renderLucide()},renderCharts:n=>{const e=document.getElementById(n);if(!e)return;const t=[...U.candidates].sort((o,s)=>(s.votes||0)-(o.votes||0));if(t.length===0){e.innerHTML='<p class="text-center text-gray-500 italic">No votes have been cast yet.</p>';return}const i=t[0].votes||1;e.innerHTML=t.map(o=>{const s=o.type==="KING",r=(o.votes||0)/i*100,c=s?"bg-royal-900":"bg-pink-600",f=s?"bg-blue-100 text-blue-800":"bg-pink-100 text-pink-800";return`
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-1">
                        <div class="flex items-center gap-2 overflow-hidden">
                            <span class="font-bold text-gray-700 max-w-[120px] sm:max-w-xs truncate">${o.name}</span>
                            <span class="text-xs px-2 py-0.5 rounded font-bold ${f} shrink-0">${o.type}</span>
                        </div>
                        <span class="font-mono font-bold text-gray-900 shrink-0">${o.votes||0}</span>
                    </div>
                    <div class="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                        <div class="${c} h-full rounded-full transition-all duration-1000 ease-out" style="width: ${r}%"></div>
                    </div>
                </div>
            `}).join("")},renderAdminPanel:()=>{const n=[{id:"dashboard",icon:"layout-dashboard",label:"Dashboard"},{id:"candidates",icon:"users",label:"Candidates"},{id:"settings",icon:"settings",label:"Settings"},{id:"history",icon:"history",label:"History"}];document.getElementById("admin-sidebar-links").innerHTML=n.map(s=>`
            <button onclick="app.switchAdminTab('${s.id}')" class="w-full flex items-center gap-3 px-6 py-4 text-left hover:bg-royal-800/50 text-gray-300 transition-colors ${F.currentTab===s.id?"bg-royal-800 border-r-4 border-gold-400":""}">
                <i data-lucide="${s.icon}" class="w-5 h-5"></i> ${s.label}
            </button>
        `).join("")+`
            <button onclick="app.logoutAdmin()" class="w-full flex items-center gap-3 px-6 py-4 text-left text-red-300 hover:bg-royal-800 mt-auto cursor-pointer">
                <i data-lucide="log-out" class="w-5 h-5"></i> Logout
            </button>
        `;const e=[...n];document.getElementById("admin-mobile-nav").innerHTML=e.map(s=>`
             <button onclick="app.switchAdminTab('${s.id}')" class="flex flex-col items-center p-2 rounded-lg flex-1 ${F.currentTab===s.id?"text-royal-900 bg-gray-100":"text-gray-500"} active:bg-gray-200 transition-colors">
                <i data-lucide="${s.icon}" class="w-5 h-5"></i>
                <span class="text-[10px] mt-1">${s.label}</span>
            </button>
        `).join("")+`
            <button onclick="app.logoutAdmin()" class="flex flex-col items-center p-2 rounded-lg flex-1 text-red-500 active:bg-red-50 transition-colors">
                <i data-lucide="log-out" class="w-5 h-5"></i>
                <span class="text-[10px] mt-1">Exit</span>
            </button>
        `;const i=`
            <div class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 flex items-center gap-4">
                <div class="p-3 bg-blue-100 text-blue-600 rounded-lg"><i data-lucide="vote" class="w-6 h-6"></i></div>
                <div><p class="text-sm text-gray-500">Total Votes</p><h3 class="text-2xl font-bold">${U.candidates.reduce((s,r)=>s+(r.votes||0),0)}</h3></div>
            </div>
            <div class="bg-white p-4 md:p-6 rounded-xl shadow-sm border border-gray-100 flex items-center gap-4">
                <div class="p-3 bg-purple-100 text-purple-600 rounded-lg"><i data-lucide="crown" class="w-6 h-6"></i></div>
                <div><p class="text-sm text-gray-500">Candidates</p><h3 class="text-2xl font-bold">${U.candidates.length}</h3></div>
            </div>
        `;document.getElementById("stats-grid").innerHTML=i;const o=(U.settings.timerDurationSeconds-U.settings.timerRemainingSeconds)/U.settings.timerDurationSeconds*100;if(document.getElementById("admin-timer-bar").style.width=`${Math.min(100,Math.max(0,o))}%`,document.getElementById("admin-timer-badge").textContent=`${U.settings.isVotingActive?"Active":"Paused"}  ${F.formatTime(U.settings.timerRemainingSeconds)}`,F.currentTab==="dashboard"&&F.renderCharts("admin-results-chart"),F.currentTab==="settings"){document.getElementById("setting-timer-display").textContent=F.formatTime(U.settings.timerRemainingSeconds),document.getElementById("setting-show-winners").checked=U.settings.showWinnersToUser,document.getElementById("setting-show-results").checked=U.settings.showResultsToUser,document.getElementById("setting-show-timer").checked=U.settings.showTimerToUser,document.getElementById("setting-voting-active").checked=U.settings.isVotingActive,document.getElementById("setting-timer-duration").value=Math.floor(U.settings.timerDurationSeconds/60);const s=document.getElementById("btn-toggle-timer");s.textContent=U.settings.isTimerPaused?"Resume Timer":"Pause Timer",s.className=`w-full py-3 rounded font-bold text-white active:scale-[0.98] transition-transform ${U.settings.isTimerPaused?"bg-green-600":"bg-yellow-500"}`}if(F.currentTab==="candidates"){const s=document.getElementById("candidates-list");s.innerHTML=U.candidates.map(r=>`
                <div class="bg-white p-4 rounded-lg shadow border flex flex-col relative">
                    <div class="flex items-center gap-3 mb-2">
                        <img src="${r.imageUrl}" class="w-12 h-12 rounded-full object-cover shrink-0">
                        <div class="min-w-0">
                            <div class="font-bold truncate">${r.name}</div>
                            <div class="text-xs bg-gray-100 inline-block px-2 rounded">${r.type}</div>
                        </div>
                    </div>
                    <div class="text-xs text-gray-500 line-clamp-2 mb-2">${r.bio}</div>
                    <div class="mt-auto flex justify-between items-center border-t pt-2">
                        <span class="font-bold">${r.votes} Votes</span>
                        <div class="flex gap-2">
                            <button onclick='app.editCandidate(${JSON.stringify(r).replace(/'/g,"&#39;")})' class="text-blue-600 hover:bg-blue-50 p-2 rounded-full active:bg-blue-100"><i data-lucide="edit-2" class="w-4 h-4"></i></button>
                            <button onclick="app.deleteCandidate('${r.id}')" class="text-red-600 hover:bg-red-50 p-2 rounded-full active:bg-red-100"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                </div>
             `).join(""),F.renderNominations()}if(F.currentTab==="history"){const s=document.getElementById("history-table-body");U.votes.length===0?s.innerHTML='<tr><td colspan="4" class="p-4 text-center text-gray-500">No votes recorded.</td></tr>':s.innerHTML=U.votes.map(r=>`
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 md:px-6 py-3">${new Date(r.timestamp).toLocaleTimeString()}</td>
                        <td class="px-4 md:px-6 py-3 font-medium">${r.candidateName}</td>
                        <td class="px-4 md:px-6 py-3"><span class="px-2 py-0.5 rounded text-xs ${r.candidateType==="KING"?"bg-blue-100 text-blue-800":"bg-pink-100 text-pink-800"}">${r.candidateType}</span></td>
                        <td class="px-4 md:px-6 py-3 text-xs text-gray-500 truncate max-w-[150px]">${r.browserAgent||"N/A"}</td>
                    </tr>
                `).join("")}F.renderLucide()},renderNominations:()=>{const n=document.getElementById("nominations-list"),e=document.getElementById("nominations-container"),t=document.getElementById("admin-nom-count"),i=U.nominations.filter(s=>s.status==="PENDING");if(t&&(t.textContent=i.length,t.classList.toggle("hidden",i.length===0)),i.length===0){e.classList.add("hidden");return}e.classList.remove("hidden");const o=i.slice(0,10);n.innerHTML=o.map(s=>`
            <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3 p-3 bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow">
                <div class="flex items-center gap-3 w-full sm:w-auto">
                    <img src="${s.imageUrl}" class="w-12 h-12 rounded-full object-cover border border-gray-200 shrink-0">
                    <div class="flex-1 min-w-0 sm:hidden">
                        <div class="font-bold text-gray-900 truncate">${s.name}</div> 
                        <div class="text-xs text-royal-600 font-medium mb-0.5">${s.type}</div>
                    </div>
                </div>
                <div class="flex-1 min-w-0 hidden sm:block">
                    <div class="font-bold text-gray-900 truncate">${s.name}</div> 
                    <div class="text-xs text-royal-600 font-medium mb-0.5">${s.type}</div>
                    <div class="text-xs text-gray-500 truncate italic">"${s.bio}"</div>
                </div>
                <div class="sm:hidden text-xs text-gray-500 italic line-clamp-2 w-full">"${s.bio}"</div>
                <div class="w-full sm:w-auto flex justify-end">
                    <button onclick="app.openReviewModal('${s.id}')" class="px-3 py-1.5 bg-royal-100 text-royal-800 text-xs font-bold rounded-full hover:bg-royal-200 transition-colors flex items-center gap-1 active:scale-95">
                        Review <i data-lucide="chevron-right" class="w-3 h-3"></i>
                    </button>
                </div>
            </div>
        `).join(""),F.renderLucide()},openReviewModal:n=>{const e=U.nominations.find(t=>t.id===n);e&&(U.selectedNominationId=n,document.getElementById("review-name").textContent=e.name,document.getElementById("review-type").textContent=e.type,document.getElementById("review-bio").textContent=`"${e.bio}"`,document.getElementById("review-img").src=e.imageUrl,F.toggleModal("review-modal",!0))},approveCurrentNomination:async()=>{U.selectedNominationId&&(await F.approveNomination(U.selectedNominationId),F.toggleModal("review-modal",!1),U.selectedNominationId=null)},openRejectionModal:()=>{document.getElementById("rejection-reason").value="",F.toggleModal("rejection-modal",!0)},confirmRejection:async()=>{if(!U.selectedNominationId)return;const n=document.getElementById("rejection-reason").value;if(!n.trim()){F.toast("Please provide a reason","error");return}await F.rejectNomination(U.selectedNominationId,n),F.toggleModal("rejection-modal",!1),F.toggleModal("review-modal",!1),U.selectedNominationId=null},currentTab:"dashboard",switchAdminTab:n=>{F.currentTab=n,document.querySelectorAll(".admin-tab").forEach(e=>e.classList.add("hidden")),document.getElementById(`tab-${n}`).classList.remove("hidden"),document.getElementById("admin-page-title").textContent=n.charAt(0).toUpperCase()+n.slice(1),F.renderAdminPanel(),window.scrollTo(0,0)},toggleModal:(n,e)=>{const t=document.getElementById(n);e?t.classList.remove("hidden"):t.classList.add("hidden")},showBio:n=>{document.getElementById("bio-name").textContent=n.name,document.getElementById("bio-type").textContent=`RUNNING FOR ${n.type}`,document.getElementById("bio-text").textContent=`"${n.bio}"`,document.getElementById("bio-img").src=n.imageUrl,F.toggleModal("bio-modal",!0)},toast:(n,e="info")=>{const t=document.getElementById("toast-container"),i=document.createElement("div");i.className=`toast animate-slideIn ${e==="error"?"border-red-500":e==="success"?"border-green-500":"border-blue-500"}`,i.innerHTML=`
            <div class="${e==="error"?"text-red-500":e==="success"?"text-green-500":"text-blue-500"}">
                <i data-lucide="${e==="error"?"alert-circle":e==="success"?"check-circle":"info"}" class="w-5 h-5"></i>
            </div>
            <p class="text-sm font-medium text-gray-800">${n}</p>
        `,t.appendChild(i),window.lucide&&window.lucide.createIcons(),setTimeout(()=>i.remove(),3e3)},checkAdminSession:()=>{U.isAdmin,F.navigate("admin")},handleAdminEmail:n=>{n.preventDefault(),document.getElementById("admin-email-input").value.toLowerCase()===U.settings.adminEmail.toLowerCase()?(U.adminOtp=Math.floor(1e5+Math.random()*9e5).toString(),console.log(`%c [AUTH] OTP CODE: ${U.adminOtp}`,"color: #d4af37; font-size: 20px; font-weight: bold;"),F.toast("OTP Code sent to console (Demo)","success"),document.getElementById("login-email-form").classList.add("hidden"),document.getElementById("login-code-form").classList.remove("hidden")):F.toast("Email not authorized","error")},handleAdminCode:n=>{n.preventDefault(),document.getElementById("admin-code-input").value===U.adminOtp?(U.isAdmin=!0,sessionStorage.setItem("admin_auth","true"),F.toast("Login Successful","success"),F.navigate("admin"),F.refreshUI()):F.toast("Invalid Code","error")},logoutAdmin:()=>{U.isAdmin=!1,sessionStorage.removeItem("admin_auth"),F.navigate("landing")},castVote:(n,e)=>{const t=U.candidates.find(i=>i.id===n);!t||!U.settings.isVotingActive||(U.pendingVote={candidateId:n,type:e},document.getElementById("confirm-vote-name").textContent=t.name,document.getElementById("confirm-vote-type").textContent=e,document.getElementById("confirm-vote-img").src=t.imageUrl,F.toggleModal("vote-confirmation-modal",!0))},confirmVote:async()=>{if(!U.pendingVote)return;const{candidateId:n,type:e}=U.pendingVote;try{const t=Ln(oe),i=Ie(zt(oe,"votes"));t.set(i,{candidateId:n,candidateName:U.candidates.find(s=>s.id===n).name,candidateType:e,timestamp:Date.now(),browserAgent:navigator.userAgent});const o=Ie(oe,"candidates",n);t.update(o,{votes:Xl(1)}),await t.commit(),localStorage.setItem(`vote_${e}`,"true"),U.userVotes[e]=!0,F.refreshUI(),F.toast("Vote Cast Successfully!","success")}catch(t){console.error(t),F.toast("Failed to cast vote","error")}finally{F.toggleModal("vote-confirmation-modal",!1),U.pendingVote=null}},simulateBots:async n=>{F.toast(`Simulating ${n} concurrent votes...`,"info");const e=U.candidates.filter(c=>c.type==="KING"),t=U.candidates.filter(c=>c.type==="QUEEN"),i=[...e,...t];if(i.length===0)return F.toast("No candidates found!","error");const o=200,s=Math.ceil(n/o);let r=0;try{for(let c=0;c<s;c++){const f=Ln(oe),d=Math.min(o,n-c*o);for(let h=0;h<d;h++){const m=Ie(zt(oe,"votes")),g=i[Math.floor(Math.random()*i.length)];f.set(m,{candidateId:g.id,candidateName:g.name,candidateType:g.type,timestamp:Date.now(),voterIp:`bot-${Date.now()}-${c}-${h}`,browserAgent:"Simulated Bot/High-Traffic-Test"});const T=Ie(oe,"candidates",g.id);f.update(T,{votes:Xl(1)})}await f.commit(),r+=d,console.log(`Batch ${c+1}/${s} committed (${d} votes)`),s>1&&await new Promise(h=>setTimeout(h,200))}F.toast(`Successfully simulated ${r} votes!`,"success")}catch(c){console.error(c),F.toast(`Simulation stopped after ${r} votes. Error: ${c.message}`,"error")}},handleImageUpload:async(n,e)=>{const t=n.files[0];if(t){if(!t.type.match("image.*")){F.toast("Please upload an image file.","error");return}F.toast("Optimizing image...","info");try{const i=await F.compressImage(t);document.getElementById(e).value=i,F.toast("Image optimized and uploaded!","success")}catch(i){console.error("Image compression failed",i),F.toast("Failed to process image.","error")}}},compressImage:n=>new Promise((e,t)=>{const i=new FileReader;i.readAsDataURL(n),i.onload=o=>{const s=new Image;s.src=o.target.result,s.onload=()=>{let f=s.width,d=s.height;f>d?f>800&&(d*=800/f,f=800):d>800&&(f*=800/d,d=800);const h=document.createElement("canvas");h.width=f,h.height=d,h.getContext("2d").drawImage(s,0,0,f,d),e(h.toDataURL("image/jpeg",.7))},s.onerror=r=>t(r)},i.onerror=o=>t(o)}),handleCandidateSubmit:async n=>{n.preventDefault();const e=document.getElementById("cand-id").value,t={name:document.getElementById("cand-name").value,type:document.getElementById("cand-type").value,imageUrl:document.getElementById("cand-image").value||"https://picsum.photos/400",bio:document.getElementById("cand-bio").value};try{e?(await Di(Ie(oe,"candidates",e),t),F.toast("Candidate Updated","success")):(await us(Ie(oe,"candidates",Date.now().toString()),{...t,votes:0}),F.toast("Candidate Added","success")),F.resetCandidateForm()}catch{F.toast("Error saving candidate","error")}},editCandidate:n=>{document.getElementById("cand-id").value=n.id,document.getElementById("cand-name").value=n.name,document.getElementById("cand-type").value=n.type,document.getElementById("cand-image").value=n.imageUrl,document.getElementById("cand-bio").value=n.bio;const e=document.getElementById("candidate-form");e&&e.scrollIntoView({behavior:"smooth"})},deleteCandidate:async n=>{confirm("Delete this candidate?")&&(await h_(Ie(oe,"candidates",n)),F.toast("Candidate deleted","info"))},resetCandidateForm:()=>{document.getElementById("candidate-form").reset(),document.getElementById("cand-id").value=""},generateBio:async()=>{const n=document.getElementById("cand-name").value,e=document.getElementById("cand-type").value;if(!n)return F.toast("Enter name first","error");F.toast("Generating Bio...","info");try{const t=await WC.models.generateContent({model:"gemini-2.5-flash",contents:`Write a short, engaging, and elegant biography (max 40 words) for a ${e} candidate named ${n}. Tone: Royal and inspiring.`});document.getElementById("cand-bio").value=t.text,F.toast("Bio Generated!","success")}catch(t){console.error(t),F.toast("AI Generation Failed. Check Console.","error")}},handleNominationSubmit:async n=>{n.preventDefault();const e=document.getElementById("nom-password");if(e.value!=="1111"){F.toast("Invalid Access Code","error");return}const i={name:document.getElementById("nom-name").value,type:document.getElementById("nom-type").value,imageUrl:document.getElementById("nom-image").value||"https://picsum.photos/400",bio:document.getElementById("nom-bio").value,timestamp:Date.now(),status:"PENDING"};await us(Ie(oe,"nominations",Date.now().toString()),i),e.value="",F.toggleModal("nomination-modal",!1),F.toast("Nomination Submitted!","success")},approveNomination:async n=>{const e=U.nominations.find(s=>s.id===n);if(!e)return;const t=Ln(oe),i=Ie(oe,"candidates",e.id);t.set(i,{name:e.name,type:e.type,bio:e.bio,imageUrl:e.imageUrl,votes:0});const o=Ie(oe,"nominations",n);t.update(o,{status:"APPROVED",approvedAt:Date.now()}),await t.commit(),F.toast("Nomination Approved","success")},rejectNomination:async(n,e="No reason provided")=>{await Di(Ie(oe,"nominations",n),{status:"REJECTED",rejectionReason:e,rejectedAt:Date.now()}),F.toast("Nomination Rejected","info")},updateSetting:async(n,e)=>{await Di(Ie(oe,"settings","config"),{[n]:e})},updateTimerSettings:n=>{F.updateSetting("timerDurationSeconds",n*60),F.updateSetting("timerRemainingSeconds",n*60)},toggleTimer:()=>{F.updateSetting("isTimerPaused",!U.settings.isTimerPaused)},resetTimer:()=>{F.updateSetting("timerRemainingSeconds",U.settings.timerDurationSeconds)},tickTimer:()=>{if(!U.settings.isTimerPaused&&U.settings.timerRemainingSeconds>0&&(U.settings.timerRemainingSeconds--,U.settings.timerRemainingSeconds<=0&&(U.settings.timerRemainingSeconds=0,U.isAdmin&&(Di(Ie(oe,"settings","config"),{isVotingActive:!1,timerRemainingSeconds:0,isTimerPaused:!0}),F.toast("Timer Finished. Voting Closed.","info"))),F.refreshUI(),U.isAdmin&&U.settings.isVotingActive&&U.settings.timerRemainingSeconds>0)){const n=Date.now();n-U.lastTimerSync>5e3&&(F.updateSetting("timerRemainingSeconds",U.settings.timerRemainingSeconds),U.lastTimerSync=n)}},resetElection:async()=>{if(confirm("DANGER: This will wipe ALL data (Votes, History, Timer status). This cannot be undone. Are you sure?")){F.toast("Resetting election...","info");try{const n=Ln(oe);U.candidates.forEach(t=>{n.update(Ie(oe,"candidates",t.id),{votes:0})}),n.update(Ie(oe,"settings","config"),{lastResetTimestamp:Date.now(),timerRemainingSeconds:U.settings.timerDurationSeconds,isTimerPaused:!0,isVotingActive:!0}),await n.commit();const e=async t=>{const i=Kl(zt(oe,t),Wl(500)),o=await f_(i);if(o.size===0)return;const s=Ln(oe);o.docs.forEach(r=>{s.delete(r.ref)}),await s.commit(),o.size>=500&&await e(t)};await e("votes"),U.votes=[],U.userVotes={KING:!1,QUEEN:!1},localStorage.removeItem("vote_KING"),localStorage.removeItem("vote_QUEEN"),localStorage.setItem("last_reset",Date.now()),F.refreshUI(),F.toast("Election Fully Reset","success")}catch(n){console.error("Reset failed",n),F.toast("Error resetting election: "+n.message,"error")}}},formatTime:n=>{const e=Math.floor(n/60),t=n%60;return`${e}:${t.toString().padStart(2,"0")}`}};window.app=F;F.init();
